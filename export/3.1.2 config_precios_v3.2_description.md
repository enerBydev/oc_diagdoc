---
id: 3.1.2
title: Descripción Config Precios
parent: '3.1'
breadcrumb: 0 → 3.0 → 3.1 → 3.1.2
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-17 11:06
domain:
- precios
- documentacion
actors:
- admin
- desarrollador
summary: 'Descripción detallada de campos del JSON de precios.

  Arquitectura, sistema de precios, factores, descuentos.'
content_hash: b8610fd9fdd3b5e2
---

# 3.1.2 Descripción de Campos

## Propósito

Este JSON es la **fuente de verdad** de la lógica de negocio de OnlyCar. Define:

- Catálogo de servicios y paquetes
- Sistema de precios con factores B2C/B2B
- Descuentos y reglas de compatibilidad
- Formatos de identificación de clientes
- Programa de lealtad Corporate+

> [!IMPORTANT]
> **Los descuentos SOLO aplican a PAQUETES, NO a servicios individuales.**
> Ver regla RD-006 en [[Proyecto OnlyCarNLD/Datos/1.1.5 reglas_comerciales]]

---

## Arquitectura del Sistema

```
meta/                          → Configuración global
├── version, currency
├── preciosIncluyenIVA: true   → IVA absorbido, Stripe/Gigstack manejan facturación
└── formulaDescuentosAcumulados

validaciones/                  → Constraints del sistema
factoresPrecios/               → Multiplicadores B2C (0.7) y B2B (0.45)
escalasVolumenB2B/             → Descuentos centralizados por volumen

servicios[]                    → Catálogo base (10 servicios)
├── id, nombre, descripcion
├── duracion: { servicioMinutos, bufferAgendaMinutos, totalBloqueado }
└── precioBase                 → Precio de referencia

paquetesB2C[]                  → 4 paquetes para consumidor final
├── precioBase, servicios[]
└── heredaDe + serviciosAdicionales (herencia limpia)

paquetesB2B[]                  → 4 paquetes corporativos
├── precioBase, escalaVolumen → Referencia a escalasVolumenB2B
└── heredaDe + serviciosAdicionales

descuentosB2C/B2B              → Consolidado por código
├── porcentaje, tipo, requisitos
└── beneficioReferidor (si aplica)

compatibilidadDescuentosB2C    → Grupos de exclusión + combinaciones válidas
formatosIdentificador          → Patrones de IDs
programaCorporatePlus          → Referencias a otros datos (sin duplicación)
empresasRegistradas            → Catálogo de empresas B2B
```

---

## Sistema de Precios

### Factores de Conversión

| Tipo | Factor | Ejemplo (precioBase: 290) |
|------|--------|---------------------------|
| Base | 1.0 | $290 |
| B2C | 0.7 | $290 × 0.7 = **$200** |
| B2B | 0.45 | $290 × 0.45 = **$130** |

> **Nota:** Los precios se redondean al múltiplo de 10 más cercano.

### Cálculo de Precio

```javascript
const precioB2C = Math.round((servicio.precioBase * factoresPrecios.b2c) / 10) * 10;
const precioB2B = Math.round((servicio.precioBase * factoresPrecios.b2b) / 10) * 10;
```

---

## Sistema de Duración

Cada servicio/paquete incluye:

```json
"duracion": {
  "servicioMinutos": 180,
  "bufferAgendaMinutos": 15,
  "totalBloqueado": 195
}
```

---

## Descuentos Consolidados

Cada descuento tiene toda su información en un solo lugar:

```json
"CORP15": {
  "nombre": "Empleado Corporativo",
  "porcentaje": 15,
  "tipo": "permanente",
  "requisitos": ["empleadoEmpresaB2B", "verificacionEmail"],
  "beneficiosAdicionales": ["prioridadAgenda48hrs", "tarjetasReferido10", "facturacionEmpresa"]
}
```

### Compatibilidad

```json
"gruposExclusion": {
  "primeraVez": ["BIENVENIDA30", "BIENVENIDA_REFERIDA"],
  "acumulables": ["FLOTILLA20", "PADRINO"]
}
```

**Regla:** Los descuentos en `primeraVez` son incompatibles con todo (excepto ninguno). `CORP15` puede combinarse con `acumulables`.

---

## Escalas de Volumen B2B

Centralizadas en `escalasVolumenB2B`, referenciadas por los paquetes:

| Escala | Vehículos | Descuento |
|--------|-----------|-----------|
| estandar | 3-9 | 10% |
| estandar | 10-19 | 15% |
| estandar | 20-49 | 20% |
| estandar | 50+ | 25% |
| preventrega | 5-10 | 15% |
| preventrega | 11-20 | 20% |
| preventrega | 21+ | 25% |

### Uso en Código

```javascript
function getDescuentoVolumen(escala, vehiculos) {
  const rangos = config.escalasVolumenB2B[escala];
  const rango = rangos.find(r => vehiculos >= r.min && (r.max === null || vehiculos <= r.max));
  return rango?.descuento || 0;
}
```

---

## Herencia de Paquetes

Los paquetes con `heredaDe` solo declaran servicios adicionales:

```json
{
  "id": "renovacionProfunda",
  "heredaDe": "proteccionTotal",
  "serviciosAdicionales": ["limpiezaMotor", "restauracionFaros", "restauracionPlasticosVinilos"]
}
```

### Resolver Servicios Completos

```javascript
function getServiciosPaquete(paqueteId) {
  const paq = paquetes.find(p => p.id === paqueteId);
  if (paq.heredaDe) {
    return [...getServiciosPaquete(paq.heredaDe), ...paq.serviciosAdicionales];
  }
  return paq.servicios;
}
```

---

## Integración con Stripe/Gigstack

- `preciosIncluyenIVA: true` → Los precios mostrados son finales
- El IVA es absorbido por OnlyCar
- Stripe cobra el monto exacto
- Gigstack genera CFDI con desglose automático

---

## Flujo de Uso

```
1. CLIENTE LLEGA
   → Identificar tipo: B2C nuevo sin referido

2. OBTENER PRECIO
   → config.paquetesB2C.find(p => p.id === "brilloExpress").precioBase
   → 360 × 0.7 = $250 (redondeado)

3. APLICAR DESCUENTO
   → config.descuentosB2C.BIENVENIDA30.porcentaje = 30
   → $250 × (1 - 0.30) = $175

4. VERIFICAR COMPATIBILIDAD
   → gruposExclusion.primeraVez incluye BIENVENIDA30
   → No se puede combinar con otros

5. COBRAR
   → Stripe: $175 MXN
   → Gigstack: CFDI automático

6. GENERAR CÓDIGO REFERIDO
   → formatosIdentificador.codigoReferidoCliente
   → "NLD-C-K9X3R6"
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/3.1. Logica_Negocio_Core]]                            |
| -------------------- | --------------------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/3.1.1 config_precios_v3.2]]                 |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.3 config_precios_v3.2_historyVersion]]  |

---
