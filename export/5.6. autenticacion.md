---
id: 5.6
title: Sistema de AutenticaciÃ³n
parent: '5.0'
breadcrumb: 0 â†’ 5.0 â†’ 5.6
type: modulo_padre
children_count: 7
descendants_count: 7
actors:
- admin
- operador
- cliente_b2c
- cliente_b2b
- corporate_plus
domain:
- auth
- oauth
- seguridad
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-23 14:24
summary: 'Sistema dual de autenticaciÃ³n: OAuth (Azure/Google) o Email/Password blindado.

  DetecciÃ³n automÃ¡tica de tipo de usuario post-login.'
content_hash: 30d11a60dfac234f
---

# 5.6 Sistema de AutenticaciÃ³n

> Sistema dual de autenticaciÃ³n que permite acceso mediante OAuth (Azure/Google) 
> o credenciales tradicionales (Email/Password blindado).

---

## Principio de DiseÃ±o

> [!IMPORTANT]
> **AutenticaciÃ³n Dual:**
> 1. **OAuth** â€” Login rÃ¡pido via Azure o Google (NO almacena credenciales)
> 2. **Email/Password** â€” Para usuarios sin OAuth (almacenamiento blindado)
>
> La detecciÃ³n del tipo de usuario ocurre **post-login** analizando el dominio.

---

## Arquitectura General

```mermaid
flowchart TB
    subgraph LOGIN["ğŸ” Pantalla de Login"]
        AZURE[ğŸ”µ Continuar con Microsoft]
        GOOGLE[ğŸŸ¢ Continuar con Google]
        EMAIL[ğŸ“§ Email y ContraseÃ±a]
    end
    
    AZURE --> POST[Proceso Post-Login]
    GOOGLE --> POST
    EMAIL --> POST
    
    POST --> DOMINIO{Â¿Dominio en BD<br/>con contrato B2B?}
    DOMINIO -->|SÃ­| CORP[Corporate+<br/>CORP15, etc.]
    DOMINIO -->|No| B2C[B2C Puro<br/>Sin beneficios corp]
```



```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PANTALLA DE LOGIN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  ğŸ”µ Continuar con       â”‚  â”‚  ğŸŸ¢ Continuar con       â”‚      â”‚
â”‚   â”‚     Microsoft           â”‚  â”‚     Google              â”‚      â”‚
â”‚   â”‚  (Personal o Trabajo)   â”‚  â”‚  (Personal o Trabajo)   â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ğŸ“§ Continuar con Email y ContraseÃ±a                    â”‚   â”‚
â”‚   â”‚     (Cualquier dominio: ISP, empresarial, personal)     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

## Estructura de Hijos

| ID                                       | Nombre                  | DescripciÃ³n                  | Estado |
| ---------------------------------------- | ----------------------- | ---------------------------- | ------ |
| [[Proyecto OnlyCarNLD/Datos/5.6.1 arquitectura_auth\|5.6.1]]       | Arquitectura Auth       | Diagrama tÃ©cnico completo    | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.2 oauth_proveedores\|5.6.2]]       | OAuth Proveedores       | Azure + Google OAuth mixto   | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.3 email_password_blindado\|5.6.3]] | Email/Password Blindado | Sistema tradicional seguro   | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.4 deteccion_tipo_usuario\|5.6.4]]  | DetecciÃ³n Tipo Usuario  | LÃ³gica de dominio post-login | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.5 seguridad_auth\|5.6.5]]          | Seguridad Auth          | MFA, rate limiting, headers  | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.6 migracion_usuarios\|5.6.6]]      | MigraciÃ³n Usuarios      | MigraciÃ³n de usuarios legacy | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.6.7 arquitectura_verificacion_hibrida\|5.6.7]] | Arq. VerificaciÃ³n HÃ­brida | Manual â†’ Auto (Adapter) | âœ… |

---

## Comparativa de MÃ©todos

| Aspecto         | OAuth            | Email/Password        |
| --------------- | ---------------- | --------------------- |
| **Proveedores** | Azure + Google   | Cualquier dominio     |
| **Credenciales**| Delegadas        | Almacenadas (hasheadas)|
| **Velocidad**   | 1 clic           | Registro manual       |
| **MFA**         | Del proveedor    | TOTP opcional         |
| **RecuperaciÃ³n**| Del proveedor    | Reset por email       |

---

## Flujo Post-Login (Ambos MÃ©todos)

```
LOGIN EXITOSO
    â”‚
    â–¼
EXTRAER EMAIL
    â”‚
    â–¼
OBTENER DOMINIO
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿Dominio en BD con    â”‚
â”‚ contrato B2B activo?  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
     â–¼             â–¼
   [ SÃ ]       [ NO ]
     â”‚             â”‚
     â–¼             â–¼
Corporate+     B2C Puro
(CORP15, etc) (Sin beneficios corp)
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/5.0. integraciones]]           |
| -------------------- | -------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.5. webhooks_integracion]]    |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.7. pdfme_generacion]]        |

---

**Fecha de especificaciÃ³n:** Diciembre 2025  
**VersiÃ³n:** 1.0 (Dual Auth)
