---
id: 1.2.2.1.8.2
title: NotificaciÃ³n de ActivaciÃ³n
parent: 1.2.2.1.8
breadcrumb: 0 â†’ 1.0 â†’ 1.2 â†’ 1.2.2 â†’ 1.2.2.1 â†’ 1.2.2.1.8 â†’ 1.2.2.1.8.2
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 00:34
domain:
- operador
- notificacion
- ciudades
- expansion
summary: 'Notificar a operadores interesados cuando su ciudad se active.

  Email + push con link prellenado.

  '
content_hash: cf1779a015159f89
---

# 1.2.2.1.8.2 NotificaciÃ³n de ActivaciÃ³n

> Notificar a operadores interesados cuando su ciudad se active.

---

## Flujo

```mermaid
sequenceDiagram
    participant A as ğŸ‘¨ğŸ’¼ Admin
    participant S as ğŸ—„ï¸ Sistema
    participant O as ğŸ‘· Operadores
    
    A->>S: Activar ciudad "Monterrey"
    S->>S: Buscar interesados
    S->>O: Email: "Â¡Tu ciudad estÃ¡ activa!"
    S->>O: Push: "ContinÃºa tu registro"
    O->>S: Click en link
    S->>S: Prellenar datos
    O->>S: Completar registro
```

---

## Trigger al Activar Ciudad

```typescript
// Cuando una ciudad cambia a estado 'piloto' o 'activa'
const notificarOperadoresInteresados = async (ciudadId: string, ciudadNombre: string) => {
  const supabase = createServerSupabaseClient();
  
  // Buscar interesados
  const { data: interesados } = await supabase
    .from('operadores_interesados')
    .select('*')
    .eq('ciudad_nombre', ciudadNombre)
    .eq('estado', 'esperando');
  
  for (const operador of interesados || []) {
    // Generar token Ãºnico
    const token = generateSecureToken();
    
    // Guardar token
    await supabase
      .from('operadores_interesados')
      .update({
        token_registro: token,
        notificado_at: new Date(),
        estado: 'notificado'
      })
      .eq('id', operador.id);
    
    // Enviar email
    await sendEmail({
      to: operador.email,
      subject: 'ğŸ‰ Â¡OnlyCar llegÃ³ a tu ciudad!',
      template: 'operador-ciudad-activa',
      data: {
        nombre: operador.nombre,
        ciudad: ciudadNombre,
        posicion: operador.posicion,
        link: `${process.env.APP_URL}/operador/registro?token=${token}`
      }
    });
    
    // Si tiene push token, enviar push
    if (operador.push_token) {
      await sendPushNotification({
        token: operador.push_token,
        notification: {
          title: 'ğŸš€ Â¡Tu ciudad estÃ¡ activa!',
          body: `OnlyCar ya opera en ${ciudadNombre}. Â¡ContinÃºa tu registro!`
        }
      });
    }
  }
  
  return interesados?.length || 0;
};
```

---

## Email Template

```html
<h1>ğŸ‰ Â¡Buenas noticias, {{nombre}}!</h1>

<p>OnlyCar ya estÃ¡ operando en <strong>{{ciudad}}</strong>.</p>

<p>Eres el operador #{{posicion}} en la lista de espera, 
   lo que significa prioridad en la asignaciÃ³n de servicios.</p>

<p>ContinÃºa tu registro ahora:</p>

<a href="{{link}}" style="...">
  Completar mi registro
</a>

<p>Tus datos estÃ¡n prellenados, solo necesitas:</p>
<ul>
  <li>Subir tus documentos</li>
  <li>Completar el cuestionario</li>
  <li>Terminar la capacitaciÃ³n</li>
</ul>

<p>Â¡Te esperamos!</p>
```

---

## Prellenar Datos

```typescript
// pages/operador/registro.vue
const token = route.query.token;

if (token) {
  // Buscar datos prellenados
  const { data: interesado } = await supabase
    .from('operadores_interesados')
    .select('*')
    .eq('token_registro', token)
    .single();
  
  if (interesado) {
    // Prellenar formulario
    formData.value = {
      nombre: interesado.nombre,
      apellidos: interesado.apellidos,
      telefono: interesado.telefono,
      email: interesado.email,
      ciudad: interesado.ciudad_nombre,
      estadoMexico: interesado.estado_nombre,
      prioridad: interesado.posicion
    };
    
    // Marcar como registrado al completar
    onRegistroCompleto(async () => {
      await supabase
        .from('operadores_interesados')
        .update({ estado: 'registrado' })
        .eq('id', interesado.id);
    });
  }
}
```

---

## Dashboard Admin: Interesados por Ciudad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š OPERADORES INTERESADOS POR CIUDAD                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Monterrey, NL      â”‚ 45 interesados â”‚ [ Notificar ]     â”‚    â”‚
â”‚  â”‚ Estado: Borrador   â”‚                â”‚                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Guadalajara, JAL   â”‚ 32 interesados â”‚ [ Notificar ]     â”‚    â”‚
â”‚  â”‚ Estado: Borrador   â”‚                â”‚                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CDMX               â”‚ 28 interesados â”‚ [ Notificar ]     â”‚    â”‚
â”‚  â”‚ Estado: Borrador   â”‚                â”‚                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.8 ciudad_no_disponible]]      |
| -------------------- | --------------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.8.1 lista_espera_operadores]] |
| ğŸ”— Ver tambiÃ©n       | [[Proyecto OnlyCarNLD/Datos/1.2.2.1 registro_operador]]           |

---
