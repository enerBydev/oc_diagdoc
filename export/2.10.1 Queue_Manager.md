---
id: 2.10.1
title: Queue Manager
parent: '2.10'
breadcrumb: 0 → 2.0 → 2.10 → 2.10.1
type: especificacion
domain:
- offline
- indexeddb
- dexie
- queue
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-04 21:38
summary: 'Implementación de cola persistente local usando Dexie.js (IndexedDB).

  Serialización de Requests y reintentos automáticos.'
content_hash: 3ca8e550e314fc88
---

# 2.10.1 Queue Manager

> El corazón de la capacidad Offline: Una base de datos local de "pendientes".

---

## Tecnología: Dexie.js

Usamos Dexie.js wrapper sobre IndexedDB por su facilidad de uso y performance.

```ts
import Dexie, { type Table } from 'dexie';

interface PendingRequest {
  id?: number;
  url: string;
  method: 'POST' | 'PUT' | 'DELETE';
  body: any;
  timestamp: number;
  retryCount: number;
}

export class OfflineDatabase extends Dexie {
  pendingRequests!: Table<PendingRequest>;

  constructor() {
    super('OnlyCarOfflineDB');
    this.version(1).stores({
      pendingRequests: '++id, timestamp' // Clave primaria auto-incremental
    });
  }
}
```

---

## Composable: `useSyncQueue`

Lógica para encolar y procesar.

1. **enqueue(request):** Guarda en DB y dispara sync si hay red.
2. **processQueue():** Lee todos los items, los envía secuencialmente.
   - Si falla `5xx` (Server Error): Mantiene en cola, incrementa `retryCount`.
   - Si falla `4xx` (Client Error): Descarta y notifica al usuario (no reintentable).

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.10. Estrategia_Offline]]   |
| -------------------- | ------------------------------ |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.10.2 Conflict_Resolution]] |

---
