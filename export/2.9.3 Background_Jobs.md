---
id: 2.9.3
title: Background Jobs
parent: '2.9'
breadcrumb: 0 → 2.0 → 2.9 → 2.9.3
type: especificacion
domain:
- cron
- jobs
- queue
- cloudflare
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-04 21:33
summary: 'Tareas programadas (CRON) usando Cloudflare Triggers.

  Manejo de colas para procesos asíncronos.'
content_hash: bac7d7529a7ea236
---

# 2.9.3 Background Jobs

> Procesos que corren fuera del ciclo de petición-respuesta inmediato.

---

## Scheduled Tasks (CRON)

Utilizamos la integración de **Nuxt con Cloudflare Workers** para tareas programadas.

Configuración en `nuxt.config.ts` (Experimental Nitro Feature):
```ts
nitro: {
  scheduledTasks: {
    '0 0 * * *': ['daily:cleanup-logs'], // Medianoche
    '*/10 * * * *': ['check:abandoned-carts'] // Cada 10 min
  }
}
```

### Implementación
```ts
// server/tasks/daily/cleanup-logs.ts
export default defineTask({
  meta: {
    name: 'cleanup-logs',
    description: 'Elimina logs antiguos de la DB'
  },
  async run() {
    console.log('Running daily cleanup...')
    // Lógica DB
    return { result: 'success' }
  }
})
```

---

## Colas (Message Queues)

Para tareas pesadas iniciadas por usuario (ej. "Generar Reporte PDF masivo"):

1. API Endpoint recibe petición → Inserta tarea en Tabla `jobs_queue` (Supabase).
2. Worker (CRON cada 1 min) lee `jobs_queue` pendientes.
3. Procesa y actualiza estado a `completed`.
4. Usuario recibe notificación vía WebSocket/Push.

> **Nota:** Para escala masiva, migraríamos a Cloudflare Queues o Redis, pero iniciar con Tabla SQL es suficiente y robusto (ACID).

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.9. Arquitectura_Backend]]   |
| -------------------- | ------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.9.2 Server_Middleware]]     |

---
