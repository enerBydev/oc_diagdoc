---
id: 8.5.2
title: Ciclos de Vida de Datos
parent: '8.5'
breadcrumb: 0 ‚Üí 8.0 ‚Üí 8.5 ‚Üí 8.5.2
type: hoja
domain:
- ciclos
- lifecycle
- datos
status: activo
file_create: 2026-01-26 16:29
last_updated: 2026-01-29 15:31
summary: Flujo de informaci√≥n desde creaci√≥n hasta destrucci√≥n. Fases, almacenamiento
  y procesos autom√°ticos.
content_hash: e89c28316a126dd4
---

# 8.5.2 Ciclos de Vida de Datos

> De la creaci√≥n a la destrucci√≥n segura.

---

## I. FASES DEL CICLO

```mermaid
flowchart LR
    A[üÜï Creaci√≥n] --> B[‚ö° Uso Activo]
    B --> C[üì¶ Archivo]
    C --> D[üóëÔ∏è Destrucci√≥n]
```

---

## II. DETALLE POR FASE

### Fase 1: Creaci√≥n

| Aspecto | Detalle |
|---------|---------|
| Trigger | Usuario ingresa datos / Sistema genera |
| Validaci√≥n | Esquema + Sanitizaci√≥n |
| Almacenamiento | PostgreSQL (Supabase) |
| Acceso | Full (CRUD) |
| Encriptaci√≥n | En tr√°nsito (TLS) + En reposo (AES) |

### Fase 2: Uso Activo

| Aspecto | Detalle |
|---------|---------|
| Duraci√≥n | Seg√∫n tipo (ver [[Proyecto OnlyCarNLD/Datos/8.5.1 politica_retencion]]) |
| Almacenamiento | PostgreSQL + Cache (Redis) |
| Acceso | Full (seg√∫n RLS) |
| Respaldos | Diarios |
| Monitoreo | Logs de acceso |

### Fase 3: Archivo

| Aspecto | Detalle |
|---------|---------|
| Trigger | Per√≠odo activo cumplido |
| Almacenamiento | Cloudflare R2 (Cold Storage) |
| Acceso | Solo lectura, con autorizaci√≥n |
| Formato | JSON comprimido + encriptado |
| Respaldos | Redundancia geogr√°fica |

### Fase 4: Destrucci√≥n

| Aspecto | Detalle |
|---------|---------|
| Trigger | Per√≠odo total cumplido |
| M√©todo | Overwrite + Delete |
| Certificaci√≥n | Certificado de destrucci√≥n |
| Registro | Log de auditor√≠a permanente |
| Irreversibilidad | Garantizada |

---

## III. AUTOMATIZACI√ìN

### Jobs Programados

| Job | Cron | Acci√≥n |
|-----|------|--------|
| `daily-archive` | 0 3 * * * | Mover datos a archivo |
| `monthly-purge` | 0 4 1 * * | Eliminar datos expirados |
| `quarterly-audit` | 0 5 1 */3 * | Verificar cumplimiento |

### C√≥digo del Job de Archivo

```typescript
// jobs/archive-expired.ts

import { db } from '@/lib/db';
import { uploadToR2 } from '@/lib/storage/r2';
import { RETENTION_POLICY, shouldArchive } from '@/config/retention-policy';

export async function archiveExpiredMessages() {
  // Obtener mensajes que deben archivarse
  const messages = await db.messages.findMany({
    where: {
      status: 'active',
      createdAt: {
        lt: new Date(Date.now() - RETENTION_POLICY.messages.text.active * 86400000)
      }
    },
    take: 1000
  });

  for (const message of messages) {
    // Serializar y comprimir
    const archived = JSON.stringify(message);
    const compressed = await compress(archived);
    
    // Subir a R2
    const key = `archive/messages/${message.id}.json.gz`;
    await uploadToR2(key, compressed);
    
    // Marcar como archivado
    await db.messages.update({
      where: { id: message.id },
      data: { status: 'archived', archivedAt: new Date() }
    });
  }
  
  return messages.length;
}
```

---

## IV. DESTRUCCI√ìN SEGURA

### Proceso

1. **Verificar** plazo legal cumplido
2. **Generar** lista de IDs a eliminar
3. **Sobrescribir** datos con zeros
4. **Ejecutar** DELETE en base de datos
5. **Eliminar** archivos en R2
6. **Generar** certificado de destrucci√≥n
7. **Registrar** en log de auditor√≠a

### Certificado de Destrucci√≥n

```json
{
  "certificateId": "CERT-2026-01-001",
  "timestamp": "2026-01-26T19:00:00Z",
  "dataType": "messages",
  "recordsDestroyed": 1523,
  "method": "overwrite-delete",
  "verificationHash": "sha256:abc123...",
  "retentionPeriodMet": true,
  "authorizedBy": "system-cron"
}
```

---

## V. DIAGRAMA COMPLETO

```mermaid
flowchart TD
    subgraph Creaci√≥n
        A1[Usuario ingresa datos]
        A2[Sistema genera datos]
        A1 --> A3[Validaci√≥n]
        A2 --> A3
        A3 --> A4[PostgreSQL]
    end
    
    subgraph UsoActivo["Uso Activo"]
        B1[Consultas]
        B2[Modificaciones]
        B3[Cache]
        A4 --> B1
        B1 --> B3
    end
    
    subgraph Archivo
        C1{¬øPer√≠odo activo cumplido?}
        C2[Serializar + Comprimir]
        C3[R2 Cold Storage]
        B1 --> C1
        C1 -->|S√≠| C2
        C2 --> C3
    end
    
    subgraph Destrucci√≥n
        D1{¬øPer√≠odo total cumplido?}
        D2[Sobrescribir]
        D3[Eliminar]
        D4[Certificado]
        C3 --> D1
        D1 -->|S√≠| D2
        D2 --> D3
        D3 --> D4
    end
```

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre | [[Proyecto OnlyCarNLD/Datos/8.5 retencion_datos]] |
|----------|--------------------------|
| ‚¨ÖÔ∏è Hermano anterior | [[Proyecto OnlyCarNLD/Datos/8.5.1 politica_retencion]] |

---
