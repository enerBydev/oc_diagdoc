---
id: 3.1.4.7
title: Triggers y Functions
parent: 3.1.4
breadcrumb: 0 → 3.0 → 3.1 → 3.1.4 → 3.1.4.7
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-05 12:30
domain:
- sql
- triggers
- functions
actors:
- admin
- desarrollador
summary: Triggers automáticos y funciones PostgreSQL para lógica de negocio.
content_hash: 74b545ad5eccbe91
---

# 3.1.4.7 Triggers y Functions

> Automatización de timestamps y lógica de base de datos.

---

## fn_update_timestamp

Función reutilizable para actualizar `updated_at` automáticamente.

```sql
CREATE OR REPLACE FUNCTION fn_update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## Triggers de Actualización

```sql
CREATE TRIGGER trg_servicios_updated 
  BEFORE UPDATE ON servicios 
  FOR EACH ROW EXECUTE FUNCTION fn_update_timestamp();

CREATE TRIGGER trg_paquetes_updated 
  BEFORE UPDATE ON paquetes 
  FOR EACH ROW EXECUTE FUNCTION fn_update_timestamp();

CREATE TRIGGER trg_descuentos_updated 
  BEFORE UPDATE ON descuentos 
  FOR EACH ROW EXECUTE FUNCTION fn_update_timestamp();

CREATE TRIGGER trg_empresas_updated 
  BEFORE UPDATE ON empresas 
  FOR EACH ROW EXECUTE FUNCTION fn_update_timestamp();

CREATE TRIGGER trg_config_updated 
  BEFORE UPDATE ON config_sistema 
  FOR EACH ROW EXECUTE FUNCTION fn_update_timestamp();
```

---

## Uso

Cada vez que se ejecuta un `UPDATE` en estas tablas, el campo `updated_at` se actualiza automáticamente a la fecha/hora actual sin necesidad de especificarlo en la query.

---

## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/3.1.4 esquema_sql_logica_negocio]] |
|----------|--------------------------------------|
| ⬅️ Anterior | [[Proyecto OnlyCarNLD/Datos/3.1.4.6 RLS_Policies]] |

---
