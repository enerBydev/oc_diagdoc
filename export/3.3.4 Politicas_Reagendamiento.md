---
id: 3.3.4
title: Pol√≠ticas de Reagendamiento
parent: '3.3'
breadcrumb: 0 ‚Üí 3.0 ‚Üí 3.3 ‚Üí 3.3.4
type: hoja
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-05 12:40
domain:
- negocio
- reagendar
actors:
- cliente
- admin
summary: L√≠mites y penalizaciones para reagendamiento de citas.
content_hash: a2daf8aac194dcc3
---

# 3.3.4 Pol√≠ticas de Reagendamiento

> L√≠mites y excepciones para cambios de fecha.

---

## 1. Reglas B√°sicas

| Regla | Valor |
|-------|-------|
| Reagendamientos gratis | 1 por cita |
| Penalizaci√≥n adicional | 10% por cada siguiente |
| Anticipaci√≥n m√≠nima | 12 horas |
| M√°ximo reagendamientos | 2 por cita |
| Excepciones | Clima, emergencia, operador |

---

## 2. Diagrama de Flujo

```mermaid
flowchart TD
    A[Cliente solicita reagendar] --> B{Es 1er intento?}
    B -->|S√≠| C{Anticipaci√≥n >= 12h?}
    B -->|No| D{Intentos < 2?}
    
    C -->|S√≠| E[‚úÖ Reagendar GRATIS]
    C -->|No| F[‚ö†Ô∏è Reagendar + 10% fee]
    
    D -->|S√≠| G{Anticipaci√≥n >= 12h?}
    D -->|No| H[‚ùå Rechazar - Usar cancelaci√≥n]
    
    G -->|S√≠| I[‚úÖ Reagendar + 10% fee]
    G -->|No| J[‚ö†Ô∏è Reagendar + 20% fee]
    
    E --> K[Actualizar cita]
    F --> K
    I --> K
    J --> K
    
    K --> L[Incrementar reagendamientos_count]
    L --> M[Notificar operador]
    M --> N[Enviar confirmaci√≥n cliente]
```

---

## 3. L√≥gica de Excepciones

| Caso | Acci√≥n | L√≠mite | Aprobador |
|------|--------|--------|-----------|
| Cliente B2B Corporativo | Ilimitado gratis | Sin l√≠mite | Autom√°tico |
| Operador no disponible | Reagendar sin l√≠mite | Sin l√≠mite | Sistema |
| Clima severo | Reagendar sin l√≠mite | Sin l√≠mite | Admin |
| Emergencia m√©dica | +1 reagendamiento gratis | 3 total | Admin |
| Error de sistema | Sin penalizaci√≥n | Sin l√≠mite | Sistema |

---

## 4. Modelo de Datos

```sql
-- Ya existe en tabla citas, validar columnas:
ALTER TABLE citas 
ADD COLUMN IF NOT EXISTS reagendamientos_count INTEGER DEFAULT 0;

ALTER TABLE citas 
ADD COLUMN IF NOT EXISTS reagendamiento_fee_total DECIMAL(10,2) DEFAULT 0;

-- Historial de reagendamientos
CREATE TABLE IF NOT EXISTS cita_reagendamientos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  cita_id UUID REFERENCES citas(id) ON DELETE CASCADE,
  
  fecha_original TIMESTAMPTZ NOT NULL,
  fecha_nueva TIMESTAMPTZ NOT NULL,
  
  motivo VARCHAR(50), -- 'CLIENTE', 'OPERADOR', 'SISTEMA', 'EXCEPCION'
  fee_aplicado DECIMAL(10,2) DEFAULT 0,
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 5. Integraci√≥n API

**Endpoint:** `PATCH /api/citas/:id/reagendar`

```typescript
interface ReagendarRequest {
  nueva_fecha: string; // ISO 8601
  motivo?: string;
  solicita_excepcion?: boolean;
}

interface ReagendarResponse {
  cita_id: string;
  fecha_anterior: string;
  fecha_nueva: string;
  fee_aplicado: number;
  reagendamientos_restantes: number;
}
```

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre | [[Proyecto OnlyCarNLD/Datos/3.3. reglas_negocio]] |
|----------|-------------------------|
| ‚¨ÖÔ∏è Anterior | [[Proyecto OnlyCarNLD/Datos/3.3.3 Politicas_Cancelacion]] |
| ‚û°Ô∏è Siguiente | [[Proyecto OnlyCarNLD/Datos/3.3.5 Horarios_Disponibilidad]] |
| üîó Relacionado | [[Proyecto OnlyCarNLD/Datos/1.3.6.1 asignacion_citas]] |

---

