---
id: 5.8.1.1
title: Permisos GPS
parent: 5.8.1
breadcrumb: 0 ‚Üí 5.0 ‚Üí 5.8 ‚Üí 5.8.1 ‚Üí 5.8.1.1
type: configuracion
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:10
domain:
- gps
- permisos
- capacitor
summary: Manejo de permisos GPS en iOS y Android.
content_hash: e36899d3fd4f8f39
---

# 5.8.1.1 Permisos GPS

Manejo de permisos de geolocalizaci√≥n en iOS y Android.

---

## Flujo de Permisos

```mermaid
stateDiagram-v2
    [*] --> verificar_permiso
    verificar_permiso --> granted: Ya tiene permiso
    verificar_permiso --> prompt: No ha respondido
    verificar_permiso --> denied: Denegado previamente
    
    prompt --> solicitar_permiso
    solicitar_permiso --> granted: Usuario acepta
    solicitar_permiso --> denied: Usuario rechaza
    
    denied --> mostrar_explicacion
    mostrar_explicacion --> abrir_settings: Usuario quiere dar permiso
    abrir_settings --> verificar_permiso: Regresa a app
    
    granted --> tracking_activo
```

---

## Composable de Permisos

```typescript
// composables/useGeoPermissions.ts
import { Geolocation } from '@capacitor/geolocation';

type PermissionState = 'granted' | 'denied' | 'prompt';

export const useGeoPermissions = () => {
  const permissionStatus = ref<PermissionState>('prompt');
  const hasPermission = computed(() => permissionStatus.value === 'granted');
  
  /**
   * Verificar estado actual del permiso
   */
  const checkPermission = async (): Promise<PermissionState> => {
    const status = await Geolocation.checkPermissions();
    permissionStatus.value = status.location as PermissionState;
    return permissionStatus.value;
  };
  
  /**
   * Solicitar permiso al usuario
   */
  const requestPermission = async (): Promise<boolean> => {
    const status = await Geolocation.requestPermissions();
    permissionStatus.value = status.location as PermissionState;
    return permissionStatus.value === 'granted';
  };
  
  /**
   * Abrir configuraci√≥n del sistema (si deneg√≥ permanentemente)
   */
  const openSettings = async () => {
    // En Capacitor, usamos @capacitor/app-launcher o similar
    // Fallback: mostrar instrucciones manuales
    if (Capacitor.isNativePlatform()) {
      await NativeSettings.open({
        optionAndroid: AndroidSettings.ApplicationDetails,
        optionIOS: IOSSettings.App
      });
    }
  };
  
  return {
    permissionStatus: readonly(permissionStatus),
    hasPermission,
    checkPermission,
    requestPermission,
    openSettings
  };
};
```

---

## Componente de Solicitud

```vue
<!-- components/GeoPermissionRequest.vue -->
<script setup lang="ts">
const { permissionStatus, hasPermission, checkPermission, requestPermission, openSettings } = useGeoPermissions();

const showExplanation = ref(false);

onMounted(async () => {
  await checkPermission();
  
  if (permissionStatus.value === 'denied') {
    showExplanation.value = true;
  }
});

const handleRequestPermission = async () => {
  showExplanation.value = false;
  const granted = await requestPermission();
  
  if (!granted) {
    showExplanation.value = true;
  }
};
</script>

<template>
  <!-- Modal de explicaci√≥n -->
  <Modal v-if="showExplanation" @close="showExplanation = false">
    <template #header>
      üìç Necesitamos tu ubicaci√≥n
    </template>
    
    <template #body>
      <div class="permission-explanation">
        <p>Para que el cliente pueda ver tu ruta en tiempo real, 
           necesitamos acceso a tu ubicaci√≥n.</p>
        
        <ul class="benefits">
          <li>‚úÖ El cliente ve cu√°ndo llegar√°s</li>
          <li>‚úÖ Confirma llegada autom√°ticamente</li>
          <li>‚úÖ Solo se usa durante el servicio</li>
        </ul>
        
        <p class="privacy">
          üîí Tu ubicaci√≥n solo se comparte mientras est√°s "en camino"
        </p>
      </div>
    </template>
    
    <template #footer>
      <button 
        v-if="permissionStatus === 'prompt'"
        @click="handleRequestPermission"
        class="btn-primary"
      >
        Permitir ubicaci√≥n
      </button>
      
      <button 
        v-else-if="permissionStatus === 'denied'"
        @click="openSettings"
        class="btn-secondary"
      >
        Abrir configuraci√≥n
      </button>
    </template>
  </Modal>
  
  <!-- Indicador de estado -->
  <div v-if="hasPermission" class="permission-granted">
    ‚úÖ Ubicaci√≥n activa
  </div>
</template>
```

---

## Configuraci√≥n por Plataforma

### Android

```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<manifest>
  <!-- Permiso b√°sico -->
  <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
  
  <!-- Permiso de alta precisi√≥n (GPS) -->
  <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
  
  <!-- NO necesitamos background location -->
  <!-- android:name="android.permission.ACCESS_BACKGROUND_LOCATION" -->
</manifest>
```

### iOS

```xml
<!-- ios/App/App/Info.plist -->
<plist>
  <dict>
    <!-- Permiso mientras usa la app -->
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>OnlyCar usa tu ubicaci√≥n para mostrar al cliente tu ruta en tiempo real durante el servicio.</string>
    
    <!-- Descripci√≥n corta ‚Üí mejor UX -->
    <key>NSLocationUsageDescription</key>
    <string>Para compartir tu ubicaci√≥n con el cliente</string>
  </dict>
</plist>
```

---

## Textos Localizados

```typescript
// i18n/es/geo.ts
export default {
  permission: {
    title: 'üìç Necesitamos tu ubicaci√≥n',
    body: 'Para que el cliente pueda ver tu ruta en tiempo real.',
    benefits: [
      'El cliente ve cu√°ndo llegar√°s',
      'Confirma llegada autom√°ticamente',
      'Solo se usa durante el servicio'
    ],
    privacy: 'Tu ubicaci√≥n solo se comparte mientras est√°s "en camino"',
    allow: 'Permitir ubicaci√≥n',
    openSettings: 'Abrir configuraci√≥n',
    denied: 'Permiso denegado. Abre configuraci√≥n para activarlo.'
  }
};
```

---

## Buenas Pr√°cticas


| Pr√°ctica | Raz√≥n |
|----------|-------|
| Explicar **antes** de pedir | Mayor tasa de aceptaci√≥n |
| Mostrar **beneficios claros** | Usuario entiende el valor |
| **No pedir en pantalla inicial** | Esperar contexto relevante |
| Ofrecer **fallback** si rechaza | No bloquear funcionalidad |
| Usar permiso **m√≠nimo necesario** | Solo `whenInUse`, no background |

---

‚Üí Ver tracking: [[Proyecto OnlyCarNLD/Datos/5.8.1.2 watch_position]]

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.1 capacitor_geolocation]]            |
| -------------------- | ---------------------- |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.1.2 watch_position]]              |
