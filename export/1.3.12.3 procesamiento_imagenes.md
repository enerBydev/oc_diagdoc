---
id: 1.3.12.3
title: Procesamiento de Im√°genes
parent: 1.3.12
breadcrumb: 0 ‚Üí 1.0 ‚Üí 1.3 ‚Üí 1.3.12 ‚Üí 1.3.12.3
type: hoja
status: activo
domain: comunicacion
summary: Pipeline de optimizaci√≥n de im√°genes con HEIC a JPEG, resize, compresi√≥n
  y generaci√≥n de thumbnails.
version: 1.0
last_updated: 2026-01-29 15:31
file_create: 2025-12-26 12:00
actors:
- sistema
dependencies:
- heic2any
affects:
- 1.3.12 upload_multimedia
content_hash: 23b1433a44c2a0c1
---

# 1.3.12.3 Procesamiento de Im√°genes

Pipeline de optimizaci√≥n antes de subir.

---

## Pipeline

```mermaid
flowchart LR
    A[üì∑ Original] --> B[HEIC‚ÜíJPEG]
    B --> C[Resize 2048px]
    C --> D[Compress 80%]
    D --> E[Generate Thumb 400px]
    E --> F[‚òÅÔ∏è Upload R2]
```

---

## Funciones

### HEIC a JPEG

```typescript
import heic2any from 'heic2any';

export const heicToJpeg = async (file: File): Promise<Blob> => {
  if (!file.type.includes('heic')) return file;
  
  return await heic2any({
    blob: file,
    toType: 'image/jpeg',
    quality: 0.9
  });
};
```

### Resize

```typescript
export const resizeImage = async (
  file: Blob, 
  opts: { maxWidth: number; maxHeight: number }
): Promise<Blob> => {
  const img = await createImageBitmap(file);
  
  let { width, height } = img;
  const ratio = Math.min(
    opts.maxWidth / width, 
    opts.maxHeight / height
  );
  
  if (ratio < 1) {
    width *= ratio;
    height *= ratio;
  }
  
  const canvas = new OffscreenCanvas(width, height);
  const ctx = canvas.getContext('2d')!;
  ctx.drawImage(img, 0, 0, width, height);
  
  return await canvas.convertToBlob({ type: 'image/jpeg' });
};
```

### Compresi√≥n

```typescript
export const compressImage = async (
  file: Blob, 
  quality: number = 0.8
): Promise<Blob> => {
  const img = await createImageBitmap(file);
  const canvas = new OffscreenCanvas(img.width, img.height);
  const ctx = canvas.getContext('2d')!;
  ctx.drawImage(img, 0, 0);
  
  return await canvas.convertToBlob({ 
    type: 'image/jpeg', 
    quality 
  });
};
```

---

## Especificaciones

| Par√°metro | Valor |
|-----------|-------|
| Max resolution | 2048 √ó 2048 px |
| Thumbnail | 400 √ó 400 px |
| Quality | 80% |
| Format | JPEG always |
| Max file size | ~1 MB result |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/1.3.12 upload_multimedia]]          |
| -------------------- | ------------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.3.12.2 upload_ui]]                |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.3.12.4 indicadores_progreso]]     |

---
