---
id: 3.6.2
title: Detección de Anomalías
parent: '3.6'
breadcrumb: 0 → 3.0 → 3.6 → 3.6.2
type: hoja
status: activo
file_create: 2026-01-14 15:15
domain:
- seguridad
- fraude
- monitoreo
actors:
- sistema
- security_bot
summary: Algoritmos Watchdog que monitorean discrepancias silenciosas, data drift
  y patrones de fraude.
last_updated: 2026-01-29 15:32
content_hash: 68160363961be0c0
---

# 3.6.2 Detección de Anomalías

> **Misión:** Identificar "humo" antes de que haya "fuego". Monitoreo proactivo de patrones sospechosos.

---

## Watchdogs Activos

### 1. Integridad Referencial (`wd_ref_integrity`)
*   **Frecuencia:** Cada 1 hora.
*   **Check:** Verifica que todos los `parent_id` apunten a registros existentes.
*   **Acción:** Alerta a Sentry + Cuarentena de registro.

### 2. Deriva de Datos (`wd_data_drift`)
*   **Frecuencia:** Diario.
*   **Check:** Compara media móvil de precios y tiempos vs histórico de 30 días.
*   **Trigger:** Desviación estándar > 3 sigma.

### 3. Heurísticas de Fraude Operativo (`wd_fraud_ops`)
*   **Frecuencia:** Real-time (post-servicio).
*   **Patrones:**
    *   "Servicio Relámpago": Duración < 10 min en servicio de 1 hora.
    *   "Ubicación Fantasma": Coordenadas GPS servicio vs Coordenadas GPS Cita > 500m.
    *   "Cancelación Sospechosa": Operador llega, cancela y cliente desaparece (posible arreglo off-platform).

---

## Modelo de Datos (Alertas)

> [!SUCCESS]
> **Persistencia:** Las anomalías se registran en la tabla `anomalias_detectadas`.
> Ver definición SQL: [[Proyecto OnlyCarNLD/Datos/3.1.4.8 Tablas_Quantum#anomalias_detectadas|3.1.4.8]]

```mermaid
sequenceDiagram
    participant Watchdog
    participant DB as Base de Datos
    participant AlertSystem as Sentry/Slack
    participant Ops

    loop Every Hour
        Watchdog->>DB: Scan Ref Integrity (Parents exist?)
        alt Integrity OK
            Watchdog->>DB: Log OK
        else Orphan Found
            Watchdog->>DB: Insert into anomalias_detectadas
            Watchdog->>AlertSystem: Trigger Alert (Sev 3)
            AlertSystem->>Ops: Notificación "Orphan Record"
            Note over Ops: Investigación manual
        end
    end
```

---

## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/3.6. Auditoria_Logica]] |
|----------|---------------------------|
| ⬅️ Hermano | [[Proyecto OnlyCarNLD/Datos/3.6.1 invariantes_sistema]] |
| ➡️ Hermano | [[Proyecto OnlyCarNLD/Datos/3.6.3 trazabilidad_decisiones]] |

---
