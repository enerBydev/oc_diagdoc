---
id: 3.1.8.2.1
title: Corte Semanal
parent: 3.1.8.2
breadcrumb: 0 โ 3.0 โ 3.1 โ 3.1.8 โ 3.1.8.2 โ 3.1.8.2.1
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 14:09
domain:
- cortes
- pagos
- semanal
actors:
- admin
- operador
summary: 'Proceso de cierre y cรกlculo de pago semanal.

  Viernes 23:59 corte, sรกbado 00:01 pago depositado.'
content_hash: 2c160fd0c2300c74
---

# 3.1.8.2.1 Corte Semanal

Proceso de cierre y cรกlculo de pago semanal.

---

## Horario de Corte

| Evento | Horario |
|--------|---------|
| Fin semana laboral | Viernes 23:59 |
| Corte automรกtico | Sรกbado 00:00 |
| Pago depositado | Sรกbado 00:01 |
| Disponible cuenta | Sรกbado ~6:00 AM |

---

## Proceso de Corte

```typescript
// Cron job: Sรกbado 00:00
const ejecutarCorteSemanal = async () => {
  const viernes = endOfDay(previousFriday(new Date()));
  const lunes = startOfWeek(viernes, { weekStartsOn: 1 });
  
  // Obtener operadores activos
  const { data: operadores } = await supabase
    .from('operadores')
    .select('id, nivel, cuenta_bancaria')
    .eq('estado', 'activo');
  
  for (const operador of operadores) {
    // 1. Verificar caja liquidada
    const cajaPendiente = await getCajaPendiente(operador.id);
    if (cajaPendiente > 0) {
      await registrarPagoRetenido(operador.id, 'caja_pendiente');
      continue;
    }
    
    // 2. Calcular ganancias de la semana
    const { data: servicios } = await supabase
      .from('citas')
      .select('precio_total')
      .eq('operador_id', operador.id)
      .eq('estado', 'completado')
      .gte('completado_at', lunes)
      .lte('completado_at', viernes);
    
    const ingresosBrutos = servicios.reduce((s, c) => s + c.precio_total, 0);
    
    // 3. Calcular comisiรณn
    const comision = await calcularComisionFinal(operador.id);
    const pagoNeto = ingresosBrutos * (comision.comisionFinal / 100);
    
    // 4. Deducir financiamientos si aplica
    const deduccion = await getDeduccionFinanciamiento(operador.id);
    const pagoFinal = pagoNeto - deduccion;
    
    // 5. Procesar pago
    await procesarPago(operador.id, {
      bruto: ingresosBrutos,
      comisionPct: comision.comisionFinal,
      neto: pagoNeto,
      deduccion,
      final: pagoFinal,
      metodo: operador.cuenta_bancaria.tipo,
      destino: operador.cuenta_bancaria.clabe
    });
  }
};
```

---

## UI: Resumen de Corte

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฐ CORTE SEMANAL                      16-20 Diciembre 2024     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  RESUMEN:                                                       โ
โ                                                                 โ
โ  Servicios completados:        12                               โ
โ  Ingresos brutos:              $3,480                           โ
โ                                                                 โ
โ  Tu comisiรณn (74%):            $2,575.20                        โ
โ                                                                 โ
โ  Deducciones:                                                   โ
โ  โโโ Financiamiento Ryobi:     -$386.28                         โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  ๐ต PAGO FINAL:                $2,188.92                        โ
โ                                                                 โ
โ  Estado: โ DEPOSITADO                                          โ
โ  Destino: ****4521 (BBVA)                                       โ
โ  Hora: Sรกbado 00:01                                             โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Navegaciรณn

| โฌ๏ธ Padre             | [[Proyecto OnlyCarNLD/Datos/3.1.8.2 pagos_operador]]     |
| -------------------- | ------------------------------ |
| โก๏ธ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.8.2.2 metodos_pago]]     |

---
