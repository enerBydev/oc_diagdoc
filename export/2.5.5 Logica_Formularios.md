---
id: 2.5.5
title: Lógica de Formularios
parent: '2.5'
breadcrumb: 0 → 2.0 → 2.5 → 2.5.5
type: arquitectura
status: activo
domain:
- frontend
- forms
- validacion
- vee-validate
- zod
summary: Estrategia de gestión de formularios usando VeeValidate 4 y Zod. Patrones
  de validación, manejo de errores y composables.
last_updated: 2026-01-29 15:32
content_hash: cf7fbb0814c82e7b
---

# 2.5.5 Lógica de Formularios

> Estandarización de la captura de datos y validación en el frontend.

---

## Stack Tecnológico

1.  **VeeValidate 4**: Gestión de estado del formulario, tracking de cambios (`dirty`, `touched`) y envío.
2.  **Zod**: Definición de esquemas de validación (Schemas) robustos y tipados.
3.  **Nuxt UI / Componentes Core**: Renderizado visual de los inputs.

---

## Patrón de Implementación

Utilizamos el patrón **Composition API** para desacoplar la lógica de validación de la UI.

### 1. Definición del Schema (Zod)
Los schemas deben vivir en `~/schemas/` o coubicados si son muy específicos.

```typescript
// schemas/auth.ts
import { z } from 'zod';

export const LoginSchema = z.object({
  email: z.string().email('Correo inválido').min(1, 'Requerido'),
  password: z.string().min(8, 'Mínimo 8 caracteres'),
});
```

### 2. Uso en Componente (`useForm`)

```vue
<script setup lang="ts">
import { useForm } from 'vee-validate';
import { toTypedSchema } from '@vee-validate/zod';
import { LoginSchema } from '~/schemas/auth';

const { handleSubmit, errors, defineField } = useForm({
  validationSchema: toTypedSchema(LoginSchema),
});

const [email, emailProps] = defineField('email');
const [password, passwordProps] = defineField('password');

const onSubmit = handleSubmit(async (values) => {
  // values ya está tipado correctamente gracias a Zod
  await authStore.login(values);
});
</script>
```

---

## Componentes Integrados

Nuestros componentes `<BaseInput>` están diseñados para trabajar directamente con este patrón, aceptando `v-model` y props de error.

```vue
<BaseInput 
  v-model="email" 
  v-bind="emailProps" 
  label="Correo Electrónico" 
  :error-message="errors.email" 
/>
```

---

## Manejo de Errores del Servidor

Cuando el backend retorna un error (ej. 422 Unprocessable Entity), debemos mapearlo a los campos del formulario manualmente o mediante un utilitario global.

- **`setErrors()`**: Función de VeeValidate para poblar errores desde respuesta API.
- **Interceptor Global**: En `$fetch`, capturar 422 y formatear la respuesta para que `setErrors` la consuma.

---

## Formularios Multi-paso (Wizards)

Para formularios complejos (ej. Registro de Operador):
1.  Mantener el estado en un `Store` (Pinia) `useRegistrationStore`.
2.  Cada paso valida solo su sub-schema.
3.  Persistencia en `localStorage` (opcional) para evitar pérdida de datos si se recarga.

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.5. Arquitectura_Frontend]] |
| -------------------- | ------------------------------ |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.5.4 Componentes_Core]]     |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.5.6 Data_Fetching]]        |

---
