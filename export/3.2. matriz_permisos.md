---
id: 3.2
title: Matriz de Permisos
parent: '3.0'
breadcrumb: 0 ‚Üí 3.0 ‚Üí 3.2
type: modulo_padre
children_count: 7
descendants_count: 11
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-12 11:33
domain:
- permisos
- rbac
- rls
- seguridad
summary: 'Definici√≥n de qui√©n puede hacer qu√© en el sistema.

  Matriz de permisos por rol y recurso. Base para RLS.'
content_hash: c9431ab4881cd87d
---

# 3.2 Matriz de Permisos

> Qui√©n puede hacer qu√© en el sistema.

---

## Roles del Sistema

| Rol | Descripci√≥n |
|-----|-------------|
| **Admin** | Acceso total, gesti√≥n operadores, reportes |
| **Operador** | PWA UMT, servicios asignados, caja |
| **Cliente B2C** | Agenda, historial, pagos personales |
| **Cliente B2B** | Contratos, empleados, reportes empresa |
| **Corporate+** | B2B + beneficios exclusivos |

---

## Matriz de Permisos (Resumen)

| Recurso | Admin | Operador | B2C | B2B |
|---------|-------|----------|-----|-----|
| **Dashboard completo** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **PWA UMT** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **Servicios (todos)** | ‚úÖ | üîí Asignados | üîí Propios | üîí Empresa |
| **Reportes globales** | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| **Contratos B2B** | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ |
| **Facturaci√≥n** | ‚úÖ | ‚ùå | ‚ùå | üîí Empresa |
| **Empleados empresa** | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| **Control de caja** | ‚úÖ | üîí Propia | ‚ùå | ‚ùå |

**Leyenda:** ‚úÖ Completo | üîí Restringido a propios | ‚ùå Sin acceso

---

## Implementaci√≥n RLS

```sql
-- Ejemplo: servicios visibles seg√∫n rol
CREATE POLICY "servicios_por_rol" ON servicios
FOR SELECT USING (
  CASE 
    WHEN auth.jwt() ->> 'role' = 'admin' THEN true
    WHEN auth.jwt() ->> 'role' = 'operador' THEN operador_id = auth.uid()
    WHEN auth.jwt() ->> 'role' = 'cliente_b2c' THEN cliente_id = auth.uid()
    WHEN auth.jwt() ->> 'role' = 'cliente_b2b' THEN empresa_id = (SELECT empresa_id FROM users WHERE id = auth.uid())
    ELSE false
  END
);
```

---

## Estructura de Hijos (Deep Dive)

| ID                                       | Nombre              | Descripci√≥n                   | Nietos | Estado |
| ---------------------------------------- | ------------------- | ----------------------------- | ------ | ------ |
| [[Proyecto OnlyCarNLD/Datos/3.2.1 Permisos_Admin\|3.2.1]]          | Permisos Admin      | CRUD completo todas entidades | 0      | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.2 Permisos_Operador\|3.2.2]]       | Permisos Operador   | PWA, caja personal, servicios | 0      | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.3 Permisos_Cliente_B2C\|3.2.3]]    | Permisos B2C        | Agenda, historial, pagos      | 0      | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.4 Permisos_Cliente_B2B\|3.2.4]]    | Permisos B2B        | Empresa, empleados, reportes  | 0      | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.5 Permisos_Corporate_Plus\|3.2.5]] | Permisos Corporate+ | B2B + beneficios exclusivos   | 0      | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.6 RLS_Policies_Completo\|3.2.6]]   | RLS Policies        | C√≥digo SQL completo           | 0 | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.2.7 Matriz_Visual\|3.2.7]]           | Matriz Visual       | Tabla recursos √ó roles        | 0      | ‚úÖ      |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/3.0. datos_y_logica]]          |
| -------------------- | -------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/3.1. Logica_Negocio_Core]]     |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.3. reglas_negocio]]          |

---
