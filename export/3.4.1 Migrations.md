---
id: 3.4.1
title: Migrations
parent: '3.4'
breadcrumb: 0 → 3.0 → 3.4 → 3.4.1
type: proceso
status: activo
domain:
- sql
- migraciones
- supabase-cli
- git
summary: Flujo de trabajo para cambios en el esquema de base de datos usando Supabase
  CLI y migraciones SQL versionadas.
last_updated: 2026-01-29 15:32
content_hash: b7a12f911fad0f0b
---

# 3.4.1 Migrations

> Control de cambios evolutivo para la estructura de la base de datos.

---

## Flujo de Trabajo (Workflow)

No editamos tablas directamente en el Dashboard de Supabase en Producción. Todo cambio debe venir de código.

### 1. Iniciar Cambio Local
```bash
supabase migration new agregar_tabla_vehiculos
# Esto crea supabase/migrations/<YYYYMMDDHHMMSS>_agregar_tabla_vehiculos.sql
```

> **Convención:** `YYYYMMDDHHMMSS_descripcion_breve.sql`

### 2. Escribir SQL
Editar el archivo generado con las sentencias DDL.

```sql
CREATE TABLE public.vehiculos (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  placa text UNIQUE NOT NULL,
  modelo text NOT NULL
);
```

### 3. Aplicar y Probar Localmente
```bash
supabase db reset
# Aplica todas las migraciones desde cero en el contenedor local
```

### 4. Push a Producción (CI/CD)
Al hacer merge a `main`, GitHub Actions ejecuta:
```bash
supabase db push
```
Esto aplica solo las migraciones pendientes en la base de datos remota.

---

## Reglas de Oro

1.  **Nunca modificar una migración ya aplicada**: Si te equivocaste, crea una nueva migración `fix_previous_error`.
2.  **Idempotencia**: Si es posible, usar `CREATE TABLE IF NOT EXISTS` o manejar excepciones, aunque Supabase trakea qué archivos ya corrieron.
3.  **Destructividad**: Evitar `DROP COLUMN` sin un plan de respaldo de datos previo.

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/3.4. Administracion_DB]] |
| -------------------- | -------------------------- |
| ⬅️ Hermano anterior  | -                          |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.4.2 Seeds_Por_Ambiente]] |

---
