# SUMMARY: 3.0 Datos y L√≥gica

## üî¨ RADIOGRAF√çA MOLECULAR DEL M√ìDULO 3.0

> **An√°lisis forense algor√≠tmico:** 2026-01-28 01:36
> **Herramientas:** `tree_viewer.py`, `dependency_mapper.py`, `project_stats.py`

### Esencia Nuclear

**El CEREBRO del sistema OnlyCar.** Este m√≥dulo contiene toda la l√≥gica de negocio estructurada: configuraci√≥n de precios en JSON (cat√°logo de servicios), esquemas SQL para PostgreSQL, sistema de costos y m√°rgenes de operador, remuneraci√≥n por experiencia (escala 43-73% en 7 niveles), control de caja (efectivo/tarjeta), financiamiento de equipamiento para operadores, marketplace interno, y sistema de beneficios laborales voluntarios (seguro, aguinaldo, vacaciones, semanas IMSS).

**Expansi√≥n Cu√°ntica:** Integra simulaci√≥n financiera con escenarios Monte Carlo (3.5), auditor√≠a l√≥gica con invariantes inquebrantables (3.6), y l√≥gica avanzada de autosuficiencia con Dynamic Pricing (3.1.11.6).

### M√©tricas At√≥micas

| M√©trica | Valor |
|---------|-------|
| Archivos totales | 194 |
| Hijos directos | 6 |
| Descendientes | 193 |
| Profundidad m√°xima | 4 niveles |
| % del proyecto | 23% |

### √Årbol Jer√°rquico (Nivel 1)

```
3.0 Datos y L√≥gica (194 archivos)
‚îú‚îÄ‚îÄ 3.1 L√≥gica de Negocio Core (137 desc) ‚îÄ Precios, SQL, costos, remuneraci√≥n, caja, marketplace
‚îú‚îÄ‚îÄ 3.2 Matriz de Permisos (11 desc) ‚îÄ RLS, roles, acceso por recurso
‚îú‚îÄ‚îÄ 3.3 Reglas de Negocio (10 desc) ‚îÄ Validaciones, pol√≠ticas, feature flags
‚îú‚îÄ‚îÄ 3.4 Administraci√≥n DB (6 desc) ‚îÄ Migrations, seeds, backup, disaster recovery
‚îú‚îÄ‚îÄ 3.5 Simulaci√≥n Financiera (3 desc) ‚îÄ Monte Carlo, breakeven, stress test
‚îî‚îÄ‚îÄ 3.6 Auditor√≠a L√≥gica (3 desc) ‚îÄ Invariantes, anomal√≠as, trazabilidad
```

### Mapa de Dependencias

- **Depende de:** [[Proyecto OnlyCarNLD/Datos/2.0. tecnologia]], [[Proyecto OnlyCarNLD/Datos/4.6 API_Specification]]
- **Es usado por:** [[Proyecto OnlyCarNLD/Datos/1.0. identidad_y_contexto]], [[Proyecto OnlyCarNLD/Datos/5.0. integraciones]], [[Proyecto OnlyCarNLD/Datos/8.0. legal_cumplimiento]]
- **Archivos cr√≠ticos:** [[Proyecto OnlyCarNLD/Datos/3.1.1 config_precios_v3.2]], [[Proyecto OnlyCarNLD/Datos/3.1.8 sistema_remuneracion]], [[Proyecto OnlyCarNLD/Datos/3.6.1 invariantes_sistema]]

### Conceptos Nucleares

1. **Comisi√≥n H√≠brida:** Modelo max(Garant√≠a Base, Comisi√≥n Variable) para operadores
2. **Escala 7 Niveles:** Pirita(43%) ‚Üí Diamante(73%) seg√∫n experiencia acumulada
3. **Invariantes:** Reglas de negocio inquebrantables codificadas en 3.6.1
4. **Dynamic Pricing:** Ajuste de precios en tiempo real por oferta/demanda
5. **Control de Caja:** Liquidaci√≥n de efectivo recaudado por operadores

---

> Resumen ejecutivo del m√≥dulo 3.0 para contexto r√°pido de IA.

---

## Estad√≠sticas (DATOS VIVOS)

| M√©trica | Valor |
|---------|-------|
| Total archivos | 194 |
| Estados | 123 activo, 38 preparado, 16 futuro |
| Profundidad m√°xima | 4 niveles (ej: 3.1.10.1.1) |
| Porcentaje del proyecto | 22% (segundo m√°s grande) |

---

## Prop√≥sito del M√≥dulo

Define el **CEREBRO** del sistema OnlyCar. Contiene toda la l√≥gica de negocio estructurada: configuraci√≥n de precios, esquemas de base de datos, sistema de costos y m√°rgenes, remuneraci√≥n de operadores, control de caja, financiamiento y beneficios laborales.

**Expansi√≥n Cu√°ntica:** Integra l√≥gica avanzada de Autosuficiencia (en 3.1.11.6), Simulaci√≥n Financiera (3.5) y Auditor√≠a L√≥gica (3.6).

**Seguridad:** Toda la l√≥gica de negocio se almacena en Supabase/PostgreSQL con RLS por rol, cifrado TLS+AES-256, y Cloudflare Zero Trust.

---

## Estructura Jer√°rquica Completa

### 3.1 L√≥gica de Negocio Core (137 descendientes) ‚≠ê

El subm√≥dulo m√°s grande del proyecto. Contiene toda la l√≥gica de negocio, reglas de precios y esquemas financieros.

| Subm√≥dulo                                    | Descripci√≥n                                      | Hijos                              |     |
| -------------------------------------------- | ------------------------------------------------ | ---------------------------------- | --- |
| [[Proyecto OnlyCarNLD/Datos/3.1.1 config_precios_v3.2]]                | JSON de precios y cat√°logo                       | 0                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.2 config_precios_v3.2_description]]    | Documentaci√≥n de config                          | 0                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.3 config_precios_v3.2_historyVersion]] | Changelog de precios                             | 0                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.4 esquema_sql_logica_negocio]]         | **Tablas SQL core**                              | 8                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.5 api_logica_negocio]]                 | **Algoritmos API backend** (Ver Spec en [[4.6]]) | 6                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.6 datos_iniciales_seed]]               | Script de poblaci√≥n inicial                      | 0                                  |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.7 sistema_costos]]                     | **C√°lculo de costos y m√°rgenes**                 | 22                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.8 sistema_remuneracion]]               | **Comisiones operador**                          | 14                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.9 control_caja]]                       | **Gesti√≥n efectivo/tarjeta**                     | 10                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.10 sistema_financiamiento]]            | Pr√©stamos equipamiento                           | 16                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.11 marketplace_operadores]]            | Productos y kits                                 | 25                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.12 beneficios_laborales]]              | Seguro, aguinaldo, vacaciones                    | 11                                 |     |
| [[Proyecto OnlyCarNLD/Datos/3.1.13 sistema_ganancias_fundador]]        | Ganancias Fundador                               | Compensaci√≥n, dividendos, reservas | 6   |
| [[Proyecto OnlyCarNLD/Datos/3.1.14 finanzas_corporativas]]             | Finanzas Corporativas                            | Balance, flujo, KPIs, tesorer√≠a    | 4   |
| [[Proyecto OnlyCarNLD/Datos/3.1.15 estructura_organizacional]]         | Estructura Organizacional                        | Roles, fases, n√≥mina               | 5   |

**Subm√≥dulos Clave Integrados:**
*   **[[Proyecto OnlyCarNLD/Datos/3.1.11.6 Logica_Gestion_Recursos]]**: Algoritmos de Autosuficiencia, Dynamic Pricing y Balanceo de Carga.
*   **[[Proyecto OnlyCarNLD/Datos/3.1.11.7 Gestion_Almacen_Central]]**: Gesti√≥n de inventario dark store y reabastecimiento.

---

### 3.2 Matriz de Permisos (11 descendientes)

Row Level Security y control de acceso.

| Subm√≥dulo | Descripci√≥n | Hijos |
| --- | --- | --- |
| [[Proyecto OnlyCarNLD/Datos/3.2.1 Permisos_Admin]] | Permisos super_admin | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.2.2 Permisos_Operador]] | Permisos operador | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.2.3 Permisos_Cliente_B2C]] | Permisos cliente individual | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.2.4 Permisos_Cliente_B2B]] | Permisos empresa | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.2.5 Permisos_Corporate_Plus]] | Permisos empleado B2B | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.2.6 RLS_Policies_Completo]] | **Pol√≠ticas RLS detalladas** | 4 |
| [[Proyecto OnlyCarNLD/Datos/3.2.7 Matriz_Visual]] | Tabla interactiva recursos√óroles | 0 |

---

### 3.3 Reglas de Negocio (10 descendientes)
 
 Reglas de validaci√≥n, pol√≠ticas operativas y feature flags.
 
 | Subm√≥dulo | Descripci√≥n | Hijos |
 |-----------|-------------|-------|
 | [[Proyecto OnlyCarNLD/Datos/3.3.1 Validaciones_Frontend]] | Schemas Zod y m√°scaras | 3 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.2 Validaciones_Backend]] | Validaciones servidor | 0 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.3 Politicas_Cancelacion]] | Costos y penalizaciones | 0 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.4 Politicas_Reagendamiento]] | Reglas de cambio de cita | 0 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.5 Horarios_Disponibilidad]] | Bloques de tiempo | 0 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.6 Radio_Servicio]] | L√≠mites geogr√°ficos | 0 |
 | [[Proyecto OnlyCarNLD/Datos/3.3.7 Feature_Flags]] | Toggle de funcionalidades | 0 |

---

### 3.4 Administraci√≥n de Base de Datos (6 descendientes) üõ°Ô∏è

Estrategias de DevOps para garantizar la integridad de los datos.

| Subm√≥dulo | Descripci√≥n | Hijos |
|-----------|-------------|-------|
| [[Proyecto OnlyCarNLD/Datos/3.4.1 Migrations]] | Flujo de trabajo de migraciones SQL | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.4.2 Seeds_Por_Ambiente]] | Datos de prueba vs producci√≥n | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.4.3 Backup_Strategy]] | PITR y respaldos en fr√≠o (R2) | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.4.4 Disaster_Recovery]] | Plan de contingencia RTO/RPO | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.4.5 Versionado_Esquema]] | Estrategia de evoluci√≥n sin downtime | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.4.6 Modelo_ER_Global]] | Diagrama ER Maestro | 0 |

---

### 3.5 Simulaci√≥n Financiera (3 descendientes) üîÆ

El Or√°culo. Entorno de pruebas y predicci√≥n "What-If", integrando m√©todos estoc√°sticos (Monte Carlo).

| Subm√≥dulo | Descripci√≥n | Hijos |
|-----------|-------------|-------|
| [[Proyecto OnlyCarNLD/Datos/3.5.1 escenarios_montecarlo]] | Proyecciones probabil√≠sticas | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.5.2 analisis_breakeven]] | Punto de equilibrio din√°mico | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.5.3 stress_test_financiero]] | Resiliencia ante crisis | 0 |

---

### 3.6 Auditor√≠a L√≥gica (3 descendientes) ‚öñÔ∏è

El Juez. Garantiza la integridad inmutable de las reglas del negocio.

| Subm√≥dulo | Descripci√≥n | Hijos |
|-----------|-------------|-------|
| [[Proyecto OnlyCarNLD/Datos/3.6.1 invariantes_sistema]] | Reglas inquebrantables | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.6.2 deteccion_anomalias]] | Watchdogs antifraude | 0 |
| [[Proyecto OnlyCarNLD/Datos/3.6.3 trazabilidad_decisiones]] | Caja negra de decisiones | 0 |

---

## Archivos Cr√≠ticos (Top 10)

| #   | Archivo                              | Descripci√≥n                       | Desc |
| --- | ------------------------------------ | --------------------------------- | ---- |
| 1   | [[Proyecto OnlyCarNLD/Datos/3.1. Logica_Negocio_Core]]         | Coraz√≥n del sistema financiero    | 98   |
| 2   | [[Proyecto OnlyCarNLD/Datos/3.4. Administracion_DB]]           | DevOps DB (Backups, Migraciones)  | 5    |
| 3   | [[Proyecto OnlyCarNLD/Datos/3.1.4 esquema_sql_logica_negocio]] | Tablas SQL core                   | 7    |
| 4   | [[Proyecto OnlyCarNLD/Datos/3.4.6 Modelo_ER_Global]]           | Diagrama E-R Global               | 0    |
| 5   | [[Proyecto OnlyCarNLD/Datos/3.2.6 RLS_Policies_Completo]]      | Pol√≠ticas seguridad RLS           | 4    |
| 6   | [[Proyecto OnlyCarNLD/Datos/3.1.7 sistema_costos]]             | C√°lculo costos                    | 15   |
| 7   | [[Proyecto OnlyCarNLD/Datos/3.1.8 sistema_remuneracion]]       | Pagos operador                    | 12   |
| 8   | [[Proyecto OnlyCarNLD/Datos/3.6. Auditoria_Logica]]            | Integridad L√≥gica (Inmutabilidad) | 3    |
| 9   | [[Proyecto OnlyCarNLD/Datos/3.1.11.6 Logica_Gestion_Recursos]] | Algoritmos precios/dispatch       | 3    |
| 10  | [[Proyecto OnlyCarNLD/Datos/3.5.3 stress_test_financiero]]     | Resiliencia                       | 0    |

---

## Glosario Local

| T√©rmino | Definici√≥n |
|---------|------------|
| RLS | Row Level Security, pol√≠ticas de acceso por rol en PostgreSQL |
| Comisi√≥n H√≠brida | Modelo de pago Garant√≠a + Variable |
| CAC | Costo de Adquisici√≥n de Cliente |
| Invariante | Regla de negocio que nunca debe romperse (Audit) |
| Monte Carlo | Simulaci√≥n probabil√≠stica "What-If" |
| Dynamic Pricing | Ajuste de precio en tiempo real (en 3.1.11.6.1) |
| Break-even | Punto de equilibrio financiero |
| Liquidaci√≥n | Proceso de entregar efectivo recaudado |
| Migraci√≥n | Cambio controlado en la estructura de la base de datos |
| PITR | Point-in-Time Recovery (Restauraci√≥n al segundo exacto) |

---

Actualizaci√≥n
√öltima revisi√≥n: 2026-01-23
Versi√≥n: 3.5 (Marketplace SQL Enriched)
Cambios v3.5: Inclusi√≥n de tablas SQL para Marketplace (3.1.4.9) y enriquecimiento visual de Precios.
