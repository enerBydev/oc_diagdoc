---
id: 2.8.3
title: WAF Configuration
parent: '2.8'
breadcrumb: 0 → 2.0 → 2.8 → 2.8.3
type: configuracion
children_count: 0
descendants_count: 0
status: activo
domain:
- seguridad
- waf
- cloudflare
- rate-limiting
actors:
- devops
- admin
summary: 'Configuración del Web Application Firewall en Cloudflare: reglas personalizadas,
  rate limiting y protección contra ataques comunes.'
last_updated: 2026-01-29 15:32
file_create: 2026-01-22 23:10
content_hash: f89d7bc15ceae023
---

# 2.8.3 WAF Configuration

> Blindaje perimetral mediante Cloudflare Web Application Firewall.

---

## Visión General

El WAF (Web Application Firewall) de Cloudflare actúa como la primera línea de defensa contra ataques web comunes como SQL Injection, XSS, y DDoS. Esta configuración se aplica automáticamente a todo el tráfico antes de llegar a nuestros servidores.

---

## Stack de Protección

| Capa | Tecnología | Configuración |
|------|------------|---------------|
| **WAF Managed** | Cloudflare OWASP | Core Ruleset habilitado |
| **Rate Limiting** | Cloudflare Rules | 100 req/min por IP |
| **Bot Protection** | Cloudflare Bot Management | Modo "Challenge" |
| **Geo Blocking** | Zone Lockdown | Solo MX, US (MVP) |

---

## Reglas Personalizadas

### Regla 1: Protección de API
```javascript
// Bloquear si no hay header de autenticación en /api/*
(http.request.uri.path contains "/api/" 
 and not http.request.headers["authorization"])
```

### Regla 2: Rate Limit Agresivo en Auth
```javascript
// Limitar intentos de login
(http.request.uri.path eq "/api/auth/login")
→ 10 requests/minute per IP
→ Action: Block for 1 hour
```

### Regla 3: Protección de Uploads
```javascript
// Solo permitir content-types válidos para uploads
(http.request.uri.path contains "/api/upload"
 and not http.request.headers["content-type"] contains "multipart/form-data")
→ Block
```

---

## Configuración en Dashboard

1. **Cloudflare Dashboard** → Security → WAF
2. Habilitar "OWASP Core Ruleset" en modo Paranoia Level 2
3. Configurar excepciones para webhooks (`/api/webhooks/*`)
4. Habilitar "Browser Integrity Check"

---

## Métricas y Alertas

| Métrica | Umbral | Acción |
|---------|--------|--------|
| Blocked requests/hour | > 1000 | Alerta Slack |
| Rate limit triggers | > 500 | Revisar IPs |
| Challenge solve rate | < 50% | Ajustar reglas |

---

## Relaciones

- Complementa: [[Proyecto OnlyCarNLD/Datos/2.8.1 Politicas_Seguridad|RLS y Políticas DB]]
- Utiliza: [[Proyecto OnlyCarNLD/Datos/2.3.3 Supabase_Config|Credenciales Cloudflare]]
- Monitorea: [[Proyecto OnlyCarNLD/Datos/2.11.5 Alerting_Strategy|Sistema de Alertas]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.8. Seguridad_Infraestructura]] |
| -------------------- | ---------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.8.2 Optimizacion_Performance]] |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.8.4 Secret_Management]]        |

---
