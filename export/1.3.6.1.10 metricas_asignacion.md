---
id: 1.3.6.1.10
title: M√©tricas de Asignaci√≥n
parent: 1.3.6.1
breadcrumb: 0 ‚Üí 1.0 ‚Üí 1.3 ‚Üí 1.3.6 ‚Üí 1.3.6.1 ‚Üí 1.3.6.1.10
type: hoja
status: activo
domain: comunicacion
summary: KPIs para evaluar sistema de asignaci√≥n con dashboard, vistas SQL, alertas
  autom√°ticas y recomendaciones.
version: 1.0
last_updated: 2026-01-29 15:32
file_create: 2025-12-26 13:11
actors:
- admin
dependencies:
- supabase
affects:
- 1.3.6.1 asignacion_citas
content_hash: 9989964db2b2699a
---

# 1.3.6.1.10 M√©tricas de Asignaci√≥n

KPIs para evaluar y optimizar el sistema de asignaci√≥n autom√°tica.

---

## Dashboard de M√©tricas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìä M√âTRICAS DE ASIGNACI√ìN                    √öltimo mes ‚ñº      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ  ‚îÇ üéØ 85%       ‚îÇ  ‚îÇ ‚è±Ô∏è 42 seg    ‚îÇ  ‚îÇ üìã 1,247     ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ Tasa Auto    ‚îÇ  ‚îÇ Tiempo Prom. ‚îÇ  ‚îÇ Solicitudes  ‚îÇ           ‚îÇ
‚îÇ  ‚îÇ Asignaci√≥n   ‚îÇ  ‚îÇ Aceptaci√≥n   ‚îÇ  ‚îÇ   Totales    ‚îÇ           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  EMBUDO DE CONVERSI√ìN                                           ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  Solicitudes recibidas    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 1,247    ‚îÇ
‚îÇ  Broadcasts enviados      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë 1,180    ‚îÇ
‚îÇ  Aceptados                ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   942    ‚îÇ
‚îÇ  Confirmados              ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   890    ‚îÇ
‚îÇ  Completados              ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   845    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  DISTRIBUCI√ìN POR MODO DE ASIGNACI√ìN                            ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ Autom√°tico     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë  85%   ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ Manual (B2B)   ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  10%   ‚îÇ     ‚îÇ
‚îÇ  ‚îÇ Fallback       ‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë   5%   ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  PROBLEMAS DETECTADOS                                           ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ  ‚ö†Ô∏è Zona Sur: 45% tasa de rechazo (vs 15% promedio)             ‚îÇ
‚îÇ  ‚ö†Ô∏è Operador Luis R.: 60% rechazos (vs 18% promedio)            ‚îÇ
‚îÇ  ‚ö†Ô∏è Detallado Premium: 35% escalados (vs 12% promedio)          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## KPIs Principales

| KPI | F√≥rmula | Meta | Alerta |
|-----|---------|------|--------|
| **Tasa auto-asignaci√≥n** | Auto / Total | >80% | <70% |
| **Tiempo de aceptaci√≥n** | Avg(broadcast ‚Üí aceptar) | <60s | >120s |
| **Tasa de expiraci√≥n** | Expirados / Broadcasts | <15% | >25% |
| **Tasa de confirmaci√≥n** | Confirmados / Aceptados | >95% | <85% |
| **Escalaciones** | Escalados / Total | <10% | >20% |

---

## Vistas SQL para M√©tricas

### Vista: Resumen General

```sql
CREATE VIEW v_metricas_asignacion AS
WITH datos AS (
  SELECT
    COUNT(*) as total_solicitudes,
    COUNT(*) FILTER (WHERE modo_asignacion = 'auto') as asignadas_auto,
    COUNT(*) FILTER (WHERE modo_asignacion = 'manual') as asignadas_manual,
    COUNT(*) FILTER (WHERE estado = 'escalada') as escaladas,
    COUNT(*) FILTER (WHERE estado = 'completada') as completadas
  FROM solicitudes
  WHERE created_at > NOW() - INTERVAL '30 days'
),
broadcasts AS (
  SELECT
    COUNT(*) as total_broadcasts,
    AVG(EXTRACT(EPOCH FROM (tomada_at - created_at))) as avg_tiempo_aceptacion,
    COUNT(*) FILTER (WHERE estado = 'expirada') as expirados
  FROM broadcasts
  WHERE created_at > NOW() - INTERVAL '30 days'
)
SELECT
  d.total_solicitudes,
  d.asignadas_auto,
  d.asignadas_manual,
  d.escaladas,
  d.completadas,
  ROUND(d.asignadas_auto * 100.0 / NULLIF(d.total_solicitudes, 0), 1) as tasa_auto_pct,
  b.total_broadcasts,
  ROUND(b.avg_tiempo_aceptacion, 1) as tiempo_aceptacion_seg,
  ROUND(b.expirados * 100.0 / NULLIF(b.total_broadcasts, 0), 1) as tasa_expiracion_pct
FROM datos d, broadcasts b;
```

### Vista: Por Zona

```sql
CREATE VIEW v_metricas_por_zona AS
SELECT
  z.nombre as zona,
  COUNT(s.id) as solicitudes,
  COUNT(s.id) FILTER (WHERE s.modo_asignacion = 'auto') as auto,
  COUNT(s.id) FILTER (WHERE s.estado = 'escalada') as escaladas,
  AVG(EXTRACT(EPOCH FROM (b.tomada_at - b.created_at))) as tiempo_aceptacion_avg,
  COUNT(r.id) FILTER (WHERE r.accion = 'pasar') as rechazos
FROM zonas z
LEFT JOIN solicitudes s ON punto_en_zona(s.lat, s.lng, z.id)
LEFT JOIN broadcasts b ON s.id = b.solicitud_id
LEFT JOIN respuestas_broadcast r ON b.id = r.broadcast_id
WHERE s.created_at > NOW() - INTERVAL '30 days'
GROUP BY z.id, z.nombre
ORDER BY solicitudes DESC;
```

### Vista: Por Operador

```sql
CREATE VIEW v_metricas_por_operador AS
SELECT
  o.id as operador_id,
  o.nombre,
  COUNT(r.id) FILTER (WHERE r.accion = 'aceptar') as aceptaciones,
  COUNT(r.id) FILTER (WHERE r.accion = 'pasar') as rechazos,
  COUNT(r.id) FILTER (WHERE r.accion = 'bloquear') as bloqueos,
  ROUND(AVG(r.tiempo_respuesta_ms)::numeric / 1000, 1) as tiempo_respuesta_avg_seg,
  ROUND(
    COUNT(r.id) FILTER (WHERE r.accion = 'aceptar') * 100.0 / 
    NULLIF(COUNT(r.id), 0), 
    1
  ) as tasa_aceptacion_pct
FROM operadores o
LEFT JOIN respuestas_broadcast r ON o.id = r.operador_id
WHERE r.created_at > NOW() - INTERVAL '30 days'
GROUP BY o.id, o.nombre
ORDER BY tasa_aceptacion_pct DESC;
```

---

## Alertas Autom√°ticas

```typescript
// Cron: Verificar m√©tricas diariamente
const verificarMetricasAsignacion = async () => {
  // 1. Tasa de auto-asignaci√≥n
  const { data: metricas } = await supabase
    .from('v_metricas_asignacion')
    .select('tasa_auto_pct, tasa_expiracion_pct')
    .single();
  
  if (metricas.tasa_auto_pct < 70) {
    await notifyAdmins({
      type: 'warning',
      title: '‚ö†Ô∏è Baja tasa de auto-asignaci√≥n',
      body: `Solo ${metricas.tasa_auto_pct}% se asigna autom√°ticamente (meta: >80%)`
    });
  }
  
  if (metricas.tasa_expiracion_pct > 25) {
    await notifyAdmins({
      type: 'warning',
      title: '‚ö†Ô∏è Alta tasa de expiraci√≥n',
      body: `${metricas.tasa_expiracion_pct}% de broadcasts expiran sin respuesta`
    });
  }
  
  // 2. Operadores problem√°ticos
  const { data: operadores } = await supabase
    .from('v_metricas_por_operador')
    .select('operador_id, nombre, tasa_aceptacion_pct')
    .lt('tasa_aceptacion_pct', 50);
  
  for (const op of operadores || []) {
    await notifyAdmins({
      type: 'info',
      title: `Operador con baja tasa: ${op.nombre}`,
      body: `Tasa de aceptaci√≥n: ${op.tasa_aceptacion_pct}%. Revisar situaci√≥n.`
    });
  }
};
```

---

## Composable: useAssignmentMetrics

```typescript
// composables/useAssignmentMetrics.ts
export const useAssignmentMetrics = () => {
  const supabase = useSupabaseClient();
  
  const getGeneralMetrics = async (days: number = 30) => {
    const { data } = await supabase
      .from('v_metricas_asignacion')
      .select('*')
      .single();
    return data;
  };
  
  const getMetricsByZone = async () => {
    const { data } = await supabase
      .from('v_metricas_por_zona')
      .select('*');
    return data;
  };
  
  const getMetricsByOperator = async () => {
    const { data } = await supabase
      .from('v_metricas_por_operador')
      .select('*');
    return data;
  };
  
  const getTrendData = async (metric: string, days: number = 30) => {
    const { data } = await supabase
      .from('solicitudes')
      .select('created_at, modo_asignacion, estado')
      .gte('created_at', new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString());
    
    // Agrupar por d√≠a
    const byDay = data?.reduce((acc, s) => {
      const day = s.created_at.split('T')[0];
      if (!acc[day]) acc[day] = { total: 0, auto: 0, escalada: 0 };
      acc[day].total++;
      if (s.modo_asignacion === 'auto') acc[day].auto++;
      if (s.estado === 'escalada') acc[day].escalada++;
      return acc;
    }, {} as Record<string, any>);
    
    return Object.entries(byDay || {}).map(([date, counts]) => ({
      date,
      ...counts
    }));
  };
  
  return {
    getGeneralMetrics,
    getMetricsByZone,
    getMetricsByOperator,
    getTrendData
  };
};
```

---

## Recomendaciones Autom√°ticas

```sql
-- Vista de recomendaciones basadas en datos
CREATE VIEW v_recomendaciones_asignacion AS
SELECT
  CASE 
    WHEN tasa_expiracion_pct > 25 THEN 'Aumentar candidatos por broadcast (actualmente muy restringido)'
    WHEN tiempo_aceptacion_seg > 120 THEN 'Considerar notificaciones m√°s visibles o sonoras'
    ELSE NULL
  END as recomendacion_general,
  
  CASE
    WHEN EXISTS (
      SELECT 1 FROM v_metricas_por_zona WHERE escaladas * 100.0 / solicitudes > 30
    ) THEN 'Agregar operadores a zonas con alta escalaci√≥n'
    ELSE NULL
  END as recomendacion_zonas,
  
  CASE
    WHEN EXISTS (
      SELECT 1 FROM v_metricas_por_operador WHERE tasa_aceptacion_pct < 30
    ) THEN 'Revisar operadores con <30% tasa de aceptaci√≥n'
    ELSE NULL
  END as recomendacion_operadores
FROM v_metricas_asignacion;
```

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/1.3.6.1 asignacion_citas]]            |
| -------------------- | --------------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.9 configuracion_operador]]    |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.11 preferencias_servicios]]   |

---
