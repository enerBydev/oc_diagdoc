---
id: 3.1.9.4.1
title: Deuda Pendiente
parent: 3.1.9.4
breadcrumb: 0 → 3.0 → 3.1 → 3.1.9 → 3.1.9.4 → 3.1.9.4.1
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 14:15
domain:
- deuda
- pendiente
- retencion
actors:
- operador
- admin
summary: 'Manejo de caja no liquidada al corte.

  Registro de deuda y retención de pago semanal.'
content_hash: 24ec11a35cca2219
---

# 3.1.9.4.1 Deuda Pendiente

Manejo de caja no liquidada al corte.

---

## Detección Automática

```typescript
// Cron job: Viernes 23:59
const verificarCajasAlCorte = async () => {
  // Obtener todas las cajas abiertas
  const { data: cajasAbiertas } = await supabase
    .from('cajas_diarias')
    .select('*, operadores!inner(id, nombre)')
    .gt('total_pendiente', 0)
    .lte('fecha', format(new Date(), 'yyyy-MM-dd'));
  
  for (const caja of cajasAbiertas) {
    // Registrar deuda
    await supabase.from('deudas_caja').insert({
      operador_id: caja.operador_id,
      monto: caja.total_pendiente,
      caja_ids: [caja.id],
      estado: 'activa',
      fecha_limite: addDays(new Date(), 3) // 3 días para liquidar
    });
    
    // Notificar operador
    await notifyOperador(caja.operador_id, {
      title: '⚠️ ¡Tienes caja pendiente!',
      body: `Debes liquidar $${caja.total_pendiente} antes del lunes`,
      priority: 'high'
    });
    
    // Retener pago semanal
    await supabase
      .from('pagos_operador')
      .update({ estado: 'retenido', motivo: 'caja_pendiente' })
      .eq('operador_id', caja.operador_id)
      .eq('estado', 'pendiente');
  }
};
```

---

## UI: Alerta de Deuda

```
┌─────────────────────────────────────────────────────────────────┐
│  ⚠️ ATENCIÓN: TIENES CAJA PENDIENTE                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  No liquidaste tu caja antes del corte del viernes.             │
│                                                                 │
│  Monto pendiente: $790                                          │
│  Fecha límite: Lunes 23 Dic, 23:59                              │
│                                                                 │
│  TU PAGO SEMANAL ESTÁ RETENIDO                                  │
│  Pago retenido: $2,188.92                                       │
│                                                                 │
│  Liquida tu caja para liberar tu pago.                          │
│                                                                 │
│  [ Depositar efectivo ]  [ Liquidar tarjeta ]                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/3.1.9.4 penalizaciones_caja]]   |
| -------------------- | --------------------------------- |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.9.4.2 bloqueo_servicios]]   |

---
