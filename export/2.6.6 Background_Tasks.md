---
id: 2.6.6
title: Background Tasks
parent: '2.6'
breadcrumb: 0 → 2.0 → 2.6 → 2.6.6
type: arquitectura
status: activo
domain:
- mobile
- background
- geolocation
- sync
summary: 'Ejecución de tareas en segundo plano: Geolocalización persistente para operadores
  y sincronización básica de datos (fetch).'
last_updated: 2026-01-29 15:32
content_hash: 577f4b6ff64dc1d6
---

# 2.6.6 Background Tasks

> Ejecución de lógica crítica cuando la aplicación está minimizada o el dispositivo bloqueado.

---

## Retos del OS
iOS y Android modernos son extremadamente agresivos matando procesos en background para ahorrar batería. Capacitor no corre JS en background por defecto ilimitadamente.

---

## 1. Geolocalización Persistente (Operadores)
El caso de uso más crítico: Rastrear al operador mientras se dirige al servicio, con el teléfono bloqueado en el bolsillo o usando Waze.

### Solución: Plugin Nativo Especializado
No usar `navigator.geolocation` estándar. Usamos `@capacitor-community/background-geolocation` o similar.

- **Android**: Foreground Service (Notificación persistente "OnlyCar está usando tu ubicación").
- **iOS**: Permiso "Always Allow" y configuración de `UIBackgroundModes` location.

### Optimización de Batería
- **En Servicio**: Alta precisión, update cada 10-30 metros.
- **Inactivo**: Geofencing o actualizaciones pasivas (cambio significativo de ubicación) o apagado total.

---

## 2. Background Fetch (Sincronización)
Para bajar nuevas solicitudes o mensajes de chat periodicamente.

- **iOS**: `BGAppRefreshTask`. Ventana de ejecución corta (30 seg) controlada por el OS (heurística de uso).
- **Android**: `WorkManager`. Trabajos programados periódicos.

### Implementación Capacitor
Plugin `@capacitor/background-runner` permite ejecutar código JS aislado en un hilo separado (hibrido) o llamar código nativo puro.

---

## 3. Notificaciones Silenciosas
Una estrategia alternativa para "despertar" la app.
El servidor envía una Push Notification con `content-available: 1` (iOS) o data payload (Android). El sistema despierta la app brevemente para procesar el dato sin mostrar alerta al usuario.

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.6. Arquitectura_Mobile]] |
| -------------------- | ---------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.6.5 Gestion_Updates]]    |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.6.7 App_Store_Guidelines]] |

---
