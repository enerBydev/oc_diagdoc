---
id: 1.3.6.1.14.3
title: NotificaciÃ³n al Cliente
parent: 1.3.6.1.14
breadcrumb: 0 â†’ 1.0 â†’ 1.3 â†’ 1.3.6 â†’ 1.3.6.1 â†’ 1.3.6.1.14 â†’ 1.3.6.1.14.3
type: hoja
status: activo
domain: comunicacion
summary: Templates de notificaciones push al cliente para sin disponibilidad, match
  encontrado y expiraciÃ³n de lista de espera.
version: 1.0
last_updated: 2026-01-29 15:32
file_create: 2025-12-26 17:52
actors:
- cliente
- sistema
dependencies:
- firebase_messaging
affects:
- 1.3.6.1.14 matching_alternativo
content_hash: c824fb3cf970a580
---

# 1.3.6.1.14.3 NotificaciÃ³n al Cliente

ComunicaciÃ³n sobre alternativas y disponibilidad.

---

## Tipos de NotificaciÃ³n

| Tipo | CuÃ¡ndo | Prioridad |
|------|--------|-----------|
| **Sin disponibilidad** | 0 operadores encontrados | Alta |
| **Alternativas encontradas** | Hay horarios/fechas alt. | Alta |
| **Match desde lista espera** | Operador disponible | Urgente |
| **ExpiraciÃ³n lista espera** | 24h sin match | Normal |

---

## Templates de NotificaciÃ³n

### 1. Sin Disponibilidad Inmediata

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUSH NOTIFICATION                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ˜” Sin operadores disponibles                                  â”‚
â”‚                                                                 â”‚
â”‚  No encontramos operadores para maÃ±ana 10:00 AM.                â”‚
â”‚  Toca para ver alternativas.                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Match Encontrado (Lista de Espera)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUSH NOTIFICATION (URGENTE)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ‰ Â¡Operador disponible!                                       â”‚
â”‚                                                                 â”‚
â”‚  Carlos M. puede atenderte maÃ±ana 11:30 AM.                     â”‚
â”‚  Confirma en 15 minutos.                                        â”‚
â”‚                                                                 â”‚
â”‚  [ VER DETALLES ]                                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ExpiraciÃ³n de Lista de Espera

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PUSH NOTIFICATION                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â° Tu espera ha expirado                                       â”‚
â”‚                                                                 â”‚
â”‚  No encontramos disponibilidad en 24 horas.                     â”‚
â”‚  Â¿Quieres intentar otra fecha?                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Servicio de Notificaciones

```typescript
// server/services/clientNotifications.ts
interface NotificationPayload {
  type: string;
  title: string;
  body: string;
  data?: Record<string, any>;
  priority?: 'normal' | 'high';
}

export const notifyClient = async (clienteId: string, payload: NotificationPayload) => {
  const supabase = createServerSupabaseClient();
  
  // 1. Obtener FCM token del cliente
  const { data: cliente } = await supabase
    .from('clientes')
    .select('fcm_token, nombre')
    .eq('id', clienteId)
    .single();
  
  if (!cliente?.fcm_token) {
    console.warn(`Cliente ${clienteId} sin FCM token`);
    return;
  }
  
  // 2. Enviar push via Firebase
  await sendPushNotification({
    token: cliente.fcm_token,
    notification: {
      title: payload.title,
      body: payload.body
    },
    data: {
      type: payload.type,
      ...payload.data
    },
    android: {
      priority: payload.priority === 'high' ? 'high' : 'normal',
      notification: {
        channelId: payload.priority === 'high' ? 'urgent_channel' : 'default_channel'
      }
    }
  });
  
  // 3. Guardar en historial
  await supabase.from('notificaciones_enviadas').insert({
    destinatario_id: clienteId,
    tipo_destinatario: 'cliente',
    tipo: payload.type,
    titulo: payload.title,
    cuerpo: payload.body,
    datos: payload.data
  });
};

// FunciÃ³n especÃ­fica para lista de espera
export const notifyWaitlistMatch = async (listaEsperaId: string) => {
  const supabase = createServerSupabaseClient();
  
  const { data } = await supabase
    .from('lista_espera')
    .select(`
      *,
      clientes (id, nombre, fcm_token),
      operadores:operador_encontrado_id (nombre)
    `)
    .eq('id', listaEsperaId)
    .single();
  
  if (!data) return;
  
  await notifyClient(data.cliente_id, {
    type: 'WAITLIST_MATCH',
    title: 'ğŸ‰ Â¡Operador disponible!',
    body: `${data.operadores.nombre} puede atenderte. Confirma en 15 min.`,
    data: {
      lista_espera_id: listaEsperaId,
      operador_nombre: data.operadores.nombre,
      fecha: data.fecha_match,
      hora: data.hora_match
    },
    priority: 'high'
  });
};
```

---

## Manejo en App del Cliente

```typescript
// Cliente escucha notificaciones push
onMessage(async (message) => {
  switch (message.data?.type) {
    case 'NO_DISPONIBILIDAD':
      // Mostrar modal de alternativas
      showAlternativesModal(message.data.solicitud_id);
      break;
      
    case 'WAITLIST_MATCH':
      // Mostrar pantalla de confirmaciÃ³n urgente
      navigateTo(`/confirmar-match/${message.data.lista_espera_id}`);
      break;
      
    case 'WAITLIST_EXPIRED':
      // Mostrar opciÃ³n de reintentar
      showRetryModal(message.data.solicitud_id);
      break;
  }
});
```

---

## Email de Respaldo

```typescript
// Si no hay FCM token o es importante, enviar email
const sendWaitlistMatchEmail = async (clienteId: string, matchData: any) => {
  const { data: cliente } = await supabase
    .from('clientes')
    .select('email, nombre')
    .eq('id', clienteId)
    .single();
  
  await sendEmail({
    to: cliente.email,
    subject: 'ğŸ‰ Â¡Encontramos disponibilidad para tu servicio!',
    template: 'waitlist-match',
    data: {
      cliente_nombre: cliente.nombre,
      operador_nombre: matchData.operador_nombre,
      fecha: formatDate(matchData.fecha),
      hora: formatTime(matchData.hora),
      confirm_url: `${APP_URL}/confirmar-match/${matchData.lista_espera_id}`
    }
  });
};
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre            | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.14 matching_alternativo]]   |
| ------------------- | ------------------------------------- |
| â¬…ï¸ Hermano anterior | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.14.2 lista_espera]]         |

---
