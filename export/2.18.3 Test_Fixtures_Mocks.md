---
id: 2.18.3
title: Test Fixtures & Mocks
parent: '2.18'
breadcrumb: 0 → 2.0 → 2.18 → 2.18.3
type: testing
children_count: 0
descendants_count: 0
status: activo
domain:
- testing
- fixtures
- mocks
- factories
actors:
- desarrollador
- qa
summary: 'Fixtures y Mocks para testing: Factories de datos, mocks de Supabase y estrategias
  de test doubles.'
last_updated: 2026-01-29 15:31
file_create: 2026-01-22 23:20
content_hash: a62ea645cd536277
---

# 2.18.3 Test Fixtures & Mocks

> Datos de prueba consistentes y predecibles para tests reproducibles.

---

## Jerarquía de Test Doubles

| Tipo | Uso | Ejemplo |
|------|-----|---------|
| **Dummy** | Parámetros no usados | `const user = {}` |
| **Stub** | Respuestas predefinidas | `vi.fn().mockReturnValue(...)` |
| **Spy** | Verificar llamadas | `vi.spyOn(service, 'method')` |
| **Mock** | Stub + verificación | `vi.mock('~/services/api')` |
| **Fake** | Implementación funcional | `FakeSupabaseClient` |

---

## Factory Pattern

### User Factory

```typescript
// test/factories/userFactory.ts
import { faker } from '@faker-js/faker';
import type { User } from '~/types';

export function createUser(overrides: Partial<User> = {}): User {
  return {
    id: faker.string.uuid(),
    email: faker.internet.email(),
    name: faker.person.fullName(),
    role: 'cliente',
    avatar_url: faker.image.avatar(),
    created_at: faker.date.past().toISOString(),
    ...overrides
  };
}

export function createUserList(count: number): User[] {
  return Array.from({ length: count }, () => createUser());
}
```

### Vehicle Factory

```typescript
// test/factories/vehicleFactory.ts
export function createVehicle(overrides = {}) {
  return {
    id: faker.string.uuid(),
    marca: faker.helpers.arrayElement(['Toyota', 'Honda', 'Nissan']),
    modelo: faker.vehicle.model(),
    año: faker.number.int({ min: 2015, max: 2024 }),
    placas: faker.string.alphanumeric(7).toUpperCase(),
    owner_id: faker.string.uuid(),
    ...overrides
  };
}
```

---

## Supabase Mock

```typescript
// test/mocks/supabase.ts
import { vi } from 'vitest';

export const mockSupabase = {
  auth: {
    getUser: vi.fn().mockResolvedValue({ 
      data: { user: createUser() }, 
      error: null 
    }),
    signInWithPassword: vi.fn(),
    signOut: vi.fn()
  },
  from: vi.fn((table) => ({
    select: vi.fn().mockReturnThis(),
    insert: vi.fn().mockReturnThis(),
    update: vi.fn().mockReturnThis(),
    delete: vi.fn().mockReturnThis(),
    eq: vi.fn().mockReturnThis(),
    single: vi.fn().mockResolvedValue({ data: null, error: null })
  })),
  storage: {
    from: vi.fn().mockReturnValue({
      upload: vi.fn().mockResolvedValue({ data: { path: 'test.jpg' } }),
      getPublicUrl: vi.fn().mockReturnValue({ data: { publicUrl: 'https://...' } })
    })
  }
};

// En tests:
vi.mock('~/composables/useSupabase', () => ({
  useSupabaseClient: () => mockSupabase
}));
```

---

## Fixtures JSON

```typescript
// test/fixtures/servicios.json
{
  "lavadoBasico": {
    "id": "srv-001",
    "nombre": "Lavado Básico",
    "precio": 150,
    "duracion_min": 30,
    "categoria": "lavado"
  },
  "lavadoCompleto": {
    "id": "srv-002",
    "nombre": "Lavado Completo",
    "precio": 350,
    "duracion_min": 60,
    "categoria": "lavado"
  }
}
```

```typescript
// test/fixtures/index.ts
import servicios from './servicios.json';
import usuarios from './usuarios.json';

export const fixtures = {
  servicios,
  usuarios
};
```

---

## MSW para API Mocking

```typescript
// test/mocks/handlers.ts
import { http, HttpResponse } from 'msw';

export const handlers = [
  http.get('/api/user/profile', () => {
    return HttpResponse.json(createUser());
  }),
  
  http.post('/api/orders', async ({ request }) => {
    const body = await request.json();
    return HttpResponse.json({ id: 'order-123', ...body });
  })
];

// test/setup.ts
import { setupServer } from 'msw/node';
import { handlers } from './mocks/handlers';

export const server = setupServer(...handlers);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

---

## Relaciones

- Utilizado por: [[Proyecto OnlyCarNLD/Datos/2.18.1 Estrategia_Testing|Tests unitarios]]
- Define datos para: [[Proyecto OnlyCarNLD/Datos/2.18.2 Tipos_Pruebas|Tipos de Pruebas]]
- Mockea: [[Proyecto OnlyCarNLD/Datos/2.3.3 Supabase_Config|Supabase]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.18. Testing_Infrastructure]] |
| -------------------- | -------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.18.2 Tipos_Pruebas]]         |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.18.4 Coverage_Reporting]]    |

---
