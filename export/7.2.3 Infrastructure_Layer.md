---
id: 7.2.3
title: Capa de Infraestructura
parent: '7.2'
breadcrumb: 0 → 7.0 → 7.2 → 7.2.3
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-21 12:36
domain:
- infrastructure
- adapters
- config
summary: Implementaciones concretas de infraestructura y configuración DI.
content_hash: b957e24de3c95ee1
---

# 7.2.3 Capa de Infraestructura

> Implementaciones concretas y configuración del sistema.

---

## Contenedor de Inyección de Dependencias

```typescript
// infrastructure/config/DIContainer.ts
import { container } from 'tsyringe';

// Repositories
container.register<ICitaRepository>('CitaRepository', {
  useFactory: (c) => {
    const supabase = c.resolve<SupabaseClient>('Supabase');
    return new SupabaseCitaRepository(supabase);
  }
});

// Gateways
container.register<IPagoGateway>('PagoGateway', {
  useFactory: () => new StripePaymentGateway(process.env.STRIPE_SECRET!)
});

// Use Cases
container.register<IAgendarCita>('AgendarCita', {
  useFactory: (c) => new AgendarCitaUseCase(
    c.resolve('CitaRepository'),
    c.resolve('DisponibilidadService'),
    c.resolve('PricingService')
  )
});

export { container };
```

---

## Mappers

```typescript
// infrastructure/mappers/CitaMapper.ts
export class CitaMapper {
  static toDomain(raw: CitaRow): Cita {
    return new Cita(
      raw.id,
      raw.cliente_id,
      raw.servicio_id,
      new Ubicacion(raw.lat, raw.lng, raw.direccion),
      new Date(raw.fecha_hora),
      raw.estado
    );
  }
  
  static toPersistence(cita: Cita): CitaRow {
    return {
      id: cita.id,
      cliente_id: cita.clienteId,
      servicio_id: cita.servicioId,
      lat: cita.ubicacion.lat,
      lng: cita.ubicacion.lng,
      direccion: cita.ubicacion.direccion,
      fecha_hora: cita.fechaHora.toISOString(),
      estado: cita.estado
    };
  }
}
```

---

## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/7.2 Clean_Architecture_DDD]] |
|----------|-------------------------------|
| ⬅️ Anterior | [[Proyecto OnlyCarNLD/Datos/7.2.2 Application_Layer]] |
| ➡️ Siguiente | [[Proyecto OnlyCarNLD/Datos/7.2.4 Bounded_Contexts]] |

---
