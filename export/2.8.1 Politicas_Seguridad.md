---
id: 2.8.1
title: Políticas de Seguridad
parent: '2.8'
breadcrumb: 0 → 2.0 → 2.8 → 2.8.1
type: especificacion
domain:
- seguridad
- rls
- supabase
- cors
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-04 20:41
summary: 'Implementación obligatoria de Row Level Security (RLS) en PostgreSQL.

  Manejo de CORS y encabezados de seguridad.'
content_hash: 5c3bb165bf579b41
---

# 2.8.1 Políticas de Seguridad

> La seguridad de los datos reside en la base de datos, no solo en el backend.

---

## Row Level Security (RLS)

Todas las tablas en Supabase deben tener RLS habilitado.

### Política por Defecto: Deny All
```sql
ALTER TABLE "public"."bookings" ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Enable read access for own bookings" ON "public"."bookings"
AS PERMISSIVE FOR SELECT
TO authenticated
USING (auth.uid() = user_id);
```

### Reglas Clave
1. **Authenticated:** Solo usuarios logueados pueden leer/escribir datos propios.
2. **Service Role:** El backend de Nuxt (`server/`) puede saltarse RLS usando `service_role key` SOLO para tareas administrativas críticas.
3. **Anon:** Acceso solo a tablas públicas (ej. `services_catalog`).

---

## Seguridad en API (Nuxt Server)

1. **Validación de Inputs:** Usar `zod` o `h3-zod` para validar body y query params.
2. **Rate Limiting:** Configurado a nivel Cloudflare, pero implementable en Nuxt middleware para rutas sensibles (`/api/auth/login`).

---

## CORS y Headers

Configuración en `nuxt.config.ts`:

```ts
routeRules: {
  '/api/**': {
    cors: true,
    headers: {
      'X-Frame-Options': 'DENY',
      'X-Content-Type-Options': 'nosniff'
    }
  }
}
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.8. Seguridad_Infraestructura]] |
| -------------------- | ---------------------------------- |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.8.2 Optimizacion_Performance]] |

---
