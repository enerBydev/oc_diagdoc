---
id: 2.5.2.2
title: State Persistence
parent: 2.5.2
breadcrumb: 0 → 2.0 → 2.5 → 2.5.2 → 2.5.2.2
type: especificacion
domain:
- persistence
- localstorage
- pinia-plugin-persistedstate
- cookies
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-05 03:20
summary: 'Estrategias para sobrevivir al refresh.

  Plugin de persistencia y seguridad de datos sensibles.'
content_hash: 2751ca43d5dc394d
---

# 2.5.2.2 State Persistence

> Que el usuario no pierda su carrito si recarga la página.

---

## Plugin PersistedState

Usamos `pinia-plugin-persistedstate`.

```ts
// stores/cart.ts
export const useCartStore = defineStore('cart', () => {
  const items = ref([])
  
  return { items }
}, {
  persist: {
    storage: persistedState.localStorage,
    paths: ['items'] // Solo persistir lo necesario
  }
})
```

---

## Seguridad vs Persistencia

> [!WARNING]
> Nunca persistir datos sensibles (tokens raw, info financiera) en LocalStorage sin encriptación o consideraciones de seguridad XSS.

*   **Auth Tokens:** Se manejan preferiblemente en **HttpOnly Cookies** gestionadas por Supabase Client, no en el store de Pinia persistido manualmente.
*   **Estado de UI:** LocalStorage es perfecto (ej. Dark Mode, Sidebar collapsed).
*   **Datos de Cache:** LocalStorage/IndexedDB (vía Dexie) es aceptable.

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.5.2 Gestion_Estado]]        |
| -------------------- | ------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.5.2.1 Pinia_Stores]]        |

---
