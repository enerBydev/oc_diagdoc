---
id: 3.6.1
title: Invariantes del Sistema
parent: '3.6'
breadcrumb: 0 → 3.0 → 3.6 → 3.6.1
type: hoja
status: activo
file_create: 2026-01-14 15:12
domain:
- reglas
- core
- safety
actors:
- sistema
- developers
summary: Definición de verdades absolutas y reglas que nunca deben romperse (Safety
  Constraints).
last_updated: 2026-01-29 15:32
content_hash: 7b6ceba5fa51bba3
---

# 3.6.1 Invariantes del Sistema

> **Objetivo:** Definir las "Leyes de la Física" del negocio OnlyCar.

---

## Invariantes Financieros

1.  **Margen Positivo:** `(Precio - Costo Total)` SIEMPRE debe ser > 0.
2.  **Suma Zero Caja:** `(Efectivo Recaudado - Liquidaciones) == Saldo en Caja`.
3.  **No-Deuda Operativa:** Un operador no puede recibir servicios si su deuda > Límite Fianza.
4.  **Comisión Mínima:** La comisión del operador nunca puede ser inferior al Salario Mínimo por hora equivalente.

---

## Invariantes Operativos

1.  **Ubicuidad Exclusiva:** Un operador NO puede estar en estado `EnServicio` en dos citas simultáneas.
2.  **Tiempo Físico:** La duración real de un servicio no puede ser < 50% del tiempo estimado estándar (flag de fraude).
3.  **Stock No-Negativo:** El inventario virtual nunca puede ser < 0.

### Ciclo de Vida de Transacción Segura

```mermaid
stateDiagram-v2
    [*] --> Draft: Creación
    Draft --> Validating: Submit
    
    state Validating {
        [*] --> CheckFin: Margen > 0?
        CheckFin --> CheckOps: Ubicuidad OK?
        CheckOps --> CheckData: Precios Coherentes?
        CheckData --> [*]
    }
    
    Validating --> Committed: All Checks PASS
    Validating --> Rejected: Any Check FAILS
    
    Committed --> [*]: Write to DB
    Rejected --> [*]: Log Anomaly
```

---

## Invariantes de Datos

1.  **Integridad de Precio:** El precio final cobrado debe coincidir con `(Precio Base + Adicionales - Descuentos)`.
2.  **Inmutabilidad Histórica:** Una cita en estado `Completada` no puede modificar sus montos financieros.

---

## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/3.6. Auditoria_Logica]] |
|----------|---------------------------|
| ⬅️ Hermano | NO |
| ➡️ Hermano | [[Proyecto OnlyCarNLD/Datos/3.6.2 deteccion_anomalias]] |

---
