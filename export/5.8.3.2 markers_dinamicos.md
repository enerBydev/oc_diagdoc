---
id: 5.8.3.2
title: Markers Din√°micos
parent: 5.8.3
breadcrumb: 0 ‚Üí 5.0 ‚Üí 5.8 ‚Üí 5.8.3 ‚Üí 5.8.3.2
type: componente
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-01 18:10
domain:
- markers
- leaflet
- mapas
summary: Marcadores din√°micos en mapa.
content_hash: f693f2190d23bf9c
---

# 5.8.3.2 Markers Din√°micos

Marcadores animados para operador y destino.

---

## Iconos Personalizados

```typescript
// config/markers.ts
import L from 'leaflet';

// Corregir path de iconos de Leaflet
import iconUrl from 'leaflet/dist/images/marker-icon.png';
import iconRetinaUrl from 'leaflet/dist/images/marker-icon-2x.png';
import shadowUrl from 'leaflet/dist/images/marker-shadow.png';

L.Icon.Default.mergeOptions({ iconUrl, iconRetinaUrl, shadowUrl });

// Iconos custom con emoji/SVG
export const MARKER_ICONS = {
  // Operador (veh√≠culo en movimiento)
  operador: L.divIcon({
    className: 'custom-marker operador',
    html: `
      <div class="marker-container">
        <div class="marker-pulse"></div>
        <div class="marker-icon">üöó</div>
      </div>
    `,
    iconSize: [48, 48],
    iconAnchor: [24, 24]
  }),
  
  // Destino (ubicaci√≥n del cliente)
  destino: L.divIcon({
    className: 'custom-marker destino',
    html: `
      <div class="marker-container">
        <div class="marker-icon">üìç</div>
      </div>
    `,
    iconSize: [32, 40],
    iconAnchor: [16, 40]
  }),
  
  // Ubicaci√≥n actual del usuario
  usuario: L.divIcon({
    className: 'custom-marker usuario',
    html: `
      <div class="marker-container">
        <div class="marker-dot"></div>
      </div>
    `,
    iconSize: [20, 20],
    iconAnchor: [10, 10]
  })
};
```

---

## Estilos CSS

```css
/* assets/css/markers.css */

.custom-marker {
  background: transparent !important;
  border: none !important;
}

.marker-container {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Icono del operador */
.operador .marker-icon {
  font-size: 32px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  animation: bounce 0.5s ease-out;
}

.operador .marker-pulse {
  position: absolute;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(59, 130, 246, 0.3);
  animation: pulse-ring 2s infinite;
}

@keyframes pulse-ring {
  0% {
    transform: scale(0.8);
    opacity: 1;
  }
  100% {
    transform: scale(1.5);
    opacity: 0;
  }
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

/* Destino */
.destino .marker-icon {
  font-size: 28px;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
}

/* Usuario */
.usuario .marker-dot {
  width: 14px;
  height: 14px;
  background: #3b82f6;
  border: 3px solid white;
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
```

---

## Composable de Markers

```typescript
// composables/useMapMarkers.ts
import L from 'leaflet';
import { MARKER_ICONS } from '~/config/markers';

export const useMapMarkers = (map: Ref<L.Map | null>) => {
  const markers = reactive({
    operador: null as L.Marker | null,
    destino: null as L.Marker | null,
    usuario: null as L.Marker | null
  });
  
  /**
   * A√±adir o actualizar marker del operador
   */
  const setOperadorMarker = (lat: number, lng: number) => {
    if (!map.value) return;
    
    if (markers.operador) {
      // Animaci√≥n suave al mover
      markers.operador.setLatLng([lat, lng]);
    } else {
      markers.operador = L.marker([lat, lng], {
        icon: MARKER_ICONS.operador,
        zIndexOffset: 1000 // Siempre encima
      }).addTo(map.value);
    }
  };
  
  /**
   * A√±adir marker del destino (solo una vez)
   */
  const setDestinoMarker = (lat: number, lng: number, popup?: string) => {
    if (!map.value) return;
    
    if (!markers.destino) {
      markers.destino = L.marker([lat, lng], {
        icon: MARKER_ICONS.destino
      }).addTo(map.value);
      
      if (popup) {
        markers.destino.bindPopup(popup);
      }
    }
  };
  
  /**
   * Mostrar ubicaci√≥n del usuario actual
   */
  const setUsuarioMarker = (lat: number, lng: number) => {
    if (!map.value) return;
    
    if (markers.usuario) {
      markers.usuario.setLatLng([lat, lng]);
    } else {
      markers.usuario = L.marker([lat, lng], {
        icon: MARKER_ICONS.usuario
      }).addTo(map.value);
    }
  };
  
  /**
   * Centrar mapa para mostrar todos los markers
   */
  const fitAllMarkers = () => {
    if (!map.value) return;
    
    const points: L.LatLng[] = [];
    
    if (markers.operador) points.push(markers.operador.getLatLng());
    if (markers.destino) points.push(markers.destino.getLatLng());
    if (markers.usuario) points.push(markers.usuario.getLatLng());
    
    if (points.length >= 2) {
      const bounds = L.latLngBounds(points);
      map.value.fitBounds(bounds, { padding: [50, 50] });
    }
  };
  
  /**
   * Limpiar todos los markers
   */
  const clearMarkers = () => {
    if (markers.operador) {
      map.value?.removeLayer(markers.operador);
      markers.operador = null;
    }
    if (markers.destino) {
      map.value?.removeLayer(markers.destino);
      markers.destino = null;
    }
    if (markers.usuario) {
      map.value?.removeLayer(markers.usuario);
      markers.usuario = null;
    }
  };
  
  return {
    markers: readonly(markers),
    setOperadorMarker,
    setDestinoMarker,
    setUsuarioMarker,
    fitAllMarkers,
    clearMarkers
  };
};
```

---

## Rotaci√≥n del Icono (Heading)

```typescript
// Rotar el marker seg√∫n direcci√≥n del movimiento
const rotateMarker = (marker: L.Marker, heading: number) => {
  const element = marker.getElement();
  if (element) {
    element.style.transform = `rotate(${heading}deg)`;
    element.style.transformOrigin = 'center center';
  }
};

// Uso con heading del GPS
onLocationUpdate((payload) => {
  setOperadorMarker(payload.lat, payload.lng);
  
  if (payload.heading && markers.operador) {
    rotateMarker(markers.operador, payload.heading);
  }
});
```

---

‚Üí Ver navegaci√≥n: [[Proyecto OnlyCarNLD/Datos/5.8.4 navegacion_externa]]

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.3 mapas_visualizacion]]            |
| -------------------- | ---------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.3.1 tiles_osm]]              |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.3.3 nuxt_integration]]              |
