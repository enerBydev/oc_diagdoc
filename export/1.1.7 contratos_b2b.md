---
id: 1.1.7
title: Contratos B2B
parent: '1.1'
breadcrumb: 0 ‚Üí 1.0 ‚Üí 1.1 ‚Üí 1.1.7
type: modulo_padre
children_count: 6
descendants_count: 9
actors:
- admin
- cliente_b2b
domain:
- contratos
- firmas
- b2b
- mifiel
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-23 10:51
summary: 'Sistema de gesti√≥n de contratos empresariales con firma digital Mifiel.

  Ciclo de vida: borrador ‚Üí pendiente firma ‚Üí activo ‚Üí expirado/renovado.

  '
content_hash: 199d2c668fdabcd8
---

# 1.1.7 Contratos B2B

> Sistema de gesti√≥n de contratos empresariales con firma digital.

> [!IMPORTANT]
> **Solo el Administrador puede crear, editar y enviar contratos.**
> El Cliente B2B solo puede consultar y descargar sus contratos firmados.

---

## Ciclo de Vida del Contrato

```mermaid
flowchart LR
    subgraph Estados
        DRAFT[üìù BORRADOR]
        PENDING[‚è≥ PENDIENTE<br/>FIRMA]
        ACTIVE[‚úÖ ACTIVO]
        EXPIRED[‚åõ EXPIRADO]
        CANCELLED[‚ùå CANCELADO]
        RENEWED[üîÑ RENOVADO]
    end
    
    DRAFT -->|Admin env√≠a| PENDING
    PENDING -->|Ambas partes<br/>firmaron| ACTIVE
    PENDING -->|Expira/Rechazado| CANCELLED
    ACTIVE -->|Vence fecha| EXPIRED
    ACTIVE -->|Nuevo per√≠odo| RENEWED
    EXPIRED -->|Renovaci√≥n| RENEWED
```

### Estados del Contrato

| Estado            | C√≥digo               | Descripci√≥n                        | Acciones Disponibles                   |
| ----------------- | -------------------- | ---------------------------------- | -------------------------------------- |
| Borrador          | `draft`              | Admin creando contrato             | Editar, Eliminar, Enviar a firma       |
| Pendiente Firma   | `pending_signature`  | Esperando firmas en Mifiel         | Ver estado, Cancelar                   |
| Activo            | `active`             | Firmado y vigente                  | Consultar, Descargar, Programar renov. |
| Expirado          | `expired`            | Fecha de vencimiento pasada        | Renovar, Archivar                      |
| Cancelado         | `cancelled`          | Terminado anticipadamente          | Solo consulta                          |
| Renovado          | `renewed`            | Reemplazado por nuevo contrato     | Solo consulta                          |

---

## Flujo de Creaci√≥n de Contrato

```mermaid
graph TD
    A[Admin inicia contrato] --> B[Formulario dinamico]
    B --> C[Generacion PDF con PDFme]
    C --> D[Envio a Mifiel]
    D --> E[Proceso de firma]
    E --> F{Firmado por ambos}
    F -->|Si| G[Almacenamiento R2 y PostgreSQL]
    F -->|No o Expira| H[Cancelado]
    G --> I[Acceso Admin y Cliente]
```



```
1. ADMIN INICIA CONTRATO
   ‚Üí Dashboard Admin ‚Üí "Nuevo Contrato B2B"
   ‚Üí Selecciona cliente existente o crea nuevo

2. FORMULARIO DIN√ÅMICO
   ‚Üí Completa campos del contrato (ver 1.1.7.3)
   ‚Üí Sistema valida datos obligatorios

3. GENERACI√ìN DE PDF
   ‚Üí PDFme procesa plantilla JSON + datos formulario
   ‚Üí Genera PDF con dise√±o profesional
   ‚Üí Preview para Admin

4. ENV√çO A MIFIEL
   ‚Üí Admin confirma y env√≠a
   ‚Üí Sistema llama a Mifiel API
   ‚Üí Estado ‚Üí "pending_signature"

5. PROCESO DE FIRMA (Mifiel)
   ‚Üí Mifiel env√≠a invitaciones a firmantes
   ‚Üí Admin firma primero
   ‚Üí Cliente firma despu√©s
   ‚Üí Mifiel notifica v√≠a webhook

6. ALMACENAMIENTO
   ‚Üí PDF firmado ‚Üí Cloudflare R2
   ‚Üí Metadata ‚Üí PostgreSQL
   ‚Üí Notificaci√≥n a cliente

7. ACCESO
   ‚Üí Admin: Ve en "Mis Contratos"
   ‚Üí Cliente B2B: Ve en "Mi Contrato Activo"
```


---

## Permisos por Rol

| Acci√≥n            | Admin | Cliente B2B |
| ----------------- | ----- | ----------- |
| Crear contrato    | ‚úÖ     | ‚ùå           |
| Editar borrador   | ‚úÖ     | ‚ùå           |
| Enviar a firma    | ‚úÖ     | ‚ùå           |
| Firmar contrato   | ‚úÖ     | ‚úÖ           |
| Ver estado        | ‚úÖ     | ‚úÖ           |
| Descargar firmado | ‚úÖ     | ‚úÖ           |
| Cancelar          | ‚úÖ     | ‚ùå           |
| Renovar           | ‚úÖ     | ‚ùå           |

---

## Estructura de Hijos

| ID                                        | Nombre             | Descripci√≥n            | Estado |
| ----------------------------------------- | ------------------ | ---------------------- | ------ |
| [[Proyecto OnlyCarNLD/Datos/1.1.7.1 ciclo_vida_contrato\|1.1.7.1]]  | Ciclo de Vida      | Estados y transiciones | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/1.1.7.2 plantilla_contrato\|1.1.7.2]]   | Plantilla Contrato | Plantilla JSON PDFme   | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/1.1.7.3 formulario_contrato\|1.1.7.3]]  | Formulario         | Campos del contrato    | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/1.1.7.4 generacion_pdfme\|1.1.7.4]]     | PDFme Generaci√≥n   | Proceso de generaci√≥n  | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/1.1.7.5 registro_empresa_b2b\|1.1.7.5]] | Registro Empresa   | Onboarding empresa B2B | ‚úÖ      |

---

## Relaci√≥n con Otros M√≥dulos

| M√≥dulo                             | Relaci√≥n                              |
| ---------------------------------- | ------------------------------------- |
| [[Proyecto OnlyCarNLD/Datos/5.3. mifiel_firmas\|5.3]]        | Proceso t√©cnico de firma digital      |
| [[Proyecto OnlyCarNLD/Datos/1.1.6 sistema_pagos\|1.1.6]]     | Tipo de pago seg√∫n contrato (PAY-SUB) |
| [[Proyecto OnlyCarNLD/Datos/1.1.8 programa_corporate_plus\|1.1.8]] | Cl√°usula 6 del contrato         |
| [[Proyecto OnlyCarNLD/Datos/1.2.1 admin_perfil\|1.2.1]]      | Dashboard de gesti√≥n de contratos     |
| [[Proyecto OnlyCarNLD/Datos/1.2.4 cliente_b2b_perfil\|1.2.4]]| Consulta de contratos                 |
| [[Proyecto OnlyCarNLD/Datos/1.3.2 chat_admin_cliente\|1.3.2]]| Negociaci√≥n y comunicaci√≥n            |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/1.1. identidad]]                |
| -------------------- | --------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.1.6 sistema_pagos]]           |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.1.8 programa_corporate_plus]] |

---

**Fecha de especificaci√≥n:** Diciembre 2025  
**Versi√≥n:** 1.0
