---
id: 5.8.2.5
title: Presence Tracking
parent: 5.8.2
breadcrumb: 0 → 5.0 → 5.8 → 5.8.2 → 5.8.2.5
type: feature
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-01 18:08
domain:
- presence
- online
- status
summary: Tracking de presencia de usuarios.
content_hash: 30f47c33b3f8f438
---

# 5.8.2.5 Presence Tracking

Supabase Presence API para estado online/offline.

---

## Caso de Uso

Mostrar al cliente si el operador está **online** o **desconectado**.

---

## Implementación (Opcional)

```typescript
// composables/useOperatorPresence.ts
export const useOperatorPresence = (servicioId: string) => {
  const supabase = useSupabaseClient();
  const user = useSupabaseUser();
  const channel = ref<RealtimeChannel | null>(null);
  
  const operadorOnline = ref(false);
  
  const connect = () => {
    channel.value = supabase.channel(`presence:${servicioId}`);
    
    channel.value
      .on('presence', { event: 'sync' }, () => {
        const state = channel.value?.presenceState() || {};
        operadorOnline.value = Object.keys(state).length > 0;
      })
      .subscribe(async (status) => {
        if (status === 'SUBSCRIBED') {
          await channel.value?.track({
            user_id: user.value?.id,
            online_at: new Date().toISOString()
          });
        }
      });
  };
  
  return { operadorOnline, connect };
};
```

---

## Vista Cliente

```vue
<template>
  <div class="operador-status">
    <span :class="['dot', operadorOnline ? 'online' : 'offline']" />
    {{ operadorOnline ? 'Operador conectado' : 'Esperando...' }}
  </div>
</template>
```

---

> [!NOTE]
> Presence es **opcional** — no crítico para MVP.

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.2 realtime_broadcast]]            |
| -------------------- | ---------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.2.4 error_handling]]              |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.2.6 rls_security]]              |
