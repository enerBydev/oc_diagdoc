---
id: 3.3.5
title: Horarios y Disponibilidad
parent: '3.3'
breadcrumb: 0 ‚Üí 3.0 ‚Üí 3.3 ‚Üí 3.3.5
type: hoja
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-05 12:40
domain:
- negocio
- horarios
- disponibilidad
actors:
- cliente
- operador
summary: L√≥gica de franjas horarias, festivos, domingos B2B.
content_hash: 469250cc2917977e
---

# 3.3.5 Horarios y Disponibilidad

> Franjas horarias, d√≠as festivos, excepciones.

---

## 1. Horario Est√°ndar

| D√≠a | Horario B2C | Horario B2B |
|-----|-------------|-------------|
| Lunes-Viernes | 8:00 - 19:00 | 7:00 - 20:00 |
| S√°bado | 9:00 - 17:00 | 8:00 - 18:00 |
| Domingo | Cerrado | Solo B2B contrato |

---

## 2. Configuraci√≥n de Zona Horaria

El sistema opera en la zona horaria local de cada ciudad. Default: `America/Monterrey`.

```typescript
// config/timezone.ts
export const DEFAULT_TIMEZONE = 'America/Monterrey';

// Mapa de zonas por ciudad (futuro multi-ciudad)
export const CITY_TIMEZONES: Record<string, string> = {
  'nuevo_laredo': 'America/Monterrey',
  'laredo_tx': 'America/Chicago', // Futuro
};

import { TZDate } from '@date-fns/tz';

export const toLocalTime = (utc: Date, city = 'nuevo_laredo'): TZDate => {
  const tz = CITY_TIMEZONES[city] || DEFAULT_TIMEZONE;
  return new TZDate(utc, tz);
};

export const isWithinBusinessHours = (time: Date, clientType: 'b2c' | 'b2b'): boolean => {
  const local = toLocalTime(time);
  const hour = local.getHours();
  const dayOfWeek = local.getDay(); // 0=Domingo
  
  if (clientType === 'b2c') {
    if (dayOfWeek === 0) return false; // Domingos cerrado
    if (dayOfWeek === 6) return hour >= 9 && hour < 17;
    return hour >= 8 && hour < 19;
  }
  
  // B2B
  if (dayOfWeek === 0) return true; // Domingos permitido
  if (dayOfWeek === 6) return hour >= 8 && hour < 18;
  return hour >= 7 && hour < 20;
};
```

---

## 3. D√≠as Festivos (Din√°micos)

Los festivos se gestionan desde Admin y se almacenan en BD.

```sql
CREATE TABLE IF NOT EXISTS festivos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  fecha DATE NOT NULL UNIQUE,
  nombre VARCHAR(100) NOT NULL,
  tipo VARCHAR(20) DEFAULT 'nacional', -- 'nacional', 'local', 'empresa'
  aplica_b2c BOOLEAN DEFAULT TRUE,
  aplica_b2b BOOLEAN DEFAULT FALSE,
  ciudad VARCHAR(50), -- NULL = todas
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Festivos 2026
INSERT INTO festivos (fecha, nombre) VALUES
  ('2026-01-01', 'A√±o Nuevo'),
  ('2026-02-02', 'D√≠a Constituci√≥n (observado)'),
  ('2026-03-16', 'Natalicio Benito Ju√°rez (observado)'),
  ('2026-05-01', 'D√≠a del Trabajo'),
  ('2026-09-16', 'D√≠a Independencia'),
  ('2026-11-16', 'D√≠a Revoluci√≥n (observado)'),
  ('2026-12-25', 'Navidad');
```

---

## 4. C√°lculo de Slots Disponibles

```typescript
interface Slot {
  inicio: Date;
  fin: Date;
  duracion_minutos: number;
}

const getAvailableSlots = async (
  date: Date, 
  operadorId: string,
  servicio_duracion: number
): Promise<Slot[]> => {
  // 1. Obtener horario base del d√≠a
  const baseSlots = getBusinessHoursForDay(date);
  
  // 2. Verificar si es festivo
  const esFestivo = await isFestivo(date);
  if (esFestivo) return []; // Cerrado
  
  // 3. Obtener citas ya agendadas del operador
  const citasDelDia = await getCitasForOperador(operadorId, date);
  
  // 4. Restar citas + buffer (30 min entre servicios)
  const BUFFER_MINUTOS = 30;
  const slotsOcupados = citasDelDia.map(c => ({
    inicio: c.fecha_inicio,
    fin: addMinutes(c.fecha_fin, BUFFER_MINUTOS)
  }));
  
  // 5. Calcular slots libres que quepan el servicio
  return subtractAndFilter(baseSlots, slotsOcupados, servicio_duracion);
};
```

---

## 5. Horarios Especiales

| Caso | Horario | Condici√≥n |
|------|---------|-----------|
| Horario extendido B2B | 6:00 - 22:00 | Contrato Premium |
| Black Friday | 7:00 - 21:00 | Feature Flag `extended_hours` |
| Madrugada (detailing) | 5:00 - 8:00 | Solo servicios espec√≠ficos |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre | [[Proyecto OnlyCarNLD/Datos/3.3. reglas_negocio]] |
|----------|-------------------------|
| ‚¨ÖÔ∏è Anterior | [[Proyecto OnlyCarNLD/Datos/3.3.4 Politicas_Reagendamiento]] |
| ‚û°Ô∏è Siguiente | [[Proyecto OnlyCarNLD/Datos/3.3.6 Radio_Servicio]] |
| üîó Relacionado | [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]] |
| üîó Relacionado | [[Proyecto OnlyCarNLD/Datos/1.3.6.1 asignacion_citas]] |

---

