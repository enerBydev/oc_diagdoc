---
id: 2.9.1
title: API Routes
parent: '2.9'
breadcrumb: 0 → 2.0 → 2.9 → 2.9.1
type: especificacion
domain:
- api
- endpoints
- h3
- zod
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-04 21:33
summary: 'Definición de endpoints en server/api.

  Manejo de eventos H3, validación con Zod y respuestas estandarizadas.'
content_hash: b5069e51cd959f97
---

# 2.9.1 API Routes

> Puntos de entrada para la lógica de negocio segura.

> **ARQUITECTURA vs CONTRATO:**
> Este documento define **CÓMO** se implementan las rutas en el servidor (Nitro).
> Para ver **QUÉ** rutas existen y sus contratos de datos, consultar: [[Proyecto OnlyCarNLD/Datos/4.6 API_Specification]].

---

## Estructura de Endpoints

Todos los archivos en `server/api/` se convierten automáticamente en rutas `/api/...`.

```ts
// server/api/bookings/create.post.ts
export default defineEventHandler(async (event) => {
  // .. lógica
})
```

### Convención de Nombres
- `[modelo].get.ts`: Listar/Obtener.
- `[modelo].post.ts`: Crear.
- `[modelo].put.ts`: Actualizar.
- `[modelo].delete.ts`: Eliminar.
- `[file].ts`: Soporta cualquier método (no recomendado, ser explícito).

---

## Validación de Inputs (Zod)

Validamos estrictamente lo que entra al servidor.

```ts
import { z } from 'zod'

const bodySchema = z.object({
  serviceId: z.string().uuid(),
  userLocation: z.object({
    lat: z.number(),
    lng: z.number()
  })
})

export default defineEventHandler(async (event) => {
  const body = await readValidatedBody(event, bodySchema.parse)
  // 'body' ahora está tipado y validado
})
```

---

## Manejo de Errores (H3)

Usar `createError` de H3 para retornar códigos HTTP correctos.

```ts
if (!service.isAvailable) {
  throw createError({
    statusCode: 409, // Conflict
    statusMessage: 'El servicio no está disponible en este horario',
    data: { availableSlots: [] } // Metadata opcional
  })
}
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.9. Arquitectura_Backend]]   |
| -------------------- | ------------------------------- |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.9.2 Server_Middleware]]     |

---
