---
id: 2.17.3
title: Image Optimization
parent: '2.17'
breadcrumb: 0 → 2.0 → 2.17 → 2.17.3
type: optimizacion
children_count: 0
descendants_count: 0
status: activo
domain:
- performance
- images
- nuxt-image
- webp
actors:
- desarrollador
- diseñador
summary: 'Optimización de imágenes: Nuxt Image, formatos modernos (WebP/AVIF), lazy
  loading y responsive images.'
last_updated: 2026-01-29 15:31
file_create: 2026-01-22 23:15
content_hash: 36e8b8d4a68066f4
---

# 2.17.3 Image Optimization

> Las imágenes son el 60%+ del peso de una página web típica.

---

## Stack de Optimización

| Capa | Tecnología | Función |
|------|------------|---------|
| **Build Time** | Nuxt Image | Resize, format conversion |
| **CDN** | Cloudflare Polish | Auto-optimization |
| **Runtime** | Native lazy loading | Defer off-screen |
| **Storage** | Supabase + Cloudflare R2 | Origin CDN |

---

## Configuración Nuxt Image

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ['@nuxt/image'],
  
  image: {
    provider: 'cloudflare',
    cloudflare: {
      baseURL: 'https://imagedelivery.net/your-account'
    },
    quality: 80,
    format: ['webp', 'avif', 'jpg'],
    screens: {
      xs: 320,
      sm: 640,
      md: 768,
      lg: 1024,
      xl: 1280
    }
  }
})
```

---

## Uso en Componentes

### Imagen Responsiva

```vue
<template>
  <NuxtImg
    src="/vehiculo.jpg"
    alt="Vehículo"
    width="800"
    height="600"
    sizes="sm:100vw md:50vw lg:400px"
    loading="lazy"
    format="webp"
    quality="80"
    placeholder
  />
</template>
```

### Background con Blur Placeholder

```vue
<template>
  <NuxtPicture
    src="/hero-bg.jpg"
    :img-attrs="{ class: 'hero-image' }"
    placeholder="blur"
    loading="eager"
  />
</template>
```

---

## Formatos Modernos

| Formato | Soporte | Ahorro vs JPG |
|---------|---------|---------------|
| **WebP** | 97%+ browsers | -25-35% |
| **AVIF** | 85% browsers | -40-50% |
| **JPG** | 100% (fallback) | baseline |

```html
<!-- Generado automáticamente por NuxtPicture -->
<picture>
  <source type="image/avif" srcset="...">
  <source type="image/webp" srcset="...">
  <img src="photo.jpg" alt="...">
</picture>
```

---

## Subida de Imágenes (Usuario)

### Pipeline de Procesamiento

```mermaid
flowchart LR
    U[Usuario Sube] --> V[Validar]
    V --> R[Resize max 2000px]
    R --> C[Convert to WebP]
    C --> S[Store en Supabase]
    S --> CDN[Cloudflare CDN]
```

### Código de Procesamiento

```typescript
// server/api/upload-image.post.ts
import sharp from 'sharp';

export default defineEventHandler(async (event) => {
  const file = await readMultipartFormData(event);
  
  const optimized = await sharp(file[0].data)
    .resize(2000, 2000, { 
      fit: 'inside',
      withoutEnlargement: true 
    })
    .webp({ quality: 85 })
    .toBuffer();

  // Upload to Supabase Storage
  const { data } = await supabase.storage
    .from('images')
    .upload(`${uuid()}.webp`, optimized, {
      contentType: 'image/webp'
    });

  return { url: data.path };
});
```

---

## Métricas Objetivo

| Métrica | Objetivo | Herramienta |
|---------|----------|-------------|
| LCP Image | < 2.5s | Lighthouse |
| Img bytes/page | < 500 KB | WebPageTest |
| Format modern | > 90% | Analytics |

---

## Relaciones

- Complementa: [[Proyecto OnlyCarNLD/Datos/2.17.2 Bundle_Optimization|Bundle JS]]
- Almacena en: [[Proyecto OnlyCarNLD/Datos/2.15.2 Almacenamiento_CDN|CDN]]
- Procesa en: [[Proyecto OnlyCarNLD/Datos/2.15.1 Procesamiento_Imagenes|Procesamiento]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.17. Performance_Strategy]]   |
| -------------------- | -------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.17.2 Bundle_Optimization]]   |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.17.4 Cache_Strategy]]        |

---
