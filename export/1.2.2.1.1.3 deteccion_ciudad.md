---
id: 1.2.2.1.1.3
title: DetecciÃ³n de Ciudad
parent: 1.2.2.1.1
breadcrumb: 0 â†’ 1.0 â†’ 1.2 â†’ 1.2.2 â†’ 1.2.2.1 â†’ 1.2.2.1.1 â†’ 1.2.2.1.1.3
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 00:22
domain:
- operador
- ciudades
- validacion
- geolocalizacion
summary: 'Validar si la ciudad del prospecto estÃ¡ disponible.

  Redirige a lista de espera si no estÃ¡ activa.

  '
content_hash: 73bd6e3cf45b9a3f
---

# 1.2.2.1.1.3 DetecciÃ³n de Ciudad

> Validar si la ciudad del prospecto estÃ¡ disponible.

---

## Flujo

```mermaid
flowchart TD
    A[Prospecto selecciona ciudad] --> B{Â¿Existe en sistema?}
    B -->|No| C[ciudad_id = NULL]
    B -->|SÃ­| D{Â¿Estado activa/piloto?}
    D -->|No| E[ciudad_id = NULL]
    D -->|SÃ­| F[ciudad_id = UUID]
    
    C --> G[Redirigir a lista espera]
    E --> G
    F --> H[Continuar registro]
```

---

## ImplementaciÃ³n

```typescript
// utils/detectarCiudad.ts
export const detectarCiudadDisponible = async (
  estado: string,
  ciudad: string
): Promise<{ disponible: boolean; ciudadId?: string; motivo?: string }> => {
  const supabase = useSupabaseClient();
  
  const { data } = await supabase
    .from('ciudades')
    .select('id, nombre, estado')
    .eq('nombre', ciudad)
    .single();
  
  if (!data) {
    return { disponible: false, motivo: 'ciudad_no_existe' };
  }
  
  if (!['activa', 'piloto'].includes(data.estado)) {
    return { disponible: false, ciudadId: data.id, motivo: 'ciudad_no_activa' };
  }
  
  return { disponible: true, ciudadId: data.id };
};
```

---

## UI: Ciudad No Disponible

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ˜” CIUDAD NO DISPONIBLE                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  AÃºn no operamos en: Monterrey, Nuevo LeÃ³n                      â”‚
â”‚                                                                 â”‚
â”‚  Â¡Pero estamos creciendo!                                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ DÃ©janos tus datos y te avisaremos cuando                â”‚    â”‚
â”‚  â”‚ lleguemos a tu ciudad.                                  â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚ Como bono, serÃ¡s de los primeros operadores             â”‚    â”‚
â”‚  â”‚ y tendrÃ¡s prioridad en la asignaciÃ³n de servicios.      â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚ [ Avisarme cuando estÃ© disponible ]                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â„¹ï¸ Ya hay 12 operadores interesados en Monterrey               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.1 flujo_solicitud]]        |
| -------------------- | ------------------------------------ |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.1.2 formulario_solicitud]] |
| ğŸ”— Ver tambiÃ©n       | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.8 ciudad_no_disponible]]   |

---
