---
id: 4.6.8
title: Rate Limiting
parent: '4.6'
breadcrumb: 0 → 4.0 → 4.6 → 4.6.8
type: hoja
status: activo
last_updated: 2026-01-29 16:01
file_create: 2026-01-05 19:55
domain:
- api
- rate_limiting
- seguridad
actors:
- desarrollador
- devops
summary: Especificación de límites de tasa por endpoint y rol.
content_hash: 4e7d7190cb4637e9
---

# 4.6.8 Rate Limiting

> Límites de solicitudes por endpoint, rol y tier.

---

## Estrategia General

| Aspecto | Decisión |
|---------|----------|
| Algoritmo | Token Bucket |
| Identificador | IP + User ID |
| Storage | Cloudflare Workers KV |
| Headers | `X-RateLimit-*` |

---

## Límites por Endpoint

| Endpoint | Límite | Ventana | Burst |
|----------|--------|---------|-------|
| `POST /api/auth/*` | 10 | 1 min | 5 |
| `GET /api/catalogo/*` | 100 | 1 min | 50 |
| `POST /api/citas` | 20 | 1 min | 10 |
| `GET /api/*` (auth) | 200 | 1 min | 100 |
| `POST /api/webhooks/*` | 1000 | 1 min | 500 |
| `POST /api/operador/ubicacion` | 60 | 1 min | 30 |

---

## Límites por Rol

| Rol | Multiplicador | Límite Efectivo |
|-----|---------------|-----------------|
| Anónimo | 0.5x | 50 req/min |
| Cliente B2C | 1x | 100 req/min |
| Cliente B2B | 2x | 200 req/min |
| Corporate+ | 3x | 300 req/min |
| Operador | 2x | 200 req/min |
| Admin | 10x | 1000 req/min |

---

## Headers de Respuesta

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1704492000
Retry-After: 45
```

---

## Respuesta 429

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Demasiadas solicitudes. Intenta de nuevo en 45 segundos.",
    "retry_after": 45
  }
}
```

---

## Implementación Cloudflare

```typescript
// middleware/rateLimit.ts
export default defineEventHandler(async (event) => {
  const key = `rate:${getClientIp(event)}:${getUserId(event) || 'anon'}`;
  const limit = await useRateLimiter(key, {
    limit: 100,
    window: 60,
  });
  
  if (!limit.success) {
    throw createError({
      statusCode: 429,
      message: 'Rate limit exceeded',
    });
  }
  
  setResponseHeaders(event, {
    'X-RateLimit-Limit': limit.limit,
    'X-RateLimit-Remaining': limit.remaining,
    'X-RateLimit-Reset': limit.reset,
  });
});
```

---

## Request/Response Schema

```typescript
interface RequestBody {
  // Ver OpenAPI spec completa
}

interface ResponseBody {
  success: boolean;
  data?: object;
  error?: ErrorResponse;
}
```

---

## Ejemplo curl

```bash
curl -X GET https://api.onlycar.mx/endpoint \
  -H "Authorization: Bearer TOKEN"
```


## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/4.6 API_Specification]] |
|----------|---------------------------|
| ⬅️ Anterior | [[Proyecto OnlyCarNLD/Datos/4.6.7 Error_Codes]] |

---
