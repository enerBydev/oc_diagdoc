---
id: 1.2.2.1.3.3
title: M√≥dulo de Antecedentes
parent: 1.2.2.1.3
breadcrumb: 0 ‚Üí 1.0 ‚Üí 1.2 ‚Üí 1.2.2 ‚Üí 1.2.2.1 ‚Üí 1.2.2.1.3 ‚Üí 1.2.2.1.3.3
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 00:27
domain:
- operador
- antecedentes
- arquitectura
- strategy_pattern
summary: 'Arquitectura abstracta para providers de verificaci√≥n de antecedentes.

  Declaraci√≥n (activo) o Verificaid (preparado).

  '
content_hash: 4c19ce293384b10a
---

# 1.2.2.1.3.3 M√≥dulo de Antecedentes

> Arquitectura abstracta para providers de verificaci√≥n de antecedentes.

---

## Interface

```typescript
// types/backgroundCheck.ts
export interface BackgroundCheckData {
  solicitudId: string;
  nombre: string;
  apellidos: string;
  curp: string;
}

export interface BackgroundCheckResult {
  status: 'pending' | 'approved' | 'declined';
  checkId?: string;
  details?: Record<string, any>;
}

export interface IBackgroundCheckProvider {
  name: string;
  startCheck(data: BackgroundCheckData): Promise<BackgroundCheckResult>;
  getStatus(checkId: string): Promise<BackgroundCheckResult>;
}
```

---

## Implementaci√≥n Declaraci√≥n

```typescript
// providers/DeclaracionProvider.ts
export class DeclaracionProvider implements IBackgroundCheckProvider {
  name = 'declaracion';
  
  async startCheck(data: BackgroundCheckData): Promise<BackgroundCheckResult> {
    // La declaraci√≥n ya fue aceptada en paso anterior
    // Solo verificar que existe
    
    const { data: declaracion } = await supabase
      .from('operador_declaraciones')
      .select('aceptado')
      .eq('solicitud_id', data.solicitudId)
      .eq('tipo', 'antecedentes')
      .single();
    
    if (declaracion?.aceptado) {
      return { status: 'approved' };
    }
    
    return { status: 'pending' };
  }
  
  async getStatus(solicitudId: string): Promise<BackgroundCheckResult> {
    return this.startCheck({ solicitudId } as any);
  }
}
```

---

## Implementaci√≥n Verificaid (Stub)

```typescript
// providers/VerificaidProvider.ts
export class VerificaidProvider implements IBackgroundCheckProvider {
  name = 'verificaid';
  private config: VerificaidConfig;
  
  constructor(config: VerificaidConfig) {
    this.config = config;
  }
  
  async startCheck(data: BackgroundCheckData): Promise<BackgroundCheckResult> {
    const response = await $fetch(`${this.config.base_url}/checks`, {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${this.config.api_key}` },
      body: {
        type: 'criminal_record',
        subject: {
          first_name: data.nombre,
          last_name: data.apellidos,
          curp: data.curp
        }
      }
    });
    
    return {
      status: 'pending',
      checkId: response.id
    };
  }
  
  async getStatus(checkId: string): Promise<BackgroundCheckResult> {
    const response = await $fetch(
      `${this.config.base_url}/checks/${checkId}`,
      { headers: { 'Authorization': `Bearer ${this.config.api_key}` }}
    );
    
    return {
      status: response.status === 'clear' ? 'approved' : 'declined',
      details: response
    };
  }
}
```

---

## Factory

```typescript
// factories/backgroundCheckFactory.ts
export const getBackgroundCheckProvider = async (): Promise<IBackgroundCheckProvider> => {
  const config = await getRemoteConfig('verificacion_antecedentes');
  
  switch (config.provider) {
    case 'verificaid':
      if (!config.verificaid?.enabled) {
        return new DeclaracionProvider();
      }
      return new VerificaidProvider(config.verificaid);
    
    case 'declaracion':
    default:
      return new DeclaracionProvider();
  }
};
```

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.3 verificacion_antecedentes]] |
| -------------------- | --------------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.3.2 integracion_verificaid]]  |
| üîó Ver tambi√©n       | [[Proyecto OnlyCarNLD/Datos/1.2.2.1.2.5 modulo_verificacion]]     |

---
