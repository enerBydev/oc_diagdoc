---
id: 2.9.4
title: Edge Functions
parent: '2.9'
breadcrumb: 0 → 2.0 → 2.9 → 2.9.4
type: arquitectura
status: activo
domain:
- backend
- edge
- cloudflare
- serverless
summary: 'Implementación de lógica en el Edge (Cloudflare Workers) para baja latencia:
  Authentication proxy, redirecciones y A/B Testing.'
last_updated: 2026-01-29 15:32
content_hash: 42dc96234f19c599
---

# 2.9.4 Edge Functions

> Ejecución de código lo más cerca posible del usuario final.

---

## Tecnología: Cloudflare Workers
OnlyCar utiliza Cloudflare como capa de CDN y Edge Computing. Nitro (el motor de Nuxt) compila limpiamente a formato Worker.

---

## Casos de Uso Aprobados

### 1. Geo-Routing y Redirecciones
Detectar la región del request (header `cf-ipcountry`) y redirigir a versiones localizadas o bloquear tráfico de países sancionados/no operativos.

### 2. Autenticación Ligera (Middleware at Edge)
Verificar JWTs simples antes de tocar el servidor principal o la base de datos. Si el token es inválido, rechazar en el Edge (<10ms).

### 3. A/B Testing
Servir diferentes variantes de la página estática modificando el HTML al vuelo (HTMLRewriter) basado en cookies de sesión.

---

## Limitaciones (Runtime V8 Isolate)
A diferencia de Node.js completo:
- **No hay Filesystem**: No se puede leer/escribir disco.
- **Tiempo de ejecución**: Límite estricto de CPU (generalmente 10-50ms).
- **Paquetes Nativos**: Módulos que dependen de binarios de C++ no funcionan.

*Para tareas pesadas o largas, usar Background Jobs (2.9.3) o API Routes estándar.*

---

## Integración con KV (Key-Value)
Base de datos eventual consistente global de Cloudflare.
- **Uso**: Cachear respuestas de API pesadas, Configuración de Feature Flags, Blacklists de IPs.

```typescript
// Ejemplo lectura KV en Nitro
const value = await useStorage('kv').getItem('my-key');
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.9. Arquitectura_Backend]] |
| -------------------- | ----------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.9.3 Background_Jobs]]     |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.9.5 Database_Interface]]  |

---
