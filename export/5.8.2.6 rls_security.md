---
id: 5.8.2.6
title: RLS Security
parent: 5.8.2
breadcrumb: 0 → 5.0 → 5.8 → 5.8.2 → 5.8.2.6
type: seguridad
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:10
domain:
- rls
- supabase
- permisos
summary: Seguridad RLS para canales.
content_hash: 327886c4b713699b
---

# 5.8.2.6 RLS Security

Seguridad de canales Realtime con Row Level Security.

---

## Modelo de Permisos

| Actor | Broadcast | Listen |
|-------|-----------|--------|
| Operador del servicio | ✅ | ✅ |
| Cliente del servicio | ❌ | ✅ |
| Otro usuario | ❌ | ❌ |
| Admin | ✅ | ✅ |

---

## Seguridad Implícita

Los canales de Supabase Realtime son **públicos por defecto**.

**Protección actual:**
1. Nombres de canal son UUIDs (difícil de adivinar)
2. Solo participantes conocen el `servicioId`
3. Backend valida antes de persistir

---

## Autorización Explícita (Opcional)

```typescript
// Middleware: Verificar permisos antes de broadcast
const canBroadcast = async (userId: string, servicioId: string) => {
  const { data } = await supabase
    .from('servicios')
    .select('operador_id')
    .eq('id', servicioId)
    .single();
  
  return data?.operador_id === userId;
};
```

---

## RLS en Tablas

Las políticas RLS en `ubicaciones_servicio` y `ubicacion_actual` aseguran que:

- Solo el operador asignado puede **escribir**
- Solo cliente/operador/admin pueden **leer**

→ Ver: [[Proyecto OnlyCarNLD/Datos/5.8.6.3 rls_policies]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.2 realtime_broadcast]]            |
| -------------------- | ---------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.2.5 presence_tracking]]              |
