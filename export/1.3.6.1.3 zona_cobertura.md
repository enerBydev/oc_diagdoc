---
id: 1.3.6.1.3
title: Zonas de Cobertura
parent: 1.3.6.1
breadcrumb: 0 â†’ 1.0 â†’ 1.3 â†’ 1.3.6 â†’ 1.3.6.1 â†’ 1.3.6.1.3
type: hoja
status: activo
domain: comunicacion
summary: Sistema de geofencing para Ã¡reas de servicio con zonas circulares o polÃ­gonos
  PostGIS, tarifas extras y asignaciÃ³n operador-zona.
version: 1.0
last_updated: 2026-01-29 15:32
file_create: 2025-12-26 13:05
actors:
- operador
- admin
dependencies:
- postgis
affects:
- 1.3.6.1 asignacion_citas
content_hash: 2d1c3b3736f2e667
---

# 1.3.6.1.3 Zonas de Cobertura

Sistema de geofencing para delimitar Ã¡reas de servicio.

---

## Arquitectura de Zonas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NUEVO LAREDO - ZONAS DE SERVICIO                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚                    ZONA NORTE                       â”‚     â”‚
â”‚     â”‚              (Colonias residenciales)               â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                           â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚      ZONA CENTRO     â”‚    ZONA INDUSTRIAL   â”‚              â”‚
â”‚    â”‚    (Comercial)       â”‚    (Empresas B2B)    â”‚              â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                           â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚                    ZONA SUR                         â”‚     â”‚
â”‚     â”‚              (PerifÃ©rico, menos densidad)           â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Modelo de Datos

### Sin PostGIS (CÃ­rculos simples)

```sql
-- Zonas definidas por centro + radio
CREATE TABLE zonas (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  nombre VARCHAR(100) NOT NULL,
  descripcion TEXT,
  centro_lat DECIMAL(10, 8) NOT NULL,
  centro_lng DECIMAL(11, 8) NOT NULL,
  radio_km DECIMAL(5, 2) NOT NULL,
  tarifa_extra DECIMAL(10, 2) DEFAULT 0,  -- Cargo adicional
  activa BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- AsignaciÃ³n zona-operador
CREATE TABLE zonas_operador (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  operador_id UUID NOT NULL REFERENCES operadores(id),
  zona_id UUID NOT NULL REFERENCES zonas(id),
  es_principal BOOLEAN DEFAULT false,  -- Zona prioritaria
  created_at TIMESTAMPTZ DEFAULT now(),
  
  UNIQUE (operador_id, zona_id)
);
```

### Con PostGIS (PolÃ­gonos precisos)

```sql
-- ExtensiÃ³n geoespacial
CREATE EXTENSION IF NOT EXISTS postgis;

-- Zonas con polÃ­gonos
CREATE TABLE zonas_poligono (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  nombre VARCHAR(100) NOT NULL,
  descripcion TEXT,
  poligono GEOMETRY(POLYGON, 4326) NOT NULL,
  tarifa_extra DECIMAL(10, 2) DEFAULT 0,
  activa BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Ãndice espacial
CREATE INDEX idx_zonas_geo ON zonas_poligono USING GIST(poligono);

-- Verificar si punto estÃ¡ en zona
SELECT id, nombre
FROM zonas_poligono
WHERE ST_Contains(poligono, ST_SetSRID(ST_MakePoint($lng, $lat), 4326));
```

---

## FunciÃ³n: Punto en Zona (Sin PostGIS)

```sql
-- Verificar si coordenadas estÃ¡n dentro de una zona circular
CREATE OR REPLACE FUNCTION punto_en_zona(
  p_lat DECIMAL,
  p_lng DECIMAL,
  p_zona_id UUID
) RETURNS BOOLEAN AS $$
DECLARE
  v_zona zonas;
  v_distancia DECIMAL;
BEGIN
  SELECT * INTO v_zona FROM zonas WHERE id = p_zona_id;
  
  IF NOT FOUND THEN
    RETURN false;
  END IF;
  
  -- Calcular distancia en km
  v_distancia := calcular_distancia(
    v_zona.centro_lat, v_zona.centro_lng,
    p_lat, p_lng
  ) / 1000;
  
  RETURN v_distancia <= v_zona.radio_km;
END;
$$ LANGUAGE plpgsql;
```

---

## Zonas por Defecto (Nuevo Laredo)

```sql
INSERT INTO zonas (nombre, descripcion, centro_lat, centro_lng, radio_km, tarifa_extra) VALUES
  ('Centro', 'Zona comercial centro', 27.5006, -99.5075, 3.0, 0),
  ('Norte', 'Colonias residenciales norte', 27.5200, -99.5100, 4.0, 25),
  ('Sur', 'PerifÃ©rico sur', 27.4800, -99.5050, 5.0, 50),
  ('Industrial', 'Parques industriales', 27.5100, -99.4800, 4.0, 0),
  ('Puente', 'Cerca del puente internacional', 27.5030, -99.5200, 2.0, 75);
```

---

## Interfaz: ConfiguraciÃ³n de Zonas (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ—ºï¸ GESTIÃ“N DE ZONAS                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               [MAPA INTERACTIVO]                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚     â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®                                         â”‚    â”‚
â”‚  â”‚    â•±   NORTE   â•²                                        â”‚    â”‚
â”‚  â”‚   â•±             â•²                                       â”‚    â”‚
â”‚  â”‚  â”‚  CENTRO       â”‚  INDUSTRIAL                          â”‚    â”‚
â”‚  â”‚   â•²             â•±                                       â”‚    â”‚
â”‚  â”‚    â•²   SUR     â•±                                        â”‚    â”‚
â”‚  â”‚     â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯                                         â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  ZONAS ACTIVAS:                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸŸ¢ Centro      â”‚ 3 km radio  â”‚ Sin tarifa extra â”‚  âœï¸ ğŸ—‘ï¸â”‚    â”‚
â”‚  â”‚ ğŸŸ¢ Norte       â”‚ 4 km radio  â”‚ +$25             â”‚  âœï¸ ğŸ—‘ï¸â”‚    â”‚
â”‚  â”‚ ğŸŸ¢ Industrial  â”‚ 4 km radio  â”‚ Sin tarifa extra â”‚  âœï¸ ğŸ—‘ï¸â”‚    â”‚
â”‚  â”‚ ğŸŸ¡ Sur         â”‚ 5 km radio  â”‚ +$50             â”‚  âœï¸ ğŸ—‘ï¸â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  [ + Crear nueva zona ]                                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Interfaz: Mis Zonas (Operador)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ MIS ZONAS DE TRABAJO                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Selecciona las zonas donde ofreces servicio:                   â”‚
â”‚                                                                 â”‚
â”‚  [âœ“] Centro (principal)    â­                                   â”‚
â”‚  [âœ“] Norte                 +$25 para cliente                    â”‚
â”‚  [ ] Sur                   +$50 para cliente                    â”‚
â”‚  [âœ“] Industrial                                                 â”‚
â”‚  [ ] Puente                +$75 para cliente                    â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ MÃ­nimo 1 zona, mÃ¡ximo 4 zonas                               â”‚
â”‚                                                                 â”‚
â”‚  [ Guardar cambios ]                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Composable: useZones

```typescript
// composables/useZones.ts
export const useZones = () => {
  const supabase = useSupabaseClient();
  
  // Obtener zona de una ubicaciÃ³n
  const getZoneForLocation = async (lat: number, lng: number) => {
    const { data: zonas } = await supabase
      .from('zonas')
      .select('*')
      .eq('activa', true);
    
    for (const zona of zonas || []) {
      const distancia = calcularDistanciaHaversine(
        zona.centro_lat, zona.centro_lng,
        lat, lng
      );
      
      if (distancia <= zona.radio_km * 1000) {
        return zona;
      }
    }
    
    return null; // Fuera de cobertura
  };
  
  // Operadores en una zona
  const getOperatorsInZone = async (zonaId: string) => {
    const { data } = await supabase
      .from('zonas_operador')
      .select(`
        operador_id,
        es_principal,
        operadores (id, nombre, rating_promedio)
      `)
      .eq('zona_id', zonaId);
    
    return data;
  };
  
  return { getZoneForLocation, getOperatorsInZone };
};
```

---

## Reglas de Zona

| Regla | DescripciÃ³n |
|-------|-------------|
| **ZON-001** | Cliente fuera de todas las zonas = No disponible |
| **ZON-002** | Tarifa extra se suma al precio base |
| **ZON-003** | Operador debe tener â‰¥1 zona activa |
| **ZON-004** | Zona principal tiene prioridad en matching |
| **ZON-005** | Admin puede crear/editar zonas en mapa |

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/1.3.6.1 asignacion_citas]]             |
| -------------------- | ---------------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.2 disponibilidad_operadores]]  |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.4 broadcast_solicitud]]        |

---
