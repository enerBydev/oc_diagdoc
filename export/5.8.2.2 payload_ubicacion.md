---
id: 5.8.2.2
title: Payload Ubicación
parent: 5.8.2
breadcrumb: 0 → 5.0 → 5.8 → 5.8.2 → 5.8.2.2
type: esquema
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:10
domain:
- ubicacion
- payload
- json
summary: Estructura del payload de ubicación.
content_hash: 209a496162c2dcd5
---

# 5.8.2.2 Payload de Ubicación

Estructura de datos para broadcast de ubicación.

---

## Interfaz TypeScript

```typescript
// types/geolocation.ts

/**
 * Payload enviado por el operador
 */
export interface LocationPayload {
  // Coordenadas obligatorias
  lat: number;               // Latitud (-90 a 90)
  lng: number;               // Longitud (-180 a 180)
  
  // Metadata obligatoria
  timestamp: number;         // Unix timestamp ms
  
  // Precisión (útil para UI)
  accuracy: number;          // Metros
  
  // Opcionales (cuando disponibles)
  heading?: number;          // Dirección 0-360°
  speed?: number;            // Velocidad m/s
  altitude?: number;         // Altitud metros
}

/**
 * Payload de llegada
 */
export interface ArrivalPayload {
  timestamp: number;
  distanciaFinal: number;    // Metros al destino
  tiempoEnCamino: number;    // Segundos desde inicio
}

/**
 * Payload de retraso (opcional)
 */
export interface DelayPayload {
  timestamp: number;
  motivo: 'trafico' | 'otro_servicio' | 'imprevisto' | 'otro';
  minutosEstimados: number;
  mensaje?: string;
}
```

---

## Ejemplo de Payload

```json
{
  "lat": 27.4797,
  "lng": -99.5067,
  "timestamp": 1735120000000,
  "accuracy": 12.5,
  "heading": 45,
  "speed": 8.3
}
```

---

## Validación

```typescript
// utils/validatePayload.ts
import { z } from 'zod';

const LocationPayloadSchema = z.object({
  lat: z.number().min(-90).max(90),
  lng: z.number().min(-180).max(180),
  timestamp: z.number().positive(),
  accuracy: z.number().min(0).default(0),
  heading: z.number().min(0).max(360).optional(),
  speed: z.number().min(0).optional(),
  altitude: z.number().optional()
});

export const validateLocationPayload = (data: unknown) => {
  return LocationPayloadSchema.safeParse(data);
};

// Uso
const result = validateLocationPayload(payload);
if (!result.success) {
  console.error('Payload inválido:', result.error);
  return;
}
// result.data es el payload validado
```

---

## Tamaño del Payload

```
┌─────────────────────────────────────────────────────────────────┐
│  ANÁLISIS DE TAMAÑO                                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Payload mínimo (sin opcionales):                               │
│  {                                                              │
│    "lat": 27.4797,        // ~10 bytes                          │
│    "lng": -99.5067,       // ~11 bytes                          │
│    "timestamp": 1735120000000,  // ~18 bytes                    │
│    "accuracy": 12.5       // ~8 bytes                           │
│  }                                                              │
│  Total: ~60 bytes + overhead JSON = ~100 bytes                  │
│                                                                 │
│  Payload completo:                                              │
│  + heading, speed, altitude = ~150 bytes                        │
│                                                                 │
│  Broadcast cada 5 segundos = 12/minuto                          │
│  150 bytes × 12 = 1.8 KB/minuto                                 │
│  Servicio promedio 30 min en camino = 54 KB total               │
│                                                                 │
│  ✅ MUY bajo consumo de datos                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Compresión Opcional

```typescript
// Para reducir aún más el tamaño (opcional)
const compressPayload = (payload: LocationPayload): string => {
  // Formato: lat,lng,ts,acc[,head,speed]
  const parts = [
    payload.lat.toFixed(6),
    payload.lng.toFixed(6),
    payload.timestamp,
    payload.accuracy.toFixed(1)
  ];
  
  if (payload.heading !== undefined) {
    parts.push(payload.heading.toFixed(0));
  }
  if (payload.speed !== undefined) {
    parts.push(payload.speed.toFixed(1));
  }
  
  return parts.join(',');
};

const decompressPayload = (compressed: string): LocationPayload => {
  const parts = compressed.split(',');
  return {
    lat: parseFloat(parts[0]),
    lng: parseFloat(parts[1]),
    timestamp: parseInt(parts[2]),
    accuracy: parseFloat(parts[3]),
    heading: parts[4] ? parseFloat(parts[4]) : undefined,
    speed: parts[5] ? parseFloat(parts[5]) : undefined
  };
};

// Ejemplo:
// Original: {"lat":27.4797,"lng":-99.5067,"timestamp":1735120000000,"accuracy":12.5}
// Comprimido: "27.479700,-99.506700,1735120000000,12.5"
// Reducción: ~100 bytes → ~45 bytes (55% menos)
```

---

→ Ver mapas: [[Proyecto OnlyCarNLD/Datos/5.8.3 mapas_visualizacion]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.2 realtime_broadcast]]            |
| -------------------- | ---------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.2.1 channels_servicio]]              |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.2.3 reconnection_strategy]]              |
