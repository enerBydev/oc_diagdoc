---
id: 5.8.5.1
title: Haversine Formula
parent: 5.8.5
breadcrumb: 0 → 5.0 → 5.8 → 5.8.5 → 5.8.5.1
type: algoritmo
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:10
domain:
- haversine
- distancia
- gps
summary: Fórmula Haversine para calcular distancia.
content_hash: 38abb1bf25d655a3
---

# 5.8.5.1 Fórmula Haversine

Cálculo preciso de distancia entre dos puntos geográficos.

---

## Fórmula Matemática

```
La fórmula Haversine calcula la distancia del círculo máximo
entre dos puntos en una esfera (la Tierra).

a = sin²(Δφ/2) + cos(φ1) × cos(φ2) × sin²(Δλ/2)
c = 2 × atan2(√a, √(1−a))
d = R × c

Donde:
φ = latitud en radianes
λ = longitud en radianes
R = radio de la Tierra (6,371 km)
```

---

## Implementación TypeScript

```typescript
// utils/geoUtils.ts

/**
 * Radio de la Tierra en metros
 */
const EARTH_RADIUS_METERS = 6_371_000;

/**
 * Convertir grados a radianes
 */
const toRadians = (degrees: number): number => {
  return degrees * (Math.PI / 180);
};

/**
 * Calcular distancia entre dos puntos usando Haversine
 * @returns Distancia en metros
 */
export const calcularDistancia = (
  lat1: number,
  lng1: number,
  lat2: number,
  lng2: number
): number => {
  // Convertir a radianes
  const φ1 = toRadians(lat1);
  const φ2 = toRadians(lat2);
  const Δφ = toRadians(lat2 - lat1);
  const Δλ = toRadians(lng2 - lng1);
  
  // Fórmula Haversine
  const a = 
    Math.sin(Δφ / 2) ** 2 +
    Math.cos(φ1) * Math.cos(φ2) * 
    Math.sin(Δλ / 2) ** 2;
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  
  // Distancia en metros
  return EARTH_RADIUS_METERS * c;
};

/**
 * Calcular bearing (dirección) entre dos puntos
 * @returns Ángulo en grados (0-360)
 */
export const calcularBearing = (
  lat1: number,
  lng1: number,
  lat2: number,
  lng2: number
): number => {
  const φ1 = toRadians(lat1);
  const φ2 = toRadians(lat2);
  const Δλ = toRadians(lng2 - lng1);
  
  const y = Math.sin(Δλ) * Math.cos(φ2);
  const x = 
    Math.cos(φ1) * Math.sin(φ2) -
    Math.sin(φ1) * Math.cos(φ2) * Math.cos(Δλ);
  
  const θ = Math.atan2(y, x);
  
  // Convertir a grados y normalizar a 0-360
  return (θ * 180 / Math.PI + 360) % 360;
};

/**
 * Estimar tiempo de llegada basado en distancia
 * @param distanciaMetros Distancia en metros
 * @param velocidadKmh Velocidad estimada (default: 30 km/h ciudad)
 * @returns Tiempo estimado en minutos
 */
export const estimarTiempoLlegada = (
  distanciaMetros: number,
  velocidadKmh: number = 30
): number => {
  const distanciaKm = distanciaMetros / 1000;
  const tiempoHoras = distanciaKm / velocidadKmh;
  return Math.ceil(tiempoHoras * 60); // Minutos
};
```

---

## Ejemplos de Uso

```typescript
// Ejemplo: Nuevo Laredo
const puntoA = { lat: 27.4797, lng: -99.5067 }; // Centro
const puntoB = { lat: 27.5000, lng: -99.5200 }; // Otro punto

const distancia = calcularDistancia(
  puntoA.lat, puntoA.lng,
  puntoB.lat, puntoB.lng
);

console.log(`Distancia: ${distancia.toFixed(0)}m`); // ~2,800m

const eta = estimarTiempoLlegada(distancia);
console.log(`ETA: ${eta} minutos`); // ~6 minutos
```

---

## Precisión

```
┌─────────────────────────────────────────────────────────────────┐
│  PRECISIÓN DE HAVERSINE                                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Distancia real       Haversine      Error                      │
│  ─────────────────────────────────────────────────              │
│  100 metros           100.0m         < 0.1%                     │
│  1 kilómetro          1,000.2m       < 0.1%                     │
│  10 kilómetros        10,001m        < 0.1%                     │
│  100 kilómetros       100,050m       < 0.1%                     │
│                                                                 │
│  ✅ Precisión excelente para distancias urbanas                 │
│  ✅ No requiere proyección cartográfica                         │
│  ✅ Funciona en cualquier parte del mundo                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Comparación con Alternativas

| Método | Precisión | Complejidad | Uso |
|--------|-----------|-------------|-----|
| **Haversine** | Alta | Baja | ✅ Recomendado |
| Vincenty | Muy alta | Media | Geodesia |
| Euclidiana | Baja | Muy baja | ❌ No usar |
| API Google | Alta | Alta | De pago |

---

## Composable

```typescript
// composables/useGeoUtils.ts
export const useGeoUtils = () => {
  return {
    calcularDistancia,
    calcularBearing,
    estimarTiempoLlegada,
    
    /**
     * Formatear distancia para UI
     */
    formatDistance: (metros: number): string => {
      if (metros < 1000) {
        return `${Math.round(metros)}m`;
      }
      return `${(metros / 1000).toFixed(1)}km`;
    },
    
    /**
     * Formatear ETA para UI
     */
    formatETA: (minutos: number): string => {
      if (minutos < 1) return 'Llegando...';
      if (minutos < 60) return `${minutos} min`;
      const horas = Math.floor(minutos / 60);
      const mins = minutos % 60;
      return `${horas}h ${mins}min`;
    }
  };
};
```

---

→ Ver módulo principal: [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.5 deteccion_llegada]]            |
| -------------------- | ---------------------- |
