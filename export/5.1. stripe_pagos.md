---
id: 5.1
title: Stripe - Pasarela de Pagos
parent: '5.0'
breadcrumb: 0 → 5.0 → 5.1
type: modulo_padre
children_count: 1
descendants_count: 1
actors:
- cliente_b2c
- cliente_b2b
- admin
domain:
- pagos
- stripe
- facturacion
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-01 23:42
summary: 'Pasarela de pagos Stripe: Link by Stripe + Gigstack para CFDI automático,

  suscripciones B2B, campos fiscales personalizados.'
content_hash: 0a12820464c9d1e6
---

# 5.1 STRIPE - PASARELA DE PAGOS

> Stripe actúa como la **pasarela de pagos** de OnlyCar, capturando tanto información de pago como **datos fiscales** del cliente.

> [!IMPORTANT]
> **Principio clave:** OnlyCar NO almacena datos fiscales. Stripe los captura y Gigstack los procesa.

---

## Métodos de Pago Implementados

### MÉTODO 1: Pago Digital Post-Servicio (Link by Stripe + Gigstack)

Una vez completado el servicio, el sistema genera automáticamente un Payment Link personalizado de Stripe. Este enlace se envía al cliente mediante múltiples canales: correo electrónico, WhatsApp y SMS como respaldo.

El cliente accede al enlace y completa un formulario único donde ingresa tanto sus datos de pago (tarjeta de crédito/débito) como sus datos fiscales (RFC, Razón Social, Régimen Fiscal, Uso de CFDI).

### MÉTODO 2: Pago B2B por Contrato (Suscripciones/Servicios Recurrentes)

Los clientes empresariales (B2B) pueden contratar planes mensuales que incluyen un número fijo de servicios por periodo. El sistema crea una suscripción recurrente en Stripe con cobro automático mensual.

**Tipos de contratos B2B:**
1. **Contrato por Servicio Prestado**: Pago único por servicio específico
2. **Contrato de Suscripción Mensual**: Cobro recurrente con X servicios incluidos

> Ambos contratos requieren el uso de firma digital de Mifiel

**Gestión de suscripciones:**

Para suscripciones mensuales, el sistema crea la suscripción en Stripe asociada a un precio predefinido. La suscripción se configura con cobro automático y un ciclo de facturación que inicia el día 1 de cada mes. Los metadatos incluyen el identificador del cliente, tipo de contrato, cantidad de servicios incluidos y nombre del plan.

El sistema almacena el contrato en la base de datos con referencia al subscription_id de Stripe, estado activo, fecha de inicio, servicios disponibles por mes, monto mensual y fecha del próximo cobro. Cada mes, cuando Stripe procesa el cobro, Gigstack recibe el webhook y genera automáticamente la factura mensual.

El sistema controla los servicios restantes del periodo. Cuando un cliente B2B solicita un servicio, el sistema verifica que aún tenga servicios disponibles en el mes actual. Al finalizar el servicio, decrementa el contador. Al inicio de cada periodo de facturación, el contador se reinicia automáticamente.

---

## Campos Fiscales en Payment Link

| Campo | Tipo | Validación |
|-------|------|------------|
| **RFC** | Texto | 12-13 caracteres, regex SAT |
| **Razón Social** | Texto | Obligatorio |
| **Régimen Fiscal** | Dropdown | Catálogo SAT (601-621) |
| **Uso de CFDI** | Dropdown | Catálogo SAT (G01, G03, etc.) |
| **Código Postal** | Billing address | Obligatorio |

---

## Costos por Transacción

| Método          | Costo Stripe    | Costo Gigstack | Total ($1000 MXN) |
| --------------- | --------------- | -------------- | ----------------- |
| Pago Digital    | 3.6% + $3 MXN   | ~$2-5 MXN      | ~$42-44 (4.2-4.4%)|
| Suscripción B2B | 3.6% + $3 MXN   | ~$2-5 MXN      | ~$42-44 (4.2-4.4%)|

---

## Credenciales Requeridas

Variables de entorno necesarias:

```env
GIGSTACK_API_KEY=...
GIGSTACK_API_SECRET=...
GIGSTACK_ENV=sandbox|production
EMISOR_RFC=...
EMISOR_RAZON_SOCIAL=...
EMISOR_REGIMEN=612
EMISOR_CP=88000
```

---

## Estructura de Hijos

| ID                                              | Nombre                | Descripción              | Estado |
| ----------------------------------------------- | --------------------- | ------------------------ | ------ |
| [[Proyecto OnlyCarNLD/Datos/5.1.1 stripe_connect_express\|5.1.1]]         | Stripe Connect Express| Payouts a operadores     | ✅      |

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.0. integraciones]]           |
| -------------------- | -------------------------------- |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.2. gigstack_facturacion]]    |

---
