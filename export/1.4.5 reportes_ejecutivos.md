---
id: 1.4.5
title: Reportes Ejecutivos
parent: '1.4'
breadcrumb: 0 â†’ 1.0 â†’ 1.4 â†’ 1.4.5
type: feature
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-10 01:12
domain:
- reportes
- b2b
- pdf
actors:
- admin
- cliente_b2b
summary: GeneraciÃ³n de reportes PDF ejecutivos de satisfacciÃ³n para clientes B2B.
  NPS por flotilla, tendencias, envÃ­o automÃ¡tico.
content_hash: e84c11758225da79
---

# 1.4.5 Reportes Ejecutivos

> Reportes PDF de satisfacciÃ³n para clientes B2B con mÃ©tricas de su flotilla.

---

## PropÃ³sito

| Objetivo | DescripciÃ³n |
|----------|-------------|
| **Transparencia** | Mostrar mÃ©tricas de satisfacciÃ³n a empresas |
| **RetenciÃ³n** | Demostrar valor del servicio |
| **AutomatizaciÃ³n** | EnvÃ­o mensual sin intervenciÃ³n |

---

## Contenido del Reporte

### Secciones

| SecciÃ³n | Contenido |
|---------|-----------|
| **1. Resumen Ejecutivo** | NPS, CSAT, servicios del mes |
| **2. MÃ©tricas por VehÃ­culo** | CalificaciÃ³n promedio por vehÃ­culo |
| **3. MÃ©tricas por Operador** | Operadores que atendieron la flotilla |
| **4. Tendencias** | GrÃ¡fica de 6 meses |
| **5. Comentarios Destacados** | Top 3 positivos y negativos |
| **6. Recomendaciones** | Sugerencias de mejora |

---

## Preview del PDF

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  [Logo OnlyCar]              REPORTE DE SATISFACCIÃ“N         â”‚
â”‚                                 Enero 2026                      â”‚
â”‚                                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                 â”‚
â”‚  EMPRESA: Acme Corp                                             â”‚
â”‚  CONTRATO: #B2B-2025-0047                                       â”‚
â”‚  PERÃODO: 01 Ene - 31 Ene 2026                                  â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                 â”‚
â”‚  RESUMEN EJECUTIVO                                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  NPS: 72    â”‚  â”‚ CSAT: 4.8   â”‚  â”‚  45 serv.   â”‚              â”‚
â”‚  â”‚    â†‘ +8     â”‚  â”‚ â­â­â­â­â­  â”‚  â”‚  100% ok    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                 â”‚
â”‚  MÃ‰TRICAS POR VEHÃCULO                                          â”‚
â”‚                                                                 â”‚
â”‚  â”‚ VehÃ­culo      â”‚ Servicios â”‚ Promedio â”‚ Tendencia â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Toyota Hilux  â”‚    8      â”‚   4.9    â”‚    â†‘      â”‚           â”‚
â”‚  â”‚ Ford Ranger   â”‚    6      â”‚   4.7    â”‚    â†’      â”‚           â”‚
â”‚  â”‚ Nissan NP300  â”‚    4      â”‚   4.8    â”‚    â†‘      â”‚           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## GeneraciÃ³n con pdfme

```typescript
// lib/reportes/reporte-satisfaccion.ts
import { generate } from '@pdfme/generator';
import { template } from './templates/satisfaccion';

export const generarReporteSatisfaccion = async (
  empresaId: string,
  periodo: { inicio: Date; fin: Date }
) => {
  // Obtener datos
  const datos = await obtenerDatosReporte(empresaId, periodo);
  
  // Generar inputs para template
  const inputs = [{
    empresa_nombre: datos.empresa.nombre,
    contrato: datos.empresa.contrato_id,
    periodo_texto: formatPeriodo(periodo),
    
    nps: datos.nps.toString(),
    nps_cambio: formatCambio(datos.nps_cambio),
    csat: datos.csat.toFixed(1),
    total_servicios: datos.servicios.length.toString(),
    
    tabla_vehiculos: datos.vehiculos.map(v => ({
      nombre: v.modelo,
      servicios: v.count.toString(),
      promedio: v.promedio.toFixed(1),
      tendencia: v.tendencia > 0 ? 'â†‘' : v.tendencia < 0 ? 'â†“' : 'â†’',
    })),
    
    comentarios_positivos: datos.comentarios.filter(c => c.estrellas >= 4).slice(0, 3),
    comentarios_negativos: datos.comentarios.filter(c => c.estrellas <= 3).slice(0, 3),
  }];
  
  // Generar PDF
  const pdf = await generate({ template, inputs });
  
  return pdf;
};
```

---

## Template pdfme

```typescript
// lib/reportes/templates/satisfaccion.ts
export const template: Template = {
  basePdf: BLANK_PDF,
  schemas: [
    // PÃ¡gina 1: Resumen
    {
      empresa_nombre: { type: 'text', position: { x: 20, y: 40 }, ... },
      nps: { type: 'text', position: { x: 50, y: 100 }, fontSize: 48, ... },
      csat: { type: 'text', position: { x: 150, y: 100 }, ... },
      // ... mÃ¡s campos
    },
    // PÃ¡gina 2: Detalle vehÃ­culos
    {
      tabla_vehiculos: { type: 'table', position: { x: 20, y: 40 }, ... },
    },
    // PÃ¡gina 3: Comentarios
    {
      comentarios_positivos: { type: 'multiline', ... },
      comentarios_negativos: { type: 'multiline', ... },
    },
  ],
};
```

---

## EnvÃ­o AutomÃ¡tico

```typescript
// jobs/enviar-reportes-mensuales.ts
import { CronJob } from 'cron';

// Ejecutar el dÃ­a 5 de cada mes a las 8am
export const jobReportesMensuales = new CronJob(
  '0 8 5 * *',
  async () => {
    const empresas = await getEmpresasActivas();
    
    for (const empresa of empresas) {
      const periodo = {
        inicio: startOfMonth(subMonths(new Date(), 1)),
        fin: endOfMonth(subMonths(new Date(), 1)),
      };
      
      const pdf = await generarReporteSatisfaccion(empresa.id, periodo);
      
      // Guardar en R2
      const url = await uploadToR2(pdf, `reportes/${empresa.id}/${periodo.inicio.toISOString()}.pdf`);
      
      // Enviar email
      await sendEmail({
        to: empresa.contacto_email,
        subject: `Reporte de SatisfacciÃ³n - ${formatMonth(periodo.inicio)}`,
        template: 'reporte-mensual',
        attachments: [{ filename: 'reporte-satisfaccion.pdf', path: url }],
      });
      
      // Registrar
      await db.insert(reportes_enviados).values({
        empresa_id: empresa.id,
        tipo: 'satisfaccion_mensual',
        periodo_inicio: periodo.inicio,
        periodo_fin: periodo.fin,
        url,
      });
    }
  }
);
```

---

## Dashboard B2B

Los clientes B2B pueden ver sus reportes histÃ³ricos:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š REPORTES DE SATISFACCIÃ“N                     Acme Corp      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”‚ PerÃ­odo       â”‚ NPS â”‚ CSAT â”‚ Servicios â”‚ Acciones  â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ Enero 2026    â”‚ 72  â”‚ 4.8  â”‚    45     â”‚ [Ver PDF] â”‚         â”‚
â”‚  â”‚ Diciembre 25  â”‚ 64  â”‚ 4.6  â”‚    38     â”‚ [Ver PDF] â”‚         â”‚
â”‚  â”‚ Noviembre 25  â”‚ 68  â”‚ 4.7  â”‚    42     â”‚ [Ver PDF] â”‚         â”‚
â”‚                                                                 â”‚
â”‚  [ Descargar todos ]                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Modelo de Datos

```sql
CREATE TABLE reportes_enviados (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  empresa_id UUID REFERENCES empresas(id),
  
  tipo VARCHAR(50), -- 'satisfaccion_mensual', 'satisfaccion_trimestral'
  periodo_inicio DATE,
  periodo_fin DATE,
  
  url TEXT, -- URL en R2
  
  enviado_a TEXT[], -- Emails
  enviado_at TIMESTAMPTZ DEFAULT now(),
  
  -- MÃ©tricas snapshot
  nps INTEGER,
  csat DECIMAL(3,2),
  total_servicios INTEGER,
  
  created_at TIMESTAMPTZ DEFAULT now()
);
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre | [[Proyecto OnlyCarNLD/Datos/1.4. sistema_calificacion_feedback]] |
|----------|----------------------------------------|
| â¬…ï¸ Hermano anterior | [[Proyecto OnlyCarNLD/Datos/1.4.4 moderacion_respuestas]] |
| ğŸ”— Relacionado | [[Proyecto OnlyCarNLD/Datos/1.1.7 contratos_b2b]], [[Proyecto OnlyCarNLD/Datos/1.2.4 cliente_b2b_perfil]] |

---
