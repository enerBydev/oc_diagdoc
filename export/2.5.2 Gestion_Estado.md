---
id: 2.5.2
title: Gestión de Estado
parent: '2.5'
breadcrumb: 0 → 2.0 → 2.5 → 2.5.2
type: modulo_padre
children_count: 2
descendants_count: 2
domain:
- nuxt
- state
- pinia
- store
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-04 20:33
summary: 'Estrategia de manejo de estado: useState para datos efímeros,

  Pinia para estado global complejo y persistencia.'
content_hash: 7e723b67fa2e06e8
---

# 2.5.2 Gestión de Estado

> Estrategia híbrida utilizando `useState` (nativo) y `Pinia` (store).

---

## Estructura de Hijos (Deep Dive)

| ID | Nombre | Descripción | Estado |
|----|--------|-------------|--------|
| [[Proyecto OnlyCarNLD/Datos/2.5.2.1 Pinia_Stores\|2.5.2.1]] | Pinia Stores | Setup Stores vs Options | ✅ |
| [[Proyecto OnlyCarNLD/Datos/2.5.2.2 State_Persistence\|2.5.2.2]] | State Persistence | Hydration, LocalStorage | ✅ |

---

## Principios

1. **Estado Local:** Preferir `ref`/`reactive` dentro de componentes si el dato no sale de ahí.
2. **Estado Compartido Simple:** Usar `useState` de Nuxt para compartir datos simples entre componentes y SSR.
3. **Estado Global Complejo:** Usar `Pinia` para lógica de negocio robusta, sesiones y carritos de compra.

---

## 1. useState (Nativo Nuxt)

Ideal para estados ligeros que necesitan hidratación SSR correcta.

```ts
// composables/useColor.ts
export const useColor = () => useState<string>('color', () => 'pink')
```

**Casos de Uso:**
- UI Toggles (Sidebar open/close en layout).
- Datos de configuración simples.

---

## 2. Pinia (Stores)

Para dominios completos de negocio.

### Estructura de Stores
Ubicación: `stores/` (debe configurarse en `nuxt.config.ts` o auto-import).

```ts
// stores/cart.ts
import { defineStore } from 'pinia'

export const useCartStore = defineStore('cart', () => {
  const items = ref<Product[]>([])
  
  const total = computed(() => items.value.reduce((acc, item) => acc + item.price, 0))
  
  function addItem(item: Product) {
    items.value.push(item)
  }

  return { items, total, addItem }
})
```

### Modularidad
Separar stores por dominio:
- `auth.ts`: Usuario, sesión, tokens.
- `booking.ts`: Flujo de reserva activo.
- `ui.ts`: Estado global de interfaz (Toast, Modales).

---

## 3. Persistencia

Para datos que deben sobrevivir a un recarga (Session Storage / Local Storage).

Usar plugin `pinia-plugin-persistedstate`.

```ts
// stores/auth.ts
export const useAuthStore = defineStore('auth', {
  state: () => ({ /* ... */ }),
  persist: {
    storage: persistedState.localStorage,
  },
})
```

> [!WARNING]
> No persistir datos sensibles (PII completa) en LocalStorage sin encriptación si no es estrictamente necesario. Token JWT es aceptable si HttpOnly cookies no son opción (en Capacitor usamos storage nativo preferentemente).

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.5. Arquitectura_Frontend]]   |
| -------------------- | -------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.5.1 Estructura_Proyecto]]    |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/2.5.3 Middleware_Routing]]     |

---
