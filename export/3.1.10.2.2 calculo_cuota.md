---
id: 3.1.10.2.2
title: Cálculo de Cuota
parent: 3.1.10.2
breadcrumb: 0 → 3.0 → 3.1 → 3.1.10 → 3.1.10.2 → 3.1.10.2.2
type: hoja
status: preparado
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 14:17
domain:
- calculo
- cuota
- deduccion
actors:
- admin
summary: 'Proceso de cálculo semanal.

  Deducción automática en corte semanal.'
content_hash: 95ffc4e632e973a4
---

# 3.1.10.2.2 Cálculo de Cuota

Proceso de cálculo semanal.

---

## Proceso en Corte Semanal

```typescript
const calcularDeduccionFinanciamiento = async (
  operadorId: string,
  gananciasSemana: number
): Promise<number> => {
  // Obtener financiamientos activos
  const { data: financiamientos } = await supabase
    .from('financiamientos')
    .select('*')
    .eq('operador_id', operadorId)
    .eq('estado', 'activo');
  
  if (!financiamientos?.length) return 0;
  
  let totalDeduccion = 0;
  
  for (const f of financiamientos) {
    const deduccion = gananciasSemana * (f.porcentaje_cobro / 100);
    const saldoPendiente = f.monto_total - f.pagado;
    
    // No cobrar más del saldo pendiente
    const montoAplicar = Math.min(deduccion, saldoPendiente);
    
    // Registrar pago
    await supabase.from('financiamiento_pagos').insert({
      financiamiento_id: f.id,
      monto: montoAplicar,
      tipo: 'deduccion_automatica'
    });
    
    // Actualizar saldo
    await supabase.from('financiamientos')
      .update({ pagado: f.pagado + montoAplicar })
      .eq('id', f.id);
    
    totalDeduccion += montoAplicar;
  }
  
  return totalDeduccion;
};
```

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/3.1.10.2 deduccion_semanal]]     |
| -------------------- | ---------------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/3.1.10.2.1 porcentaje_cobro]]    |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.10.2.3 historial_pagos]]     |

---
