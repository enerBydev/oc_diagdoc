---
id: 3.1.9.4
title: Penalizaciones de Caja
parent: 3.1.9
breadcrumb: 0 ‚Üí 3.0 ‚Üí 3.1 ‚Üí 3.1.9 ‚Üí 3.1.9.4
type: modulo_padre
children_count: 3
descendants_count: 3
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 14:15
domain:
- penalizaciones
- bloqueo
- deuda
actors:
- operador
- admin
summary: 'Sistema de consecuencias por caja no liquidada.

  Pago retenido, cuenta bloqueada, proceso de recuperaci√≥n.'
content_hash: de47dd1c63ca1e2d
---

# 3.1.9.4 Penalizaciones de Caja

Sistema de consecuencias por caja no liquidada.

---

## Filosof√≠a

> [!CAUTION]
> El operador que no liquida su caja **retiene dinero de OnlyCar**.
> Esto es inaceptable y tiene consecuencias inmediatas.

---

## ‚ö†Ô∏è RECORDATORIO DE HORARIOS

| Concepto | Horario | Consecuencia |
|----------|---------|--------------|
| **Corte Caja Diario** | 21:30 | Caja se cierra, saldo queda pendiente |
| **Corte Semanal** | Viernes ~23:59 | Se eval√∫a deuda acumulada |

---

## Pol√≠tica de Retenci√≥n

**Si el operador tiene saldo pendiente al viernes ~23:59:**

| Consecuencia | Efecto |
|--------------|--------|
| Pago semanal **RETENIDO** | No recibe su comisi√≥n |
| Cuenta **BLOQUEADA** | No puede aceptar nuevos servicios |
| Deuda **ACUMULADA** | Se suma a la siguiente semana |
| Penalizaci√≥n administrativa | Registro en historial |

---

## Flujo de Penalizaci√≥n

```
DIARIO 21:30 - Corte de caja
        ‚îÇ
        ‚ñº
Si saldo > $0:
‚îú‚îÄ‚îÄ Notificaci√≥n: "Liquida tu caja"
‚îî‚îÄ‚îÄ Saldo se arrastra al siguiente d√≠a
        ‚îÇ
        ‚ñº
VIERNES ~23:59 - Corte semanal
        ‚îÇ
        ‚ñº
Sistema verifica: ¬øOperador tiene saldo ACUMULADO pendiente?
        ‚îÇ
        ‚îú‚îÄ‚îÄ NO ‚Üí Pago normal el s√°bado ‚úÖ
        ‚îÇ
        ‚îî‚îÄ‚îÄ S√ç ‚Üí Activar penalizaci√≥n
                    ‚îÇ
                    ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ 1. Retener pago semanal   ‚îÇ
            ‚îÇ 2. Bloquear cuenta        ‚îÇ
            ‚îÇ 3. Notificar operador     ‚îÇ
            ‚îÇ 4. Registrar incidencia   ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚ñº
            Operador liquida deuda v√≠a MercadoPago
                    ‚îÇ
                    ‚ñº
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ 1. Desbloquear cuenta     ‚îÇ
            ‚îÇ 2. Liberar pago retenido  ‚îÇ
            ‚îÇ 3. Limpiar historial      ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

```mermaid
flowchart TD
    A["üîî 21:30 Corte de caja"] --> B{"¬øSaldo > $0?"}
    B -->|No| C["‚úÖ Caja limpia"]
    B -->|S√≠| D["Saldo se arrastra"]
    
    D --> E["üìÖ Viernes ~23:59"]
    E --> F{"¬øSaldo acumulado?"}
    
    F -->|No| G["‚úÖ Pago normal s√°bado"]
    F -->|S√≠| H["‚ö†Ô∏è PENALIZACI√ìN"]
    
    H --> I["1: Retener pago semanal"]
    I --> J["2: Bloquear cuenta"]
    J --> K["3: Notificar operador"]
    K --> L["4: Registrar incidencia"]
    
    L --> M["üí≥ Operador liquida deuda"]
    M --> N["‚úÖ Desbloquear cuenta"]
    N --> O["üíµ Liberar pago retenido"]
```

---


## Notificaciones de Alerta

### Alertas Diarias (despu√©s del corte 21:30)

| Momento | Canal | Mensaje |
|---------|-------|---------|
| 21:35 | Push | "‚è∞ Corte de caja. Tienes $X pendiente" |
| 22:30 | Push | "üí∞ Recuerda liquidar tu caja v√≠a MercadoPago" |

### Alertas Semanales (viernes)

| Momento | Canal | Mensaje |
|---------|-------|---------|
| Viernes 18:00 | Push + Email | "‚ö†Ô∏è Tienes $X acumulado esta semana. Liquida antes de tu pago" |
| Viernes 21:00 | Push urgente | "üö® √öLTIMA HORA: Liquida o se retiene tu pago" |
| S√°bado 00:05 | Push + Email | "üî¥ Tu pago est√° retenido. Liquida para liberarlo" |

---

## Modelo de Datos

```sql
CREATE TABLE penalizaciones_caja (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  operador_id UUID NOT NULL REFERENCES operadores(id),
  semana_inicio DATE NOT NULL,  -- Lunes de la semana
  
  monto_deuda_acumulada DECIMAL(10,2) NOT NULL,
  pago_retenido_id UUID REFERENCES pagos_operador(id),
  
  estado VARCHAR(20) DEFAULT 'activa',
  -- activa, resuelta, condonada
  
  resuelto_at TIMESTAMPTZ,
  metodo_resolucion VARCHAR(50),  -- 'mercadopago', 'admin_manual'
  
  created_at TIMESTAMPTZ DEFAULT now()
);

-- Bloqueo de cuenta
CREATE TABLE bloqueos_operador (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  operador_id UUID NOT NULL REFERENCES operadores(id),
  motivo VARCHAR(50) NOT NULL, -- 'caja_pendiente', 'verificacion'
  penalizacion_id UUID REFERENCES penalizaciones_caja(id),
  
  activo BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  resuelto_at TIMESTAMPTZ
);
```

---

## Estructura de Hijos

| ID                                            | Nombre       | Descripci√≥n        | Estado |
| --------------------------------------------- | ------------ | ------------------ | ------ |
| [[Proyecto OnlyCarNLD/Datos/3.1.9.4.1 deuda_pendiente\|3.1.9.4.1]]      | Deuda        | Saldo adeudado     | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.1.9.4.2 bloqueo_servicios\|3.1.9.4.2]]    | Bloqueo      | Restricci√≥n cuenta | ‚úÖ      |
| [[Proyecto OnlyCarNLD/Datos/3.1.9.4.3 proceso_recuperacion\|3.1.9.4.3]] | Recuperaci√≥n | Resolver deuda     | ‚úÖ      |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre            | [[Proyecto OnlyCarNLD/Datos/3.1.9 control_caja]]           |
| ------------------- | -------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior | [[Proyecto OnlyCarNLD/Datos/3.1.9.3 liquidacion_tarjeta]]  |

‚Üí Ver liquidaci√≥n v√≠a MercadoPago: [[Proyecto OnlyCarNLD/Datos/5.11 mercadopago_integracion]]

---
