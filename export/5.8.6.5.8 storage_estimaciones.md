---
id: 5.8.6.5.8
title: Storage Estimaciones
parent: 5.8.6.5
breadcrumb: 0 → 5.0 → 5.8 → 5.8.6 → 5.8.6.5 → 5.8.6.5.8
type: infraestructura
status: activo
last_updated: 2026-01-29 15:31
file_create: 2026-01-01 18:10
domain:
- storage
- costos
- estimacion
summary: Estimaciones de almacenamiento.
content_hash: 964f50cefdced373
---

# 5.8.6.5.8 Estimaciones de Storage

Cálculos detallados de uso de almacenamiento para historial GPS.

---

## Variables de Entrada

| Variable | Valor Estimado | Notas |
|----------|----------------|-------|
| **Servicios/mes** | 1,000 | Proyección inicial |
| **Duración promedio "en_camino"** | 20 min | Varía 5-30 min |
| **Throttle GPS** | 10 segundos | Configurable (ver 5.8.9) |
| **Bytes/ubicación** | ~150 | Incluyendo índices |

---

## Cálculos Detallados

### Por Servicio

```
┌─────────────────────────────────────────────────────────────────┐
│  CÁLCULO POR SERVICIO                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Duración:        20 minutos = 1,200 segundos                   │
│  Throttle:        10 segundos entre updates                     │
│  ─────────────────────────────────────────────────              │
│  Ubicaciones:     1,200 ÷ 10 = 120 ubicaciones                  │
│                                                                 │
│  Bytes/ubicación: 150 bytes (con overhead)                      │
│  ─────────────────────────────────────────────────              │
│  Total/servicio:  120 × 150 = 18,000 bytes ≈ 18 KB              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Por Mes

```
┌─────────────────────────────────────────────────────────────────┐
│  CÁLCULO MENSUAL                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Servicios/mes:   1,000                                         │
│  KB/servicio:     18                                            │
│  ─────────────────────────────────────────────────              │
│  Total/mes:       1,000 × 18 KB = 18,000 KB = 18 MB             │
│                                                                 │
│  CON AUTOLIMPIEZA (30 días):                                    │
│  Máximo concurrente: 18 MB × 1 mes = 18 MB                      │
│                                                                 │
│  MÁS ubicaciones de llegada retenidas (1 año):                  │
│  2 registros/servicio × 150 bytes × 1,000 × 12 = 3.6 MB/año     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Por Año

```
┌─────────────────────────────────────────────────────────────────┐
│  CÁLCULO ANUAL                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  UBICACIONES INTERMEDIAS (máx en cualquier momento):            │
│  = 18 MB (solo 30 días recientes)                               │
│                                                                 │
│  UBICACIONES DE LLEGADA (acumuladas):                           │
│  = 12,000 servicios × 2 × 150 bytes = 3.6 MB                    │
│                                                                 │
│  TABLA DE ARCHIVO (llegadas >1 año):                            │
│  = Variable, crece con el tiempo                                │
│                                                                 │
│  ─────────────────────────────────────────────────              │
│  TOTAL AÑO 1:     18 + 3.6 ≈ 22 MB                              │
│  TOTAL AÑO 2:     18 + 7.2 ≈ 25 MB (llegadas acumulan)          │
│  TOTAL AÑO 3:     18 + 10.8 ≈ 29 MB                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Comparación con Límites

| Recurso | Límite Free | Uso Estimado Año 1 | % Usado |
|---------|-------------|-------------------|---------|
| **Supabase Storage** | 500 MB | 22 MB | 4.4% |
| **Supabase Rows** | 500,000 | ~132,000 | 26.4% |
| **Supabase Bandwidth** | 2 GB/mes | ~50 MB | 2.5% |

> [!TIP]
> Con 1,000 servicios/mes, el historial GPS usa menos del **5%** del límite gratuito.

---

## Escenarios de Crecimiento

### Escenario Conservador (Crecimiento 10%/mes)

| Mes | Servicios | Storage Acumulado |
|-----|-----------|------------------|
| 1 | 1,000 | 18 MB |
| 6 | 1,611 | 22 MB |
| 12 | 2,594 | 28 MB |
| 24 | 6,727 | 45 MB |

### Escenario Agresivo (Crecimiento 25%/mes)

| Mes | Servicios | Storage Acumulado |
|-----|-----------|------------------|
| 1 | 1,000 | 18 MB |
| 6 | 3,052 | 35 MB |
| 12 | 9,313 | 65 MB |
| 24 | 86,736 | 250 MB |

> [!WARNING]
> **Si llegas a 86K servicios/mes**, considera migrar a Supabase Pro ($25/mes).

---

## Optimizaciones de Storage

### 1. Throttle Dinámico

```typescript
// Más throttle = menos storage
const THROTTLE_IMPACT = {
  '5s':  { ubicaciones: 240, kb_servicio: 36 },
  '10s': { ubicaciones: 120, kb_servicio: 18 },  // Recomendado
  '15s': { ubicaciones: 80,  kb_servicio: 12 },
  '20s': { ubicaciones: 60,  kb_servicio: 9 }
};
```

### 2. Compresión de Coordenadas

```sql
-- Reducir precisión de 8 a 6 decimales (de 1mm a 10cm)
ALTER TABLE ubicaciones_servicio 
  ALTER COLUMN lat TYPE DECIMAL(8, 6),
  ALTER COLUMN lng TYPE DECIMAL(9, 6);

-- Ahorro: ~4 bytes por registro = ~500 KB/mes
```

### 3. Limpieza Más Agresiva

```sql
-- Reducir retención de 30 a 14 días
-- Ahorro: 50% en ubicaciones intermedias
UPDATE retencion_rules 
SET dias_retencion = 14 
WHERE tipo = 'ubicacion_intermedia';
```

---

## Monitoreo de Storage

```sql
-- Vista: Uso actual de storage
CREATE VIEW v_storage_ubicaciones AS
SELECT
  'ubicaciones_servicio' as tabla,
  pg_size_pretty(pg_total_relation_size('ubicaciones_servicio')) as tamano_total,
  (SELECT COUNT(*) FROM ubicaciones_servicio) as total_filas,
  pg_size_pretty(pg_total_relation_size('ubicaciones_servicio') / 
    NULLIF((SELECT COUNT(*) FROM ubicaciones_servicio), 0)) as bytes_por_fila
UNION ALL
SELECT
  'ubicacion_actual',
  pg_size_pretty(pg_total_relation_size('ubicacion_actual')),
  (SELECT COUNT(*) FROM ubicacion_actual),
  pg_size_pretty(pg_total_relation_size('ubicacion_actual') / 
    NULLIF((SELECT COUNT(*) FROM ubicacion_actual), 0))
UNION ALL
SELECT
  'ubicaciones_archivo',
  pg_size_pretty(pg_total_relation_size('ubicaciones_archivo')),
  (SELECT COUNT(*) FROM ubicaciones_archivo),
  pg_size_pretty(pg_total_relation_size('ubicaciones_archivo') / 
    NULLIF((SELECT COUNT(*) FROM ubicaciones_archivo), 0));
```

### Alerta de Umbral

```typescript
// Alertar cuando storage > 80% del límite
const checkStorageUsage = async () => {
  const { data } = await supabase.rpc('get_database_size');
  const usedMB = data?.size_mb || 0;
  const limitMB = 500;
  const percentUsed = (usedMB / limitMB) * 100;
  
  if (percentUsed > 80) {
    notifyAdmin({
      type: 'warning',
      message: `Storage al ${percentUsed.toFixed(1)}% (${usedMB}MB/${limitMB}MB)`,
      action: 'Considerar upgrade o limpieza más agresiva'
    });
  }
};
```

---

## Proyección Visual

```
┌─────────────────────────────────────────────────────────────────┐
│  PROYECCIÓN DE STORAGE (3 años)                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  500 MB ┤                                      ─── Límite Free  │
│         │                                                       │
│  400 MB ┤                                                       │
│         │                                                       │
│  300 MB ┤                                                       │
│         │                                      ╱ Agresivo       │
│  200 MB ┤                              ╱──────╱                 │
│         │                      ╱──────╱                         │
│  100 MB ┤              ╱──────╱                                 │
│         │      ╱──────╱                                         │
│   50 MB ┤─────╱ Conservador                                     │
│         │                                                       │
│    0 MB ┼────────────────────────────────────────────────────   │
│         Mes 0    Mes 12    Mes 24    Mes 36                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

→ Ver queries optimizadas: [[Proyecto OnlyCarNLD/Datos/5.8.6.5.9 queries_optimizadas]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.6.5 historial_ubicaciones]]            |
| -------------------- | ---------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.6.5.7 privacidad_gdpr]]              |
| ➡️ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.6.5.9 queries_optimizadas]]              |
