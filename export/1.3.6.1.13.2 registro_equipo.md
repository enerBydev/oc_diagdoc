---
id: 1.3.6.1.13.2
title: Registro de Equipo
parent: 1.3.6.1.13
breadcrumb: 0 â†’ 1.0 â†’ 1.3 â†’ 1.3.6 â†’ 1.3.6.1 â†’ 1.3.6.1.13 â†’ 1.3.6.1.13.2
type: hoja
status: activo
domain: comunicacion
summary: Flujo para que operador documente sus herramientas con foto, marca, modelo
  y verificaciÃ³n por Admin.
version: 1.0
last_updated: 2026-01-29 15:32
file_create: 2025-12-26 17:49
actors:
- operador
- admin
dependencies:
- supabase
- cloudflare_r2
affects:
- 1.3.6.1.13 inventario_herramientas
content_hash: 47c0188fe7d0f90a
---

# 1.3.6.1.13.2 Registro de Equipo

Flujo para documentar herramientas del operador.

---

## Flujo de Registro

```mermaid
sequenceDiagram
    participant O as ğŸ‘· Operador
    participant S as ğŸ—„ï¸ Sistema
    participant A as ğŸ”§ Admin
    
    O->>S: Selecciona tipo de herramienta
    S->>O: Formulario (marca, modelo, foto)
    O->>S: Sube datos + foto
    S->>S: Guardar con estado 'pendiente'
    S->>A: NotificaciÃ³n: Nueva herramienta
    A->>S: Revisa foto y datos
    alt Aprobada
        A->>S: Aprobar
        S->>O: NotificaciÃ³n: Herramienta aprobada
        S->>S: Recalcular servicios disponibles
    else Rechazada
        A->>S: Rechazar con motivo
        S->>O: NotificaciÃ³n: Rechazada, motivo
        O->>S: Corregir y re-subir
    end
```

---

## Modelo de Datos

### Tabla: herramientas_operador

```sql
CREATE TABLE herramientas_operador (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  operador_id UUID NOT NULL REFERENCES operadores(id),
  tipo_herramienta_id UUID NOT NULL REFERENCES tipos_herramientas(id),
  
  -- Especificaciones
  marca VARCHAR(100),
  modelo VARCHAR(100),
  especificaciones TEXT,  -- JSON con detalles adicionales
  
  -- Foto (obligatoria)
  foto_url TEXT NOT NULL,
  foto_verificada BOOLEAN DEFAULT false,
  
  -- Estado
  estado VARCHAR(20) DEFAULT 'pendiente',  -- pendiente, aprobada, rechazada, baja
  motivo_rechazo TEXT,
  
  -- VerificaciÃ³n
  verificada_por UUID REFERENCES users(id),
  verificada_at TIMESTAMPTZ,
  
  -- Timestamps
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- Ãndices
CREATE INDEX idx_herramientas_operador ON herramientas_operador(operador_id);
CREATE INDEX idx_herramientas_estado ON herramientas_operador(estado);
CREATE INDEX idx_herramientas_pendientes ON herramientas_operador(estado) 
  WHERE estado = 'pendiente';
```

---

## UI: Agregar Herramienta (Operador)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• AGREGAR HERRAMIENTA                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CategorÃ­a: [ ğŸš¿ Lavado â–¼ ]                                     â”‚
â”‚                                                                 â”‚
â”‚  Tipo: [ Hidrolavadora â–¼ ]                                      â”‚
â”‚                                                                 â”‚
â”‚  Marca: [ KÃ¤rcher          ]                                    â”‚
â”‚                                                                 â”‚
â”‚  Modelo: [ K5 Premium      ]                                    â”‚
â”‚                                                                 â”‚
â”‚  Especificaciones adicionales:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 145 bar de presiÃ³n, 500 L/h                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“¸ FOTO DE LA HERRAMIENTA (obligatoria):                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚           [ ğŸ“· Tomar foto ]                             â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚   La foto debe mostrar claramente el equipo.            â”‚    â”‚
â”‚  â”‚   Incluir marca/modelo visible si es posible.           â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Un administrador verificarÃ¡ esta herramienta antes de       â”‚
â”‚     habilitarse en tu perfil.                                   â”‚
â”‚                                                                 â”‚
â”‚  [ Cancelar ]                        [ Enviar a verificaciÃ³n ]  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## UI: Mi Equipo (Operador)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§° MI EQUIPO DE TRABAJO                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸš¿ LAVADO                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âœ… Hidrolavadora          â”‚ KÃ¤rcher K5      â”‚ [ğŸ“·] [ğŸ—‘ï¸] â”‚    â”‚
â”‚  â”‚ âœ… Cubetas (2)            â”‚ -               â”‚ [ğŸ“·] [ğŸ—‘ï¸] â”‚    â”‚
â”‚  â”‚ âœ… Guante de lavado       â”‚ Chemical Guys   â”‚ [ğŸ“·] [ğŸ—‘ï¸] â”‚    â”‚
â”‚  â”‚ âœ… Shampoo automotriz     â”‚ Meguiar's Gold  â”‚ [ğŸ“·] [ğŸ—‘ï¸] â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  ğŸ§¹ LIMPIEZA INTERIOR                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ âœ… Aspiradora             â”‚ Shop-Vac 16Gal â”‚ [ğŸ“·] [ğŸ—‘ï¸]  â”‚    â”‚
â”‚  â”‚ â³ Microfibras (5)        â”‚ En verificaciÃ³nâ”‚ [ğŸ“·]       â”‚    â”‚
â”‚  â”‚ âŒ Set de brochas         â”‚ Rechazada      â”‚ [ğŸ”„]       â”‚    â”‚
â”‚  â”‚    â””â”€ Motivo: Foto borrosa, no se ve el producto        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  âœ¨ ACABADOS                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â• Sin herramientas registradas                         â”‚    â”‚
â”‚  â”‚    [ Agregar herramienta ]                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  [ + Agregar herramienta ]                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Composable: useOperatorEquipment

```typescript
// composables/useOperatorEquipment.ts
interface Herramienta {
  id: string;
  tipo_id: string;
  tipo_nombre: string;
  categoria: string;
  marca: string;
  modelo: string;
  foto_url: string;
  estado: 'pendiente' | 'aprobada' | 'rechazada' | 'baja';
  motivo_rechazo?: string;
}

export const useOperatorEquipment = () => {
  const supabase = useSupabaseClient();
  const user = useSupabaseUser();
  
  const herramientas = ref<Herramienta[]>([]);
  const isLoading = ref(true);
  
  const fetchEquipment = async () => {
    isLoading.value = true;
    const { data } = await supabase
      .from('herramientas_operador')
      .select(`
        id, marca, modelo, foto_url, estado, motivo_rechazo,
        tipos_herramientas (
          id, nombre,
          categorias_herramientas (nombre)
        )
      `)
      .eq('operador_id', user.value?.id)
      .neq('estado', 'baja')
      .order('created_at', { ascending: false });
    
    herramientas.value = data?.map(h => ({
      id: h.id,
      tipo_id: h.tipos_herramientas.id,
      tipo_nombre: h.tipos_herramientas.nombre,
      categoria: h.tipos_herramientas.categorias_herramientas.nombre,
      marca: h.marca,
      modelo: h.modelo,
      foto_url: h.foto_url,
      estado: h.estado,
      motivo_rechazo: h.motivo_rechazo
    })) || [];
    
    isLoading.value = false;
  };
  
  const addEquipment = async (herramienta: {
    tipo_id: string;
    marca: string;
    modelo: string;
    especificaciones?: string;
    foto: File;
  }) => {
    // 1. Subir foto a R2
    const fotoUrl = await uploadToolPhoto(herramienta.foto);
    
    // 2. Crear registro
    const { data, error } = await supabase
      .from('herramientas_operador')
      .insert({
        operador_id: user.value?.id,
        tipo_herramienta_id: herramienta.tipo_id,
        marca: herramienta.marca,
        modelo: herramienta.modelo,
        especificaciones: herramienta.especificaciones,
        foto_url: fotoUrl,
        estado: 'pendiente'
      })
      .select()
      .single();
    
    if (!error) {
      toast.success('Herramienta enviada a verificaciÃ³n');
      await fetchEquipment();
    }
    
    return { data, error };
  };
  
  const removeEquipment = async (herramientaId: string) => {
    await supabase
      .from('herramientas_operador')
      .update({ estado: 'baja', updated_at: new Date() })
      .eq('id', herramientaId);
    
    // Recalcular servicios
    await supabase.rpc('recalcular_servicios_operador', {
      p_operador_id: user.value?.id
    });
    
    toast.success('Herramienta dada de baja');
    await fetchEquipment();
  };
  
  onMounted(fetchEquipment);
  
  return {
    herramientas,
    isLoading,
    addEquipment,
    removeEquipment,
    refetch: fetchEquipment
  };
};
```

---

## UI Admin: Verificar Herramientas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” ADMIN: HERRAMIENTAS PENDIENTES (3)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Carlos M.        â”‚ Microfibras (5) â”‚ hace 2 horas       â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Marca: Chemical Guys                  â”‚    â”‚
â”‚  â”‚  â”‚   [FOTO]    â”‚  Modelo: -                             â”‚    â”‚
â”‚  â”‚  â”‚             â”‚                                        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  [ âœ… Aprobar ]  [ âŒ Rechazar ]                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Pedro R.         â”‚ Pulidora orbital â”‚ hace 5 horas      â”‚    â”‚
â”‚  â”‚  ...                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.13 inventario_herramientas]]    |
| -------------------- | ----------------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.13.1 catalogo_herramientas]]    |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.3.6.1.13.3 validacion_servicios]]     |

---
