---
id: 5.7
title: PDFme - Generaci√≥n de PDFs
parent: '5.0'
breadcrumb: 0 ‚Üí 5.0 ‚Üí 5.7
type: integracion
status: activo
last_updated: 2026-01-29 15:31
file_create: 2025-12-23 14:27
actors:
- admin
domain:
- pdf
- contratos
- documentos
summary: 'Sistema de generaci√≥n din√°mica de PDFs para contratos B2B usando

  plantillas JSON con @pdfme/generator.'
content_hash: 02b091549790bd3a
---

# 5.7 Integraci√≥n PDFme

> Sistema de generaci√≥n din√°mica de documentos PDF para contratos B2B.

---

## Caracter√≠sticas

| Caracter√≠stica | Valor |
|----------------|-------|
| **Tipo** | Open Source (MIT) |
| **Runtime** | Browser + Node.js |
| **Plantillas** | JSON-based |
| **Campos** | Text, Image, Table, Barcode, QR |
| **Output** | PDF est√°ndar |

---

## Por qu√© PDFme

| Alternativa | Problema | PDFme |
|-------------|----------|-------|
| PDF-lib | Bajo nivel, complejo | ‚úÖ Plantillas visuales |
| Puppeteer | Pesado, HTML‚ÜíPDF | ‚úÖ Nativo PDF |
| DocuSign | Costo por documento | ‚úÖ Open source |
| React-PDF | Solo React | ‚úÖ Framework agnostic |

---

## Arquitectura

```mermaid
flowchart TD
    A[Admin Dashboard<br/>Formulario Contrato] --> B[Nitro API<br/>POST /api/contratos/generar-pdf]
    B --> C[Validar datos]
    C --> D[Cargar plantilla JSON]
    D --> E[Generar PDF con PDFme]
    E --> F[Cloudflare R2<br/>PDF borrador]
    E --> G[Mifiel<br/>Firma digital]
    G --> H[Cloudflare R2<br/>PDF firmado]
```


```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        ADMIN DASHBOARD                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   Formulario de Contrato ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ   ‚Ä¢ Empresa, paquete, veh√≠culos, etc.                       ‚îÇ   ‚îÇ
‚îÇ                                                             ‚ñº   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚îÇ
                                                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    NITRO API ENDPOINT                           ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   POST /api/contratos/generar-pdf                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ   1. Recibe datos del formulario                                ‚îÇ
‚îÇ   2. Valida datos                                               ‚îÇ
‚îÇ   3. Calcula totales y descuentos                               ‚îÇ
‚îÇ   4. Carga plantilla JSON                                       ‚îÇ
‚îÇ   5. Genera PDF con PDFme                                       ‚îÇ
‚îÇ   6. Sube a Cloudflare R2                                       ‚îÇ
‚îÇ   7. Retorna URL del PDF                                        ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚îÇ
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
                            ‚îÇ                                 ‚îÇ
                            ‚ñº                                 ‚ñº
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ   CLOUDFLARE R2     ‚îÇ         ‚îÇ      MIFIEL         ‚îÇ
                 ‚îÇ   (Storage)         ‚îÇ         ‚îÇ   (Firma digital)   ‚îÇ
                 ‚îÇ                     ‚îÇ         ‚îÇ                     ‚îÇ
                 ‚îÇ ‚Ä¢ PDF borrador      ‚îÇ         ‚îÇ ‚Ä¢ Enviar a firmas   ‚îÇ
                 ‚îÇ ‚Ä¢ PDF firmado       ‚îÇ         ‚îÇ ‚Ä¢ Webhooks          ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```


---

## Instalaci√≥n

```bash
npm install @pdfme/generator @pdfme/common
```


## Uso Actual: Contratos B2B

### Template JSON

```json
{
  "basePdf": "template_contrato_b2b.pdf",
  "schemas": [
    {
      "numero_contrato": {
        "type": "text",
        "position": { "x": 450, "y": 40 },
        "width": 120,
        "height": 12,
        "fontSize": 10
      },
      "fecha_generacion": {
        "type": "text",
        "position": { "x": 450, "y": 55 },
        "width": 120,
        "height": 12,
        "fontSize": 10
      },
      "cliente_razon_social": {
        "type": "text",
        "position": { "x": 100, "y": 120 },
        "width": 300,
        "height": 15,
        "fontSize": 12,
        "fontWeight": "bold"
      }
      // ... m√°s campos
    }
  ]
}
```

### Inputs (Datos)

```json
{
  "numero_contrato": "CONT-B2B-2025-01-15-ABC123",
  "fecha_generacion": "15 de Enero de 2025",
  "cliente_razon_social": "Empresa XYZ S.A. de C.V.",
  "cliente_rfc": "XYZ123456ABC",
  "paquete_nombre": "Express Flotilla",
  "vehiculos_mes": 15,
  "precio_unitario": 224,
  "descuento_total": "35%",
  "total_mensual": 3360
}
```

### Generaci√≥n

```typescript
// server/api/contratos/generar-pdf.post.ts
import { generate } from '@pdfme/generator';

export default defineEventHandler(async (event) => {
  const body = await readBody(event);
  
  // Cargar template
  const template = await loadTemplate('contrato_b2b');
  
  // Preparar inputs
  const inputs = [
    {
      numero_contrato: generarNumeroContrato(),
      fecha_generacion: formatDate(new Date()),
      cliente_razon_social: body.empresa.razon_social,
      cliente_rfc: body.empresa.rfc,
      paquete_nombre: body.paquete.nombre,
      vehiculos_mes: body.vehiculos,
      precio_unitario: calcularPrecioUnitario(body),
      descuento_total: calcularDescuentoTotal(body),
      total_mensual: calcularTotalMensual(body)
    }
  ];
  
  // Generar PDF
  const pdfBuffer = await generate({ template, inputs });
  
  // Subir a R2
  const url = await uploadToR2(pdfBuffer, `contratos/${inputs[0].numero_contrato}.pdf`);
  
  return { url, numero_contrato: inputs[0].numero_contrato };
});
```


---

## Usos

| Documento | Estado |
|-----------|--------|
| Contratos B2B | ‚úÖ Implementado |
| Cotizaciones | üîÆ Futuro |
| Reportes mensuales | üîÆ Futuro |
| Constancias servicio | üîÆ Futuro |

---

## Navegaci√≥n

| ‚¨ÜÔ∏è Padre             | [[Proyecto OnlyCarNLD/Datos/5.0. integraciones]]           |
| -------------------- | -------------------------------- |
| ‚¨ÖÔ∏è Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.6. autenticacion]]           |
| ‚û°Ô∏è Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]]         |
| üîó Ver tambi√©n       | [[Proyecto OnlyCarNLD/Datos/1.1.7.4 generacion_pdfme]]     |

---
