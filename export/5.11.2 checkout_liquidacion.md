---
id: 5.11.2
title: Checkout LiquidaciÃ³n
parent: '5.11'
breadcrumb: 0 â†’ 5.0 â†’ 5.11 â†’ 5.11.2
type: feature
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 23:25
domain:
- mercadopago
- checkout
- liquidacion
summary: 'Sistema de cobro MercadoPago para que operadores liquiden su caja.

  Usa Checkout Pro con Saldo MercadoPago como mÃ©todo principal.'
content_hash: fce07ffbcb4d03fe
---

# 5.11.2 Checkout para LiquidaciÃ³n

Sistema de cobro MercadoPago para que operadores liquiden su caja.

---

## Concepto

Cuando el operador tiene saldo pendiente (efectivo o tarjeta cobrada con Point), debe pagarlo a OnlyCar. Usamos **MercadoPago Checkout Pro** para esto, idealmente con **Saldo MercadoPago** previamente fondeado.

---

## Flujo de LiquidaciÃ³n

```
Operador ve saldo pendiente en app
        â”‚
        â–¼
Presiona "Liquidar caja"
        â”‚
        â–¼
Sistema genera link MercadoPago Checkout
        â”‚
        â–¼
Operador paga desde:
â”œâ”€â”€ Su app MercadoPago (saldo)
â”œâ”€â”€ Tarjeta vinculada
â”œâ”€â”€ Transferencia SPEI (CLABE MP)
â””â”€â”€ Efectivo en OXXO (NO recomendado, 24-72h)
        â”‚
        â–¼
MercadoPago procesa pago
        â”‚
        â–¼
Webhook confirma â†’ Caja liquidada âœ…
```

---

## MÃ©todos de Pago Aceptados

| MÃ©todo | Tiempo | ComisiÃ³n | Recomendado |
|--------|--------|----------|-------------|
| **Saldo MP** | InstantÃ¡neo | 0% | âœ… Ideal |
| **Tarjeta** | InstantÃ¡neo | 3.15% | âœ… Bueno |
| **SPEI** | 1-24h | 0% | âœ… Bueno |
| **OXXO** | 24-72h | ~$10 | âŒ No |

---

## ImplementaciÃ³n

### Crear Preferencia de Pago

```typescript
// server/api/caja/liquidar.post.ts
import { MercadoPagoConfig, Preference } from 'mercadopago';

const client = new MercadoPagoConfig({ 
  accessToken: process.env.MERCADOPAGO_ACCESS_TOKEN! 
});

export default defineEventHandler(async (event) => {
  const { operadorId, monto, cajaId } = await readBody(event);
  
  const preference = new Preference(client);
  
  const result = await preference.create({
    body: {
      items: [{
        id: `liquidacion-${cajaId}`,
        title: 'LiquidaciÃ³n de caja OnlyCar',
        description: `Caja del ${format(new Date(), 'dd/MM/yyyy')}`,
        quantity: 1,
        unit_price: monto,
        currency_id: 'MXN'
      }],
      
      // Referencia para webhook
      external_reference: JSON.stringify({
        type: 'caja_liquidacion',
        operador_id: operadorId,
        caja_id: cajaId,
        monto: monto
      }),
      
      // URLs de redirecciÃ³n
      back_urls: {
        success: `${process.env.APP_URL}/operador/caja/exito`,
        failure: `${process.env.APP_URL}/operador/caja/error`,
        pending: `${process.env.APP_URL}/operador/caja/pendiente`
      },
      auto_return: 'approved',
      
      // Webhook
      notification_url: `${process.env.APP_URL}/api/webhooks/mercadopago`,
      
      // ConfiguraciÃ³n
      payment_methods: {
        excluded_payment_types: [
          { id: 'ticket' }  // Excluir OXXO por tiempo
        ],
        installments: 1  // Sin MSI
      },
      
      // ExpiraciÃ³n: 2 horas
      expires: true,
      expiration_date_to: addHours(new Date(), 2).toISOString()
    }
  });
  
  return { 
    checkout_url: result.init_point,
    preference_id: result.id
  };
});
```

---

## UI en App del Operador

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° LIQUIDAR CAJA                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Resumen del dÃ­a (27 Dic 2024)                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Efectivo recibido:        $850.00                      â”‚    â”‚
â”‚  â”‚  Tarjeta (Point MP):       $500.00                      â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚    â”‚
â”‚  â”‚  TOTAL A LIQUIDAR:       $1,350.00                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  â° Tienes hasta las 21:30 para liquidar                        â”‚
â”‚                                                                 â”‚
â”‚  [ ğŸ“± Liquidar con MercadoPago ]                                â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Tip: Usa tu saldo de MercadoPago para liquidar              â”‚
â”‚     instantÃ¡neamente sin comisiones extras.                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DespuÃ©s del Pago

Cuando el operador completa el pago:

1. **Webhook recibe notificaciÃ³n** (ver 5.11.3)
2. **Sistema actualiza caja** â†’ `estado: 'liquidada'`
3. **Operador ve confirmaciÃ³n** en app

---

â†’ Ver webhooks: [[Proyecto OnlyCarNLD/Datos/5.11.3 webhooks_mercadopago]]

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/5.11 mercadopago_integracion]] |
| -------------------- | -------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.11.1 point_terminal]]        |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.11.3 webhooks_mercadopago]]  |

---
