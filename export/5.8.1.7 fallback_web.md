---
id: 5.8.1.7
title: Fallback Web
parent: 5.8.1
breadcrumb: 0 → 5.0 → 5.8 → 5.8.1 → 5.8.1.7
type: fallback
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:07
domain:
- web
- geolocation
- pwa
summary: Fallback GPS para navegador web.
content_hash: 25f060c40daf6636
---

# 5.8.1.7 Fallback Web

Geolocation cuando la app corre como PWA sin Capacitor nativo.

---

## Detección

```typescript
import { Capacitor } from '@capacitor/core';

const isNative = Capacitor.isNativePlatform();
const isWeb = !isNative;
```

---

## Web Geolocation API

```typescript
// composables/useWebGeolocation.ts
export const useWebGeolocation = () => {
  const position = ref<{ lat: number; lng: number } | null>(null);
  const error = ref<string | null>(null);
  let watchId: number | null = null;
  
  const isSupported = 'geolocation' in navigator;
  
  const getCurrentPosition = async () => {
    if (!isSupported) throw new Error('Geolocation not supported');
    
    return new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          position.value = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          };
          resolve(position.value);
        },
        (err) => {
          error.value = err.message;
          reject(err);
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    });
  };
  
  const startTracking = (callback?: (pos: typeof position.value) => void) => {
    if (!isSupported) return;
    
    watchId = navigator.geolocation.watchPosition(
      (pos) => {
        position.value = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };
        callback?.(position.value);
      },
      (err) => {
        error.value = err.message;
      }
    );
  };
  
  const stopTracking = () => {
    if (watchId !== null) {
      navigator.geolocation.clearWatch(watchId);
      watchId = null;
    }
  };
  
  return { isSupported, position, error, getCurrentPosition, startTracking, stopTracking };
};
```

---

## Composable Unificado

```typescript
// composables/useUnifiedGeolocation.ts
import { Capacitor } from '@capacitor/core';

export const useUnifiedGeolocation = () => {
  if (Capacitor.isNativePlatform()) {
    return useGeolocation(); // Capacitor
  }
  return useWebGeolocation(); // Web API
};
```

---

## Limitaciones Web

| Característica | Nativo | Web |
|----------------|--------|-----|
| Alta precisión | ✅ | ⚠️ Depende |
| Background | ⚠️ | ❌ |
| Permisos | Popup nativo | Popup browser |
| Heading | ✅ | ❌ |
| Speed | ✅ | Limitado |

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8.1 capacitor_geolocation]]            |
| -------------------- | ---------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.1.6 platform_differences]]              |
