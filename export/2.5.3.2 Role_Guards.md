---
id: 2.5.3.2
title: Role Guards
parent: 2.5.3
breadcrumb: 0 → 2.0 → 2.5 → 2.5.3 → 2.5.3.2
type: seguridad
children_count: 0
descendants_count: 0
status: activo
domain:
- frontend
- roles
- rbac
- guards
actors:
- desarrollador
- admin
summary: 'Middleware de autorización por rol: Control de acceso basado en roles de
  usuario (cliente, operador, admin).'
last_updated: 2026-01-29 15:32
file_create: 2026-01-22 23:20
content_hash: 975a1c4ca7338075
---

# 2.5.3.2 Role Guards

> Control de acceso basado en roles (RBAC) en el frontend.

---

## Roles del Sistema

| Rol | Código | Acceso |
|-----|--------|--------|
| **Cliente** | `cliente` | Dashboard cliente, órdenes propias |
| **Operador** | `operador` | Dashboard operador, trabajos asignados |
| **Flotilla** | `flotilla` | Gestión de vehículos de empresa |
| **Admin** | `admin` | Panel de administración completo |
| **Super Admin** | `superadmin` | Todo + configuración sistema |

---

## Middleware de Roles

```typescript
// middleware/role.ts
export default defineNuxtRouteMiddleware(async (to) => {
  const user = useSupabaseUser();
  
  // Obtener rol requerido de la página
  const requiredRole = to.meta.role as string | string[];
  
  if (!requiredRole) return; // No requiere rol específico
  
  // Obtener perfil del usuario con rol
  const { data: profile } = await useSupabaseClient()
    .from('profiles')
    .select('role')
    .eq('id', user.value?.id)
    .single();
  
  const userRole = profile?.role || 'cliente';
  
  // Verificar si tiene acceso
  const allowedRoles = Array.isArray(requiredRole) ? requiredRole : [requiredRole];
  
  if (!allowedRoles.includes(userRole)) {
    throw createError({
      statusCode: 403,
      statusMessage: 'No tienes permiso para acceder a esta sección'
    });
  }
});
```

---

## Aplicación en Páginas

```vue
<!-- pages/admin/index.vue -->
<script setup>
definePageMeta({
  middleware: ['auth', 'role'],
  role: 'admin'
});
</script>
```

### Múltiples Roles Permitidos

```vue
<!-- pages/dashboard/operador.vue -->
<script setup>
definePageMeta({
  middleware: ['auth', 'role'],
  role: ['operador', 'admin', 'superadmin']
});
</script>
```

---

## Composable de Permisos

```typescript
// composables/usePermissions.ts
export function usePermissions() {
  const user = useSupabaseUser();
  const profile = useState('userProfile');
  
  const hasRole = (role: string | string[]) => {
    const userRole = profile.value?.role || 'cliente';
    const roles = Array.isArray(role) ? role : [role];
    return roles.includes(userRole);
  };
  
  const isAdmin = computed(() => hasRole(['admin', 'superadmin']));
  const isOperador = computed(() => hasRole(['operador', 'admin']));
  const isCliente = computed(() => hasRole('cliente'));
  
  const can = (action: string) => {
    // Matriz de permisos
    const permissions: Record<string, string[]> = {
      'order:create': ['cliente', 'flotilla', 'admin'],
      'order:cancel': ['cliente', 'admin'],
      'order:accept': ['operador', 'admin'],
      'user:manage': ['admin', 'superadmin'],
      'settings:edit': ['superadmin']
    };
    
    return permissions[action]?.includes(profile.value?.role);
  };
  
  return { hasRole, isAdmin, isOperador, isCliente, can };
}
```

---

## Uso en Componentes

```vue
<template>
  <div>
    <!-- Mostrar solo si es admin -->
    <AdminPanel v-if="isAdmin" />
    
    <!-- Mostrar botón solo si puede crear órdenes -->
    <Button v-if="can('order:create')" @click="createOrder">
      Nueva Orden
    </Button>
  </div>
</template>

<script setup>
const { isAdmin, can } = usePermissions();
</script>
```

---

## Relaciones

- Depende de: [[Proyecto OnlyCarNLD/Datos/2.5.3.1 Auth_Guards|Autenticación previa]]
- Define matriz en: [[Proyecto OnlyCarNLD/Datos/3.2. matriz_permisos|Permisos detallados]]
- Sincroniza con: [[Proyecto OnlyCarNLD/Datos/5.6.1 arquitectura_auth|Supabase RLS]]

---

## Navegación

| ⬆️ Padre             | [[Proyecto OnlyCarNLD/Datos/2.5.3 Middleware_Routing]]  |
| -------------------- | ----------------------------- |
| ⬅️ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/2.5.3.1 Auth_Guards]]       |
| ➡️ Hermano siguiente | *(Último hijo de 2.5.3)*      |

---
