# SUMMARY: 5.0 Integraciones Externas

## üî¨ RADIOGRAF√çA MOLECULAR DEL M√ìDULO 5.0

> **An√°lisis forense algor√≠tmico:** 2026-01-28 01:36
> **Herramientas:** `tree_viewer.py`, `dependency_mapper.py`, `project_stats.py`

### Esencia Nuclear

**Las CONEXIONES de OnlyCar con el mundo exterior.** Este m√≥dulo define el sistema de integraciones que delega procesamiento a proveedores certificados, minimizando responsabilidad legal y complejidad t√©cnica. Include pasarelas de pago (Stripe + MercadoPago), facturaci√≥n autom√°tica CFDI 4.0 (Gigstack), firma digital de contratos (Mifiel), autenticaci√≥n OAuth, geolocalizaci√≥n en tiempo real, generaci√≥n de PDFs (PDFme), y soporte externo.

**Principio de Delegaci√≥n Total:** OnlyCar NO procesa datos fiscales, certificados digitales, timbrado CFDI ni firmas criptogr√°ficas. Todo se delega a proveedores con certificaciones (PCI-DSS, PAC SAT, PSC SE).

### M√©tricas At√≥micas

| M√©trica | Valor |
|---------|-------|
| Archivos totales | 88 |
| Hijos directos | 10 |
| Descendientes | 87 |
| Profundidad m√°xima | 4 niveles |
| % del proyecto | 11% |

### √Årbol Jer√°rquico (Nivel 1)

```
5.0 Integraciones Externas (88 archivos)
‚îú‚îÄ‚îÄ 5.1 Stripe ‚îÄ Pasarela de pagos, Connect Express para operadores
‚îú‚îÄ‚îÄ 5.2 Gigstack ‚îÄ Facturaci√≥n CFDI 4.0 delegada a PAC
‚îú‚îÄ‚îÄ 5.3 Mifiel ‚îÄ Firma digital de contratos B2B
‚îú‚îÄ‚îÄ 5.4 Cumplimiento Legal ‚îÄ LFPDPPP, CFF, SAT
‚îú‚îÄ‚îÄ 5.5 Webhooks ‚îÄ Callbacks de proveedores
‚îú‚îÄ‚îÄ 5.6 Autenticaci√≥n ‚îÄ OAuth (Google, Apple), Supabase Auth
‚îú‚îÄ‚îÄ 5.7 PDFme ‚îÄ Generaci√≥n de contratos y reportes
‚îú‚îÄ‚îÄ 5.8 Geolocalizaci√≥n (54 desc!) ‚îÄ GPS, tracking realtime, Watchtower
‚îú‚îÄ‚îÄ 5.9 Soporte Externo ‚îÄ Tawk.to, Chatwoot
‚îî‚îÄ‚îÄ 5.11 MercadoPago ‚îÄ Point Terminal para cobros presenciales
```

### Mapa de Dependencias

- **Depende de:** [[Proyecto OnlyCarNLD/Datos/2.0. tecnologia]], [[Proyecto OnlyCarNLD/Datos/3.1. Logica_Negocio_Core]], [[Proyecto OnlyCarNLD/Datos/8.0. legal_cumplimiento]]
- **Es usado por:** [[Proyecto OnlyCarNLD/Datos/1.2. user_personas]], [[Proyecto OnlyCarNLD/Datos/1.3. comunicacion]], [[Proyecto OnlyCarNLD/Datos/6.0. UI-UX]]
- **Archivos cr√≠ticos:** [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]], [[Proyecto OnlyCarNLD/Datos/5.6. autenticacion]], [[Proyecto OnlyCarNLD/Datos/5.1. stripe_pagos]]

### Conceptos Nucleares

1. **Delegaci√≥n Total:** 95% menos c√≥digo de facturaci√≥n, 90% menos responsabilidad legal
2. **Stripe Connect Express:** Onboarding simplificado de operadores como sub-merchants
3. **Watchtower:** Algoritmo de seguridad que verifica operador en ubicaci√≥n esperada
4. **OAuth Multi-provider:** Login con Google, Apple, o email+password blindado
5. **Webhooks:** Eventos de Stripe, MercadoPago, Gigstack, Mifiel procesados en backend

---

> Resumen ejecutivo del m√≥dulo 5.0 para contexto r√°pido de IA.

---

## Estad√≠sticas (DATOS VIVOS)

| M√©trica | Valor |
|---------|-------|
| Total archivos | 88 |
| Estados | 83 activo, 5 futuro |
| Profundidad m√°xima | 4 niveles (ej: 5.8.6.5.10) |
| Porcentaje del proyecto | 11% |

---

## Prop√≥sito del M√≥dulo

Define las **CONEXIONES** con el mundo exterior. Sistema de integraciones que delega procesamiento de datos fiscales y firma digital a proveedores certificados, minimizando responsabilidad legal y t√©cnica.

**Principio:** Delegaci√≥n Total. OnlyCar NO procesa datos fiscales, certificados digitales, timbrado CFDI ni firmas criptogr√°ficas.

---

## Proveedores Integrados

| Proveedor | Funci√≥n | Certificaci√≥n |
|-----------|---------|---------------|
| **Stripe** | Pagos digitales + suscripciones | PCI-DSS Level 1 |
| **MercadoPago** | Cobro presencial Point Terminal | PCI-DSS |
| **Gigstack** | Facturaci√≥n autom√°tica CFDI 4.0 | PAC autorizado SAT |
| **Mifiel** | Firma digital contratos B2B | PSC acreditado SE |
| **Supabase Auth** | Autenticaci√≥n OAuth + Email | SOC 2 |
| **Veriff** | Verificaci√≥n identidad biom√©trica | ISO 27001 |
| **Tawk.to** | Chat de soporte externo | - |

---

## Estructura Jer√°rquica Completa

### 5.1 Stripe - Pasarela de Pagos (1 descendiente)

| Subm√≥dulo | Descripci√≥n |
|-----------|-------------|
| [[Proyecto OnlyCarNLD/Datos/5.1.1 stripe_connect_express]] | Onboarding operadores |

### 5.2 Gigstack - Facturaci√≥n CFDI (0 descendientes)

Delegaci√≥n total de timbrado al PAC autorizado.

### 5.3 Mifiel - Firma Digital (0 descendientes)

Contratos B2B con firma electr√≥nica avanzada.

### 5.4 Cumplimiento Legal y Fiscal (0 descendientes)

LFPDPPP, CFF, SAT.

### 5.5 Webhooks e Integraci√≥n T√©cnica (0 descendientes)

Callbacks de proveedores.

### 5.6 Sistema de Autenticaci√≥n (7 descendientes)

| Subm√≥dulo | Descripci√≥n |
|-----------|-------------|
| [[Proyecto OnlyCarNLD/Datos/5.6.1 arquitectura_auth]] | Arquitectura de auth |
| [[Proyecto OnlyCarNLD/Datos/5.6.2 oauth_proveedores]] | Google, Apple OAuth |
| [[Proyecto OnlyCarNLD/Datos/5.6.3 email_password_blindado]] | Auth tradicional segura |
| [[Proyecto OnlyCarNLD/Datos/5.6.4 deteccion_tipo_usuario]] | Detecci√≥n autom√°tica |
| [[Proyecto OnlyCarNLD/Datos/5.6.5 seguridad_auth]] | Manejo de sesiones |
| [[Proyecto OnlyCarNLD/Datos/5.6.6 migracion_usuarios]] | Migraci√≥n de cuentas |
| [[Proyecto OnlyCarNLD/Datos/5.6.7 arquitectura_verificacion_hibrida]] | Arq. Verificaci√≥n H√≠brida |

### 5.7 PDFme - Generaci√≥n de PDFs (0 descendientes)

Templates para contratos y reportes.

### 5.8 Geolocalizaci√≥n y Ubicaci√≥n (54 descendientes!) ‚≠ê

El subm√≥dulo m√°s grande de integraciones.

| Subm√≥dulo | Descripci√≥n | Hijos |
|-----------|-------------|-------|
| [[Proyecto OnlyCarNLD/Datos/5.8.1 capacitor_geolocation]] | GPS nativo | 7 |
| [[Proyecto OnlyCarNLD/Datos/5.8.2 realtime_broadcast]] | Tracking realtime | 5 |
| [[Proyecto OnlyCarNLD/Datos/5.8.3 mapas_visualizacion]] | Mapbox/Google Maps | 5 |
| [[Proyecto OnlyCarNLD/Datos/5.8.4 navegacion_externa]] | Direcciones ‚Üî coords | 3 |
| [[Proyecto OnlyCarNLD/Datos/5.8.5 deteccion_llegada]] | Pol√≠gonos cobertura | 4 |
| [[Proyecto OnlyCarNLD/Datos/5.8.6 backend_ubicaciones]] | Ubicaci√≥n en servicio | 10+ |
| [[Proyecto OnlyCarNLD/Datos/5.8.10 watchtower_algorithm]] | Watchtower (Safety) | 0 |
| [[Proyecto OnlyCarNLD/Datos/5.8.11 client_timeline_ui]] | Timeline UI | 0 |
| [[Proyecto OnlyCarNLD/Datos/5.8.12 admin_god_view]] | God View Dashboard | 0 |

**Estructura Profunda de 5.8.6:**
```
5.8.6 tracking_operador (10+ desc)
‚îú‚îÄ‚îÄ 5.8.6.1 inicio_tracking
‚îú‚îÄ‚îÄ 5.8.6.2 envio_ubicacion
‚îú‚îÄ‚îÄ 5.8.6.3 visualizacion_admin
‚îú‚îÄ‚îÄ 5.8.6.4 historial_rutas
‚îî‚îÄ‚îÄ 5.8.6.5 optimizacion_bateria (10 hijos!)
```

### 5.9 Soporte Externo (11 descendientes)

| Subm√≥dulo                    | Proveedor               |
| ---------------------------- | ----------------------- |
| [[Proyecto OnlyCarNLD/Datos/5.9.1 tawk_live_chat]]     | Chat widget             |
| [[Proyecto OnlyCarNLD/Datos/5.9.2 chatwoot_omnicanal]] | Alternativa open source |

### 5.11 MercadoPago - Integraci√≥n (4 descendientes)

| Subm√≥dulo | Descripci√≥n |
|-----------|-------------|
| [[Proyecto OnlyCarNLD/Datos/5.11.1 point_terminal]] | Cobro presencial |
| [[Proyecto OnlyCarNLD/Datos/5.11.2 checkout_liquidacion]] | Checkout y liquidaci√≥n |
| [[Proyecto OnlyCarNLD/Datos/5.11.3 webhooks_mercadopago]] | Webhooks MP |
| [[Proyecto OnlyCarNLD/Datos/5.11.4 flujo_operador]] | Flujo operador |

---

## Archivos Cr√≠ticos

| # | Archivo | Descripci√≥n | Desc |
|---|---------|-------------|------|
| 1 | [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]] | Tracking tiempo real | 54 |
| 2 | [[Proyecto OnlyCarNLD/Datos/5.6. autenticacion]] | Sistema auth dual | 6 |
| 3 | [[Proyecto OnlyCarNLD/Datos/5.11 mercadopago_integracion]] | Cobros presenciales | 4 |
| 4 | [[Proyecto OnlyCarNLD/Datos/5.1. stripe_pagos]] | Pagos digitales | 1 |
| 5 | [[Proyecto OnlyCarNLD/Datos/5.3. mifiel_firmas]] | Firma contratos B2B | 0 |

---

## Beneficios del Modelo Delegado

| Beneficio | Valor |
|-----------|-------|
| Menos c√≥digo facturaci√≥n | 95% |
| Menos responsabilidad legal | 90% |
| Gesti√≥n certificados | 0 |
| Facturaci√≥n autom√°tica | 100% |
| ROI positivo desde | Mes 1 |

---

## Webhooks Cr√≠ticos

| Proveedor | Evento | Acci√≥n |
|-----------|--------|--------|
| Stripe | payment_intent.succeeded | Actualizar estado pago |
| MercadoPago | point.integration.wh | Confirmar cobro terminal |
| Gigstack | invoice.created | Asociar CFDI a servicio |
| Mifiel | document.signed | Activar contrato B2B |

---

ACTUALIZACI√ìN
√öltima revisi√≥n: 2026-01-23
Basado en: 88 archivos de documentaci√≥n
Versi√≥n: 3.2 (Hybrid Verification Added)
