---
id: 5.8.7
title: Edge Cases
parent: '5.8'
breadcrumb: 0 â†’ 5.0 â†’ 5.8 â†’ 5.8.7
type: modulo_padre
children_count: 4
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-01 18:10
domain:
- errores
- edge
- fallback
summary: Manejo de edge cases en geolocalizaciÃ³n.
content_hash: 1246fab5ad85727f
---

# 5.8.7 Edge Cases y Manejo de Errores

Escenarios problemÃ¡ticos y sus soluciones.

---

## Mapa de Escenarios

```mermaid
mindmap
  root((Edge Cases))
    GPS
      Sin seÃ±al
      Baja precisiÃ³n
      Timeout
      Permiso denegado
    Red
      Sin conexiÃ³n
      ConexiÃ³n lenta
      DesconexiÃ³n intermitente
    App
      Minimizada
      Cerrada por SO
      Crash
    Usuario
      MÃºltiples dispositivos
      Cambio de operador
      UbicaciÃ³n falsa
    Sistema
      Supabase caÃ­do
      Rate limit
      Clock drift
```

---

## Resumen de Fallbacks

| Escenario | DetecciÃ³n | Fallback | UX |
|-----------|-----------|----------|-----|
| Sin GPS | Error sensor | Ãšltima ubicaciÃ³n conocida | âš ï¸ Badge "Sin GPS" |
| Offline | Network status | Cola local | âš ï¸ "Reconectando..." |
| App killed | N/A | Confirmar manual al reabrir | âš ï¸ "Continuar?" |
| MÃºltiples dispositivos | Auth check | Solo 1 activo | âŒ Alerta |

---

## Principios de DiseÃ±o

> [!IMPORTANT]
> 1. **Nunca bloquear al usuario** â€” Siempre hay un fallback
> 2. **Transparencia** â€” El usuario sabe el estado del sistema
> 3. **RecuperaciÃ³n automÃ¡tica** â€” Reintentar sin intervenciÃ³n
> 4. **ConfirmaciÃ³n manual** â€” Siempre disponible como Ãºltimo recurso

---

## Estructura de Hijos

| ID                                    | Nombre           | DescripciÃ³n            | Estado |
| ------------------------------------- | ---------------- | ---------------------- | ------ |
| [[Proyecto OnlyCarNLD/Datos/5.8.7.1 gps_unavailable\|5.8.7.1]]  | GPS Unavailable  | Sin seÃ±al GPS          | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.8.7.2 network_offline\|5.8.7.2]]  | Network Offline  | Sin conexiÃ³n           | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.8.7.3 app_killed\|5.8.7.3]]       | App Killed       | App cerrada por SO     | âœ…      |
| [[Proyecto OnlyCarNLD/Datos/5.8.7.4 multiple_devices\|5.8.7.4]] | Multiple Devices | MÃºltiples dispositivos | âœ…      |

---

## Composable de Estado Global

```typescript
// composables/useGeoState.ts
export type GeoStatus = 
  | 'idle'
  | 'tracking'
  | 'error_gps'
  | 'error_network'
  | 'error_permission'
  | 'reconnecting'
  | 'offline_queue';

interface GeoState {
  status: GeoStatus;
  lastKnownPosition: { lat: number; lng: number } | null;
  lastUpdateTime: Date | null;
  errorMessage: string | null;
  offlineQueue: number;
  isRecovering: boolean;
}

export const useGeoState = () => {
  const state = useState<GeoState>('geo-state', () => ({
    status: 'idle',
    lastKnownPosition: null,
    lastUpdateTime: null,
    errorMessage: null,
    offlineQueue: 0,
    isRecovering: false
  }));
  
  const setError = (type: GeoStatus, message: string) => {
    state.value.status = type;
    state.value.errorMessage = message;
  };
  
  const setTracking = () => {
    state.value.status = 'tracking';
    state.value.errorMessage = null;
    state.value.isRecovering = false;
  };
  
  const updatePosition = (lat: number, lng: number) => {
    state.value.lastKnownPosition = { lat, lng };
    state.value.lastUpdateTime = new Date();
  };
  
  const incrementOfflineQueue = () => {
    state.value.offlineQueue++;
    state.value.status = 'offline_queue';
  };
  
  const clearOfflineQueue = () => {
    state.value.offlineQueue = 0;
    state.value.status = 'tracking';
  };
  
  return {
    state: readonly(state),
    setError,
    setTracking,
    updatePosition,
    incrementOfflineQueue,
    clearOfflineQueue
  };
};
```

---

## Componente de Status

```vue
<!-- components/GeoStatusBanner.vue -->
<script setup lang="ts">
const { state } = useGeoState();

const statusConfig = computed(() => {
  const configs: Record<GeoStatus, { icon: string; text: string; color: string }> = {
    idle: { icon: 'âšª', text: 'GPS inactivo', color: 'gray' },
    tracking: { icon: 'ğŸŸ¢', text: 'Compartiendo ubicaciÃ³n', color: 'green' },
    error_gps: { icon: 'ğŸ“', text: 'Sin seÃ±al GPS', color: 'yellow' },
    error_network: { icon: 'ğŸ”´', text: 'Sin conexiÃ³n', color: 'red' },
    error_permission: { icon: 'ğŸ”’', text: 'Sin permiso GPS', color: 'red' },
    reconnecting: { icon: 'ğŸ”„', text: 'Reconectando...', color: 'yellow' },
    offline_queue: { icon: 'ğŸ“¤', text: `${state.value.offlineQueue} pendientes`, color: 'yellow' }
  };
  return configs[state.value.status];
});
</script>

<template>
  <div 
    v-if="state.status !== 'idle' && state.status !== 'tracking'"
    :class="['geo-status-banner', statusConfig.color]"
  >
    <span>{{ statusConfig.icon }}</span>
    <span>{{ statusConfig.text }}</span>
    <span v-if="state.errorMessage" class="error-detail">
      {{ state.errorMessage }}
    </span>
  </div>
</template>
```

---

## Matriz de RecuperaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESTRATEGIA DE RECUPERACIÃ“N                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ERROR           RETRY      FALLBACK           ESCALATE         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  GPS timeout     3x 5s      Ãšltima conocida    Conf. manual     â”‚
â”‚  GPS denied      1x         Pedir permiso      Instrucciones    â”‚
â”‚  Network fail    5x exp     Cola local         Offline mode     â”‚
â”‚  Supabase down   3x 10s     KV cache           Alerta admin     â”‚
â”‚  App killed      N/A        Detectar al abrir  Continuar?       â”‚
â”‚                                                                 â”‚
â”‚  exp = exponential backoff (1s, 2s, 4s, 8s, 16s)                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

â†’ Ver GPS unavailable: [[Proyecto OnlyCarNLD/Datos/5.8.7.1 gps_unavailable]]

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/5.8. geolocalizacion]]            |
| -------------------- | ---------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/5.8.6 backend_ubicaciones]]              |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/5.8.8 testing]]              |
