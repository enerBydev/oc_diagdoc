---
id: 3.1.4.1
title: Tablas Core
parent: 3.1.4
breadcrumb: 0 → 3.0 → 3.1 → 3.1.4 → 3.1.4.1
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2026-01-05 12:30
domain:
- sql
- tablas
- core
actors:
- admin
- desarrollador
summary: 'Tablas fundamentales del sistema: config_sistema, servicios, paquetes.

  Incluye constraints, índices y campos calculados.'
content_hash: 46d85a269ad68b99
---

# 3.1.4.1 Tablas Core

> Tablas fundamentales: configuración global, servicios y paquetes.

---

## config_sistema

Configuración global del sistema. Solo puede existir un registro.

```sql
CREATE TABLE config_sistema (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  version VARCHAR(20) NOT NULL DEFAULT '3.2.1',
  currency VARCHAR(3) NOT NULL DEFAULT 'MXN',
  precios_incluyen_iva BOOLEAN DEFAULT true,
  formula_descuentos_acumulados TEXT,
  descuento_max DECIMAL(5,2) DEFAULT 100,
  descuento_min DECIMAL(5,2) DEFAULT 0,
  precio_min DECIMAL(10,2) DEFAULT 50,
  factor_base DECIMAL(4,2) DEFAULT 1.0,
  factor_b2c DECIMAL(4,2) DEFAULT 0.7,
  factor_b2b DECIMAL(4,2) DEFAULT 0.45,
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  -- incident_types refer to [[1.6.3.1 matriz_tipificacion_incidencias]]
);

CREATE UNIQUE INDEX idx_config_unica ON config_sistema ((true));
```

---

## servicios

Catálogo de servicios individuales con campo calculado `total_bloqueado`.

```sql
CREATE TABLE servicios (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  codigo VARCHAR(100) NOT NULL UNIQUE,
  nombre VARCHAR(200) NOT NULL,
  servicio_minutos INTEGER NOT NULL CHECK (servicio_minutos > 0),
  buffer_minutos INTEGER DEFAULT 15,
  total_bloqueado INTEGER GENERATED ALWAYS AS (servicio_minutos + buffer_minutos) STORED,
  precio_base DECIMAL(10,2) NOT NULL CHECK (precio_base >= 0),
  descripcion TEXT,
  orden INTEGER DEFAULT 0,
  activo BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_servicios_activo ON servicios(activo) WHERE activo = true;
```

---

## paquetes

Paquetes B2C/B2B con herencia y escalas de volumen.

```sql
CREATE TABLE paquetes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  codigo VARCHAR(100) NOT NULL UNIQUE,
  tipo VARCHAR(10) NOT NULL CHECK (tipo IN ('b2c', 'b2b')),
  nombre VARCHAR(200) NOT NULL,
  servicio_minutos INTEGER NOT NULL,
  buffer_minutos INTEGER DEFAULT 15,
  total_bloqueado INTEGER GENERATED ALWAYS AS (servicio_minutos + buffer_minutos) STORED,
  precio_base DECIMAL(10,2) NOT NULL,
  hereda_de_id UUID REFERENCES paquetes(id),
  escala_volumen_id UUID REFERENCES escalas_volumen(id),
  descripcion TEXT,
  activo BOOLEAN DEFAULT true
);
```

---

## Navegación

| ⬆️ Padre | [[Proyecto OnlyCarNLD/Datos/3.1.4 esquema_sql_logica_negocio]] |
|----------|--------------------------------------|
| ➡️ Siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.4.2 Tablas_Relacionales]] |

---
