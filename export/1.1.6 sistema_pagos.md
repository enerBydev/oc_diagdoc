---
id: 1.1.6
title: Sistema de Pagos y FacturaciÃ³n
parent: '1.1'
breadcrumb: 0 â†’ 1.0 â†’ 1.1 â†’ 1.1.6
type: logica
status: activo
last_updated: 2026-01-29 15:31
file_create: 2025-12-23 01:27
domain:
- pagos
- facturacion
- stripe
- gigstack
summary: 'Sistema completo de pagos: 3 mÃ©todos (efectivo, digital, suscripciÃ³n B2B),

  flujos por tipo, integraciÃ³n Stripe-Gigstack. Fuente de verdad de pagos.

  '
content_hash: 73dbd8f3bd2d16ea
---

# 1.1.6 Sistema de Pagos y FacturaciÃ³n

> [!IMPORTANT]
> Este mÃ³dulo es la **fuente de verdad** para el contexto de pagos de la plataforma.
> Las integraciones tÃ©cnicas detalladas estÃ¡n en [[Proyecto OnlyCarNLD/Datos/5.0. integraciones]].

---

## MÃ©todos de Pago Disponibles

| CÃ³digo | MÃ©todo | Aplica a | DescripciÃ³n |
|--------|--------|----------|-------------|
| **PAY-EF** | Efectivo/Tarjeta FÃ­sica Post-Servicio | B2C, B2B (sin contrato) | Pago presencial al operador |
| **PAY-DIG** | Pago Digital Post-Servicio | B2C, B2B (sin contrato) | Link Stripe enviado al finalizar |
| **PAY-SUB** | SuscripciÃ³n B2B Recurrente | B2B (con contrato) | Cobro automÃ¡tico segÃºn contrato |

---

## Arquitectura del Sistema de Pagos

```mermaid
flowchart TD
    subgraph CITA[CLIENTE AGENDA CITA]
        Q{Â¿CÃ³mo desea pagar?}
        Q --> PAY_EF[PAY-EF<br/>Efectivo/Tarjeta FÃ­sica]
        Q --> PAY_DIG[PAY-DIG<br/>Pago Digital]
    end
    
    PAY_EF --> OP[OPERADOR FINALIZA SERVICIO]
    PAY_DIG --> OP
    
    subgraph B2B[CONTRATOS B2B]
        TIPO{Tipo de Contrato}
        TIPO --> UNIT[PAY-SUB-UNIT<br/>Pago por Servicio]
        TIPO --> MONTHLY[PAY-SUB-MONTHLY<br/>SuscripciÃ³n Mensual]
        UNIT --> COBRO1[Cobro al finalizar<br/>Link Stripe]
        MONTHLY --> COBRO2[Cobro automÃ¡tico<br/>DÃ­a X acordado]
    end
```



```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENTE AGENDA CITA (B2C / B2B sin contrato)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Â¿CÃ³mo desea pagar?                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  Efectivo / Tarjeta      â”‚    â”‚  Pago Digital            â”‚              â”‚
â”‚   â”‚  FÃ­sica Post-Servicio    â”‚    â”‚  Post-Servicio           â”‚              â”‚
â”‚   â”‚  (PAY-EF)                â”‚    â”‚  (PAY-DIG)               â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                â”‚                               â”‚                            â”‚
â”‚                â–¼                               â–¼                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              OPERADOR FINALIZA SERVICIO                             â”‚   â”‚
â”‚   â”‚   (despuÃ©s de Sistema de DocumentaciÃ³n y ComunicaciÃ³n)              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTRATOS B2B (Suscripciones Recurrentes)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Tipo de Contrato:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  Pago por Servicio       â”‚    â”‚  SuscripciÃ³n Mensual     â”‚              â”‚
â”‚   â”‚  Prestado (Ãºnico)        â”‚    â”‚  (X servicios incluidos) â”‚              â”‚
â”‚   â”‚  (PAY-SUB-UNIT)          â”‚    â”‚  (PAY-SUB-MONTHLY)       â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                â”‚                               â”‚                            â”‚
â”‚                â–¼                               â–¼                            â”‚
â”‚   Cobro al finalizar servicio     Cobro automÃ¡tico dÃ­a X acordado           â”‚
â”‚   Link Stripe â†’ Email/Chat         Stripe Subscription + Recordatorios      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo 1: Efectivo / Tarjeta FÃ­sica (PAY-EF)

**Aplicable a:** B2C y B2B (servicios sin contrato)

```mermaid
flowchart TD
    A[Cliente agenda cita<br/>Selecciona PAY-EF] --> B[Operador realiza servicio<br/>Fotos ANTES/DESPUÃ‰S]
    B --> C{Â¿El cliente ya pagÃ³?}
    C -->|SÃ| D{Â¿PagÃ³ con?}
    C -->|NO| E[Generar Link Stripe<br/>Enviar a Chat + Email]
    D -->|Efectivo| F{Â¿Necesita factura?}
    D -->|Tarjeta| F
    F -->|SÃ| G[Gigstack AutoFactura]
    F -->|NO| H[Gigstack: PÃºblico en General]
    E --> I[FINALIZAR SERVICIO]
    G --> I
    H --> I
```


```
1. CLIENTE AGENDA CITA
   â†’ Selecciona mÃ©todo: "Efectivo / Tarjeta FÃ­sica Post-Servicio"
   â†’ Sistema registra preferencia de pago

2. OPERADOR REALIZA SERVICIO
   â†’ Ejecuta servicio completo
   â†’ Toma fotos ANTES y DESPUÃ‰S
   â†’ Sistema de DocumentaciÃ³n y ComunicaciÃ³n completado

3. PANTALLA DE FINALIZACIÃ“N (Operador)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  FINALIZAR SERVICIO                                        â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                            â”‚
   â”‚  Â¿El cliente ya realizÃ³ el pago?                           â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
   â”‚  â”‚   SÃ    â”‚  â”‚   NO    â”‚                                  â”‚
   â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                  â”‚
   â”‚       â”‚            â”‚                                       â”‚
   â”‚       â–¼            â–¼                                       â”‚
   â”‚  Â¿PagÃ³ con?    Generar Link Stripe                         â”‚
   â”‚  â€¢ Efectivo    â†’ Enviar a Chat + Email                     â”‚
   â”‚  â€¢ Tarjeta     â†’ Cliente paga cuando pueda                 â”‚
   â”‚       â”‚        â†’ Cliente decide si quiere factura o no     â”‚                                  
   â”‚       â”‚            â”‚                                       â”‚
   â”‚       â”‚            â”‚                                       â”‚   
   â”‚       â”‚            â–¼                                       â”‚   
   â”‚       â”‚    [  FINALIZAR SERVICIO  ]                        â”‚
   â”‚       â–¼                                                    â”‚      
   â”‚  Â¿Cliente necesita factura?                                â”‚
   â”‚  â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”                                      â”‚
   â”‚  â”‚ SÃ  â”‚      â”‚ NO  â”‚                                      â”‚
   â”‚  â””â”€â”€â”¬â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”˜                                      â”‚
   â”‚     â”‚            â”‚                                         â”‚
   â”‚     â–¼            â–¼                                         â”‚
   â”‚  Gigstack    Gigstack factura                              â”‚
   â”‚  AutoFactura "PÃºblico en General"                          â”‚
   â”‚  â†’ Chat/Email                                              â”‚
   â”‚                                                            â”‚
   â”‚  [  FINALIZAR SERVICIO  ]                                  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```




### Reglas PAY-EF

| Regla | DescripciÃ³n |
|-------|-------------|
| **PAY-EF-001** | Operador debe verificar si pago fue efectivo o tarjeta |
| **PAY-EF-002** | Si cliente no pagÃ³ â†’ Generar Link Stripe automÃ¡tico |
| **PAY-EF-003** | Link se envÃ­a a chat interno + email |
| **PAY-EF-004** | Si factura=NO â†’ Gigstack emite a "PÃºblico en General" |
| **PAY-EF-005** | Si factura=SÃ â†’ Enviar enlace autofactura Gigstack |

---

## Flujo 2: Pago Digital (PAY-DIG)

**Aplicable a:** B2C y B2B (servicios sin contrato)

```mermaid
flowchart TD
    A[Cliente agenda cita<br/>Selecciona PAY-DIG] --> B[Operador realiza servicio]
    B --> C[FINALIZAR Y ENVIAR LINK]
    C --> D[Sistema genera Payment Link<br/>Stripe API]
    D --> E[EnvÃ­a a Chat + Email]
    E --> F[Cliente paga<br/>Stripe Checkout]
    F --> G[Webhook confirma pago]
    G --> H[CARD marcada: Pagado âœ“]
```


```
1. CLIENTE AGENDA CITA
   â†’ Selecciona mÃ©todo: "Pago Digital Post-Servicio"
   â†’ Sistema registra preferencia de pago

2. OPERADOR REALIZA SERVICIO
   â†’ Ejecuta servicio completo
   â†’ Toma fotos ANTES y DESPUÃ‰S
   â†’ Sistema de DocumentaciÃ³n y ComunicaciÃ³n completado

3. PANTALLA DE FINALIZACIÃ“N (Operador)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  FINALIZAR SERVICIO                             â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                 â”‚
   â”‚  MÃ©todo de pago: DIGITAL POST-SERVICIO          â”‚
   â”‚                                                 â”‚
   â”‚  [  FINALIZAR Y ENVIAR LINK DE PAGO  ]          â”‚
   â”‚                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. SISTEMA AUTOMÃTICO
   â†’ Comunica con Stripe API
   â†’ Genera Payment Link con datos del servicio
   â†’ EnvÃ­a link a:
     â€¢ Chat interno de la app (botÃ³n "Pagar")
     â€¢ Email del cliente
   â†’ Cliente tiene 2 formas de pagar

5. CLIENTE PAGA
   â†’ Abre link en app o email
   â†’ Paga con Stripe Checkout
   â†’ Gigstack by Stripe App Marketplace habilitado
   â†’ Cliente puede autofacturar si lo desea

6. POST-PAGO
   â†’ Webhook Stripe confirma pago
   â†’ Sistema actualiza estado del servicio
   â†’ CARD de servicio se marca como "Pagado âœ“"
```


### Reglas PAY-DIG

| Regla | DescripciÃ³n |
|-------|-------------|
| **PAY-DIG-001** | Al finalizar, sistema genera Link Stripe automÃ¡ticamente |
| **PAY-DIG-002** | Link se envÃ­a a chat interno + email (2 canales) |
| **PAY-DIG-003** | BotÃ³n "Pagar" aparece en app del cliente |
| **PAY-DIG-004** | Gigstack by Stripe permite autofactura en checkout |
| **PAY-DIG-005** | Webhook actualiza estado en tiempo real |

---

## Flujo 3: Suscripciones B2B (PAY-SUB)

> [!WARNING]
> Este sistema NO aplica a servicios sin contrato.
> Los contratos se rigen por tÃ©rminos preestablecidos firmados vÃ­a Mifiel.

### Tipos de Contrato B2B

| Tipo | CÃ³digo | DescripciÃ³n | Momento de Cobro |
|------|--------|-------------|------------------|
| Pago por Servicio Prestado | PAY-SUB-UNIT | Pago Ãºnico por cada servicio | Al finalizar servicio |
| SuscripciÃ³n Mensual | PAY-SUB-MONTHLY | X servicios incluidos/mes | DÃ­a X del mes acordado |


### Flujo PAY-SUB-UNIT: Pago por Servicio Prestado

```
1. CONTRATO FIRMADO
   â†’ Tipo: "Pago por Servicio Prestado"
   â†’ Cada servicio se cobra individualmente

2. OPERADOR FINALIZA SERVICIO
   â†’ Sistema de DocumentaciÃ³n completado
   â†’ Presiona "Finalizar Servicio"

3. SISTEMA AUTOMÃTICO
   â†’ Genera Payment Link de Stripe
   â†’ EnvÃ­a a:
     â€¢ Chat interno de la app
     â€¢ Email del contacto B2B
   â†’ Cliente paga cuando desee

4. POST-PAGO
   â†’ Cliente puede autofacturar con Gigstack
   â†’ O esperar factura mensual consolidada
```

---

### Flujo PAY-SUB-MONTHLY: SuscripciÃ³n Mensual

```
1. CONTRATO FIRMADO
   â†’ Tipo: "SuscripciÃ³n Mensual"
   â†’ X servicios incluidos por mes
   â†’ DÃ­a de facturaciÃ³n acordado: dÃ­a X
   â†’ Stripe Subscription configurada

2. SERVICIOS DEL MES
   â†’ Operador realiza servicios segÃºn agenda
   â†’ Sistema cuenta servicios realizados
   â†’ Si excede X servicios â†’ Cobro adicional

3. SISTEMA DE RECORDATORIOS
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  ALGORITMO DE RECORDATORIOS                     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                                                 â”‚
   â”‚  DÃ­a X-7:  Email recordatorio "PrÃ³ximo cobro"   â”‚
   â”‚  DÃ­a X-3:  NotificaciÃ³n push app "En 3 dÃ­as..." â”‚
   â”‚  DÃ­a X-1:  Email + Push "MaÃ±ana se procesa..."  â”‚
   â”‚  DÃ­a X:    Stripe procesa cobro automÃ¡tico      â”‚
   â”‚                                                 â”‚
   â”‚  Si falla el cobro:                             â”‚
   â”‚  DÃ­a X+1:  Email "Pago no procesado"            â”‚
   â”‚  DÃ­a X+3:  Push + Email "Actualizar mÃ©todo"     â”‚
   â”‚  DÃ­a X+7:  Alerta a Admin                       â”‚
   â”‚                                                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. FACTURACIÃ“N AUTOMÃTICA
   â†’ Gigstack genera CFDI mensual consolidado
   â†’ Incluye todos los servicios del perÃ­odo
   â†’ EnvÃ­o automÃ¡tico a email del cliente B2B
```


### Sistema de Recordatorios

| DÃ­a | AcciÃ³n |
|-----|--------|
| X-7 | Email recordatorio "PrÃ³ximo cobro" |
| X-3 | NotificaciÃ³n push "En 3 dÃ­as..." |
| X-1 | Email + Push "MaÃ±ana se procesa..." |
| X | Stripe procesa cobro automÃ¡tico |
| X+1 | Email "Pago no procesado" (si falla) |
| X+3 | Push + Email "Actualizar mÃ©todo" |
| X+7 | Alerta a Admin |

### Reglas PAY-SUB

| Regla | DescripciÃ³n |
|-------|-------------|
| **PAY-SUB-001** | Contratos B2B obligatorios para este mÃ©todo |
| **PAY-SUB-002** | Stripe Subscription para recurrencia mensual |
| **PAY-SUB-003** | Recordatorios: -7, -3, -1 dÃ­as antes del cobro |
| **PAY-SUB-004** | Notificaciones vÃ­a email + push notifications |
| **PAY-SUB-005** | Gigstack factura mensual consolidada automÃ¡tica |
| **PAY-SUB-006** | Excedentes se cobran como servicios adicionales |
| **PAY-SUB-007** | Fallo de cobro: reintentos automÃ¡ticos + alertas |

---

## Flujo Operador â†’ Stripe â†’ Cliente

```mermaid
sequenceDiagram
    participant O as Operador PWA
    participant S as Stripe API
    participant C as Cliente App/Email
    
    O->>S: 1. Finalizar servicio
    S->>C: 2. Genera Payment Link (Chat + Email)
    C->>S: 3. Cliente paga
    S->>O: 4. Webhook payment.success
    O->>O: 5. CARD "Pagado âœ“"
```

### Estados de Pago en CARD

| Estado | Color | DescripciÃ³n |
|--------|-------|-------------|
| `pendiente` | ğŸŸ¡ Amarillo | Esperando pago |
| `pagado` | ğŸŸ¢ Verde | Pago confirmado |
| `fallido` | ğŸ”´ Rojo | Pago rechazado |
| `reembolsado` | ğŸ”µ Azul | Monto devuelto |

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/1.1. identidad]]                 |
| -------------------- | ---------------------------------- |
| â¬…ï¸ Hermano anterior  | [[Proyecto OnlyCarNLD/Datos/1.1.5 reglas_comerciales]]       |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/1.1.7 contratos_b2b]]            |
| ğŸ”— Ver tambiÃ©n       | [[Proyecto OnlyCarNLD/Datos/5.1. stripe_pagos]], [[Proyecto OnlyCarNLD/Datos/5.2. gigstack_facturacion]] |

---

**VersiÃ³n:** 1.0
