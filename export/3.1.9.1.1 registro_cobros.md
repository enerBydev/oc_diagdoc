---
id: 3.1.9.1.1
title: Registro de Cobros
parent: 3.1.9.1
breadcrumb: 0 â†’ 3.0 â†’ 3.1 â†’ 3.1.9 â†’ 3.1.9.1 â†’ 3.1.9.1.1
type: hoja
status: activo
last_updated: 2026-01-29 15:32
file_create: 2025-12-27 14:11
domain:
- registro
- cobros
- caja
actors:
- operador
summary: 'CÃ³mo se registran los cobros del dÃ­a.

  Flujo de ingreso de pagos efectivo/tarjeta.'
content_hash: 97107ec0fd05a44c
---

# 3.1.9.1.1 Registro de Cobros

CÃ³mo se registran los cobros del dÃ­a.

---

## Flujo de Registro

```typescript
const registrarCobro = async (
  servicioId: string,
  metodoPago: 'efectivo' | 'tarjeta',
  monto: number
) => {
  const supabase = useSupabaseClient();
  
  // Obtener servicio y operador
  const { data: servicio } = await supabase
    .from('citas')
    .select('operador_id, precio_total')
    .eq('id', servicioId)
    .single();
  
  // Crear o actualizar caja del dÃ­a
  const hoy = format(new Date(), 'yyyy-MM-dd');
  
  const { data: caja, error } = await supabase
    .from('cajas_diarias')
    .upsert({
      operador_id: servicio.operador_id,
      fecha: hoy
    }, { onConflict: 'operador_id,fecha' })
    .select()
    .single();
  
  // Registrar movimiento
  await supabase.from('caja_movimientos').insert({
    caja_id: caja.id,
    servicio_id: servicioId,
    tipo: 'ingreso',
    metodo_pago: metodoPago,
    monto,
    estado: 'pendiente'
  });
  
  // Actualizar totales
  await actualizarTotalesCaja(caja.id);
};
```

---

## UI: Al Completar Servicio

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’° REGISTRAR PAGO                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Cliente pagÃ³: $290                                             â”‚
â”‚                                                                 â”‚
â”‚  Â¿CÃ³mo recibiste el pago?                                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚               â”‚
â”‚  â”‚   ğŸ’µ EFECTIVO       â”‚  â”‚   ğŸ’³ TARJETA        â”‚               â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Recuerda fondear tu cuenta MP y liquidar                    â”‚
â”‚     antes del corte (21:30)                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Modelo de Datos

```sql
CREATE TABLE cajas_diarias (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  operador_id UUID REFERENCES operadores(id),
  fecha DATE NOT NULL,
  
  -- Totales
  total_efectivo DECIMAL(10,2) DEFAULT 0,
  total_tarjeta DECIMAL(10,2) DEFAULT 0,
  total_pendiente DECIMAL(10,2) DEFAULT 0,
  total_liquidado DECIMAL(10,2) DEFAULT 0,
  
  -- Estado
  estado VARCHAR(20) DEFAULT 'abierta', -- abierta, cerrada, liquidada
  
  created_at TIMESTAMPTZ DEFAULT now(),
  
  UNIQUE(operador_id, fecha)
);

CREATE TABLE caja_movimientos (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  caja_id UUID REFERENCES cajas_diarias(id),
  servicio_id UUID REFERENCES citas(id),
  
  tipo VARCHAR(20) NOT NULL, -- ingreso, deposito, liquidacion
  metodo_pago VARCHAR(20), -- efectivo, tarjeta
  monto DECIMAL(10,2) NOT NULL,
  
  estado VARCHAR(20) DEFAULT 'pendiente', -- pendiente, depositado, liquidado
  
  referencia VARCHAR(100), -- cÃ³digo depÃ³sito o ref MercadoPago
  verificado_at TIMESTAMPTZ,
  
  created_at TIMESTAMPTZ DEFAULT now()
);
```

---

## NavegaciÃ³n

| â¬†ï¸ Padre             | [[Proyecto OnlyCarNLD/Datos/3.1.9.1 caja_diaria]]       |
| -------------------- | ----------------------------- |
| â¡ï¸ Hermano siguiente | [[Proyecto OnlyCarNLD/Datos/3.1.9.1.2 tipos_pago]]      |

---
